(window.webpackJsonp=window.webpackJsonp||[]).push([[106],{508:function(s,a,t){"use strict";t.r(a);var n=t(2),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"mongodb-副本集集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mongodb-副本集集群"}},[s._v("#")]),s._v(" mongodb 副本集集群")]),s._v(" "),a("blockquote",[a("p",[s._v("主要通过不同端口配置")])]),s._v(" "),a("blockquote",[a("p",[s._v("集群主要分为三个节点"),a("code",[s._v("master")]),s._v("主节点，"),a("code",[s._v("slaver")]),s._v("备用节点，"),a("code",[s._v("arbiter")]),s._v("仲裁节点")])]),s._v(" "),a("h3",{attrs:{id:"创建文件目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建文件目录"}},[s._v("#")]),s._v(" 创建文件目录")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" /data/mongodb/db/master\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" /data/mongodb/db/slaver\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" /data/mongodb/db/arbiter\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"创建各个节点配置信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建各个节点配置信息"}},[s._v("#")]),s._v(" 创建各个节点配置信息")]),s._v(" "),a("ul",[a("li",[s._v("master.conf")])]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[s._v("dbpath=/data/mongodb/db/master \nlogpath=/data/mongodb/log/master.log\nlogappend=true\nreplSet=rep1\nport=37017\nfork=true\njournal=true\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("ul",[a("li",[s._v("slaver.conf")])]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[s._v("dbpath=/data/mongodb/db/slaver\nlogpath=/data/mongodb/log/slaver.log\nlogappend=true\nreplSet=rep1\nport=37018\nfork=true\njournal=true\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("ul",[a("li",[s._v("arbiter.conf")])]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[s._v("dbpath=/data/mongodb/db/arbiter\nlogpath=/data/mongodb/log/arbiter.log\nlogappend=true\nreplSet=rep1\nport=37018\nfork=true\njournal=true\nsmallfiles=true\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[s._v("dbpath：数据存放目录\nlogpath：日志存放路径\nlogappend：以追加的方式记录日志\nreplSet：replica set的名字\nport：mongodb进程所使用的端口号，默认为27017\nfork：以后台方式运行进程\njournal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("写日志\nsmallfiles"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("当提示空间不够时添加此参数\n其他参数\npidfilepath：进程文件，方便停止mongodb\ndirectoryperdb：为每一个数据库按照数据库名建立文件夹存放\nbind_ip：mongodb所绑定的ip地址\noplogSize：mongodb操作日志文件的最大大小。单位为Mb，默认为硬盘剩余空间的5%\nnoprealloc：不预先分配存储\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h3",{attrs:{id:"启动服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动服务"}},[s._v("#")]),s._v(" 启动服务")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("/app/mongodb/bin/mongod "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" /data/mongodb/master.conf\n/app/mongodb/bin/mongod "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" /data/mongodb/slaver.conf\n/app/mongodb/bin/mongod "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" /data/mongodb/arbiter.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"登录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#登录"}},[s._v("#")]),s._v(" 登录")]),s._v(" "),a("p",[a("code",[s._v("./mongo localhost:10000")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("user admin\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("cfg")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" _id:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rep1"')]),s._v(", members:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("_id:0,host:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'127.0.0.1:37017'")]),s._v(",priority:2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("_id:1,host:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'127.0.0.1:37018'")]),s._v(",priority:1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(","),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("_id:2,host:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'127.0.0.1:37019'")]),s._v(",arbiterOnly:true"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nrs.initiate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cfg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#使配置生效")]),s._v("\n\n\nrs.status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看配置")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h3",{attrs:{id:"主库添加数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#主库添加数据"}},[s._v("#")]),s._v(" 主库添加数据")]),s._v(" "),a("p",[a("code",[s._v('db.testCollection.insert({name:"testone"})')])]),s._v(" "),a("h3",{attrs:{id:"从库查询数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#从库查询数据"}},[s._v("#")]),s._v(" 从库查询数据")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("rep1:SECONDARY"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" db.testCollection.find"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nError: error: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$err")]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"not master and slaveOk=false"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"code"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13435")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("blockquote",[a("p",[s._v("出现查询问题需要执行")])]),s._v(" "),a("p",[a("code",[s._v("rs.slaveOk()")])])])}),[],!1,null,null,null);a.default=e.exports}}]);