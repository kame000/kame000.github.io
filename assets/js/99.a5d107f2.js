(window.webpackJsonp=window.webpackJsonp||[]).push([[99],{505:function(a,t,e){"use strict";e.r(t);var s=e(2),r=Object(s.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h2",{attrs:{id:"iptables利用connlimit模块限制同一ip连接connlimit功能"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#iptables利用connlimit模块限制同一ip连接connlimit功能"}},[a._v("#")]),a._v(" iptables利用connlimit模块限制同一IP连接connlimit功能")]),a._v(" "),t("ul",[t("li",[t("p",[a._v("connlimit模块允许你限制每个客户端IP的并发连接数，即每个IP同时连接到一个服务器个数。")])]),a._v(" "),t("li",[t("p",[a._v("connlimit模块主要可以限制内网用户的网络使用，对服务器而言则可以限制每个IP发起的连接数。")])])]),a._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"title"}),t("p",[a._v("connlimit参数")])]),t("ul",[t("li",[t("p",[a._v("--connlimit-above n 　　　＃限制为多少个")])]),a._v(" "),t("li",[t("p",[a._v("--connlimit-mask n 　　　 ＃这组主机的掩码,默认是connlimit-mask 32 ,即每个IP.")])])]),a._v(" "),t("h2",{attrs:{id:"例子"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#例子"}},[a._v("#")]),a._v(" 例子")]),a._v(" "),t("ul",[t("li",[a._v("限制同一IP同时最多100个http连接")])]),a._v(" "),t("p",[t("code",[a._v("iptables -I INPUT -p tcp --syn --dport 80 -m connlimit --connlimit-above 100 -j REJECT")])]),a._v(" "),t("ul",[t("li",[a._v("只允许每组C类IP同时100个http连接")])]),a._v(" "),t("p",[t("code",[a._v("iptables -p tcp --syn --dport 80 -m connlimit --connlimit-above 100 --connlimit-mask 24 -j REJECT")])]),a._v(" "),t("ul",[t("li",[a._v("只允许每个IP同时5个80端口转发,超过的丢弃")])]),a._v(" "),t("p",[t("code",[a._v("iptables -I FORWARD -p tcp --syn --dport 80 -m connlimit --connlimit-above 5 -j DROP")])]),a._v(" "),t("ul",[t("li",[a._v("限制某IP最多同时100个http连接")])]),a._v(" "),t("p",[t("code",[a._v("iptables -A INPUT -s 222.222.222.222 -p tcp --syn --dport 80 -m connlimit --connlimit-above 100 -j REJECT")])]),a._v(" "),t("ul",[t("li",[a._v("限制每IP在一定的时间(比如60秒)内允许新建立最多100个http连接数")])]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("iptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dport")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("80")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-m")]),a._v(" recent "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" BAD_HTTP_ACCESS "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--update")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--seconds")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("60")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--hitcount")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("100")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" REJECT\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dport")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("80")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-m")]),a._v(" recent "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" BAD_HTTP_ACCESS "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--set")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br")])])])}),[],!1,null,null,null);t.default=r.exports}}]);