(window.webpackJsonp=window.webpackJsonp||[]).push([[180],{584:function(s,a,t){"use strict";t.r(a);var n=t(2),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"git、gitlab、github的区别-基础概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#git、gitlab、github的区别-基础概念"}},[s._v("#")]),s._v(" git、gitlab、github的区别 基础概念")]),s._v(" "),a("p",[s._v("和SVN类似，Git是一个版本控制系统（Version Control System，VCS），不同的是SVN为集中式版本控制系统，为单一的集中管理的服务器，保存所有文件的修订版本，而协同工作的人们都通过客户端连到这台服务器，取出最新的文件或者提交更新，git为分布式版本控制系统，关于SVN和git的对比，可以通过下图进行说明（但最大的区别在于svn为集中式，git为分布式）")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://img.liuwenqi.com/blog/2019-09-25-085138.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"svn"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#svn"}},[s._v("#")]),s._v(" svn")]),s._v(" "),a("p",[s._v("svn好比一个巨大的图书馆，当你要借一本书的时候，需要先从图书馆借出，回家之后自己改，改完之后还是返回给图书馆，而git的方式完全不同，所有的客户端都一个是完整的版本库，没有中央控制的概念，可以这样类比，git提供了一个虚拟的全量图书馆，所有人都有一个虚拟的图书馆，当你想看其中一本书的时候，从自己的虚拟图书馆里面检索出来即可，如果你修改了其中的内容，可以直接提交到自己的虚拟图书馆里面，也不会影响其他人的图书馆，当有其他人想要看你修改的一本书的时候，你只要将对应的一本书的URL发给对方即可。")]),s._v(" "),a("h3",{attrs:{id:"git"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#git"}},[s._v("#")]),s._v(" Git")]),s._v(" "),a("p",[s._v("关于Git的诞生其实很有趣味性，在早期林纳斯·托瓦兹（Linux之父）面临Linux内核版本控制的问题，在最初，接受采用Bitkeeper进行Linux内核的代码管控，但有一个要求，不允许Linux社区开发人员对Bitkeeper进行破解，但对于追求开源软件的×××们，怎么可能这么听话，就有一个×××开发人员，对Bitkeeper进行了破解，基于之前的要求，Bitkeeper收回的林纳斯使用权，在协商无果的情况下，林纳斯闭关修炼7天，git就这样面试了，大神就是大神")]),s._v(" "),a("p",[s._v("Git是版本控制系统，Github是在线的基于Git的代码托管服务。GitHub是2008年由Ruby on Rails编写而成。GitHub同时提供付费账户和免费账户。这两种账户都可以创建公开的代码仓库，但是付费账户也可以创建私有的代码仓库，如果你在GitHub上面开源自己的项目，那么在面试的时候，这将是一个很大的优势和亮点，别人可以通过你在GitHub的开源项目，可以很好的了解到你的技术水平，同时GitHub上面项目的star越高，说明项目的影响力越大，这个很重要")]),s._v(" "),a("p",[s._v("由于GitHub对于私有的代码仓库是收费的，同时，并不是所有的公司会愿意将自己的项目托管在GitHub上面，因此gitlab就是为了解决这类问题的，gitlab搭建在个人的服务器上面，经过认证的人都可以在上面创建免费的私人repo，并进行多人协作。GitLab让开发团队对他们的代码仓库拥有更多的控制。")]),s._v(" "),a("h2",{attrs:{id:"gitlab-安装配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gitlab-安装配置"}},[s._v("#")]),s._v(" Gitlab  安装配置")]),s._v(" "),a("h3",{attrs:{id:"gitlab-安装脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gitlab-安装脚本"}},[s._v("#")]),s._v(" gitlab  安装脚本")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.rpm.sh "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"title"}),a("p",[s._v("由于资源在国外，国内下载很慢，推荐使用清华大华gitlab源")])]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/yum.repos.d/gitlab-ce.repo\n添加如下内容\n\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("gitlab-ce"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Gitlab CE Repository\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("baseurl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$releasever")]),s._v("/\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("gpgcheck")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("enabled")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("添加完成后，执行如下代码：")]),s._v(" "),a("ul",[a("li",[s._v("安装")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum makecache  \n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" gitlab-ce  \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ul",[a("li",[s._v("配置更改")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/gitlab/gitlab.rb\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 找到 external_url 'http://000.00.00.00:8081'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 修改成你的地址，此处为http://192.168.1.157:8081")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("ul",[a("li",[s._v("对GitLab进行编译")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" gitlab-ctl reconfigure  \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("清除缓存")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("gitlab-rake cache:clear "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("RAILS_ENV")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("production\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("启动gitlab服务，以及关闭防火墙等操作")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" gitlab-ctl start    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动所有 gitlab 组件；并加入开机启动项里面:/etc/rc.local")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" gitlab-ctl stop     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 停止所有 gitlab 组件；")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" gitlab-ctl restart   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启所有 gitlab 组件；")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" gitlab-ctl status    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看服务状态；")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" gitlab-ctl "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看日志；")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[a("strong",[s._v("关闭防火墙")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" iptables stop      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("###centos6关闭防火墙")]),s._v("\n\nsystemctl stop firewalld.service  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("###centos7关闭防火墙")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"gitlab-备份"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gitlab-备份"}},[s._v("#")]),s._v(" Gitlab 备份")]),s._v(" "),a("blockquote",[a("p",[s._v("使用Gitlab一键安装包安装Gitlab非常简单, 同样的备份恢复与迁移也非常简单. 使用一条命令即可创建完整的Gitlab备份")])]),s._v(" "),a("p",[a("code",[s._v("gitlab-rake gitlab:backup:create")])]),s._v(" "),a("h4",{attrs:{id:"修改备份文件目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改备份文件目录"}},[s._v("#")]),s._v(" 修改备份文件目录")]),s._v(" "),a("p",[s._v("可以通过"),a("code",[s._v("/etc/gitlab/gitlab.rb")]),s._v("配置文件来修改默认存放备份文件的目录")]),s._v(" "),a("p",[a("code",[s._v("gitlab_rails['backup_path'] = \"/var/opt/gitlab/backups\"")])]),s._v(" "),a("p",[s._v("修改完成之后使用"),a("code",[s._v("gitlab-ctl reconfigure")]),s._v("命令重载配置文件即可")]),s._v(" "),a("h4",{attrs:{id:"设置备份过期时间"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设置备份过期时间"}},[s._v("#")]),s._v(" 设置备份过期时间")]),s._v(" "),a("p",[a("code",[s._v("[root@gitlab ~]# vim /etc/gitlab/gitlab.rb")])]),s._v(" "),a("p",[s._v("更改如下行")]),s._v(" "),a("p",[a("code",[s._v("gitlab_rails['backup_keep_time'] = 604800 #以秒为单位")])]),s._v(" "),a("h4",{attrs:{id:"gitlab自动备份"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gitlab自动备份"}},[s._v("#")]),s._v(" gitlab自动备份")]),s._v(" "),a("blockquote",[a("p",[s._v("创建定时任务")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@gitlab ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# crontab -e")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" * * * /opt/gitlab/bin/gitlab-rake gitlab:backup:create\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"gitlab-迁移与恢复"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gitlab-迁移与恢复"}},[s._v("#")]),s._v(" Gitlab 迁移与恢复")]),s._v(" "),a("blockquote",[a("p",[s._v("Gitlab 备份版本与Gitlab恢复版本要一致")])]),s._v(" "),a("ul",[a("li",[s._v("在老服务器上将备份文件发送至新服务器的相应目录下")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@gitlab ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# scp /var/opt/gitlab/backups/1530156812_2018_06_28_10.8.4_gitlab_backup.tar root@10.0.0.6:/var/opt/gitlab/backups/")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"gitlab恢复"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gitlab恢复"}},[s._v("#")]),s._v(" gitlab恢复")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@gitlab ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# gitlab-ctl stop unicorn        #停止相关数据连接服务")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@gitlab ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# gitlab-ctl stop sidekiq")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@gitlab-new ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# chmod 777 /var/opt/gitlab/backups/1530156812_2018_06_28_10.8.4_gitlab_backup.tar")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#修改权限，如果是从本服务器恢复可以不修改")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@gitlab ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# gitlab-rake gitlab:backup:restore BACKUP=1530156812_2018_06_28_10.8.4    ")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#从1530156812_2018_06_28_10.8.4编号备份中恢复")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("按照提示输入两次yes并回车")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://img.liuwenqi.com/blog/2019-09-25-090627.jpg",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"gitlab升级"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gitlab升级"}},[s._v("#")]),s._v(" gitlab升级")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@gitlab ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# gitlab-ctl stop        #关闭gitlab服务")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@gitlab ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# gitlab-rake gitlab:backup:create        #备份")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("下载新版gitlab的rpm包安装，安装时选择升级")]),s._v(" "),a("p",[s._v("安装的过程中可能会出现报错")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[s._v("Error executing action `run` on resource 'ruby_block"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("directory resource")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /var/opt/gitlab/git"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("data/repositories"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("'\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("解决方法为")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@gitlab ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# chmod 2770 /var/opt/gitlab/git-data/repositories")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装成功后重新加载配置并启动")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@gitlab ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# gitlab-ctl reconfigure")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@gitlab ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# gitlab-ctl restart")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h3",{attrs:{id:"gitlab更改默认的nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gitlab更改默认的nginx"}},[s._v("#")]),s._v(" gitlab更改默认的nginx")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@gitlab ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/gitlab/gitlab.rb")]),s._v("\n\nnginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'enable'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#不启用nginx")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ul",[a("li",[s._v("检查默认nginx配置文件，并迁移至新Nginx服务")])]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[s._v("/var/opt/gitlab/nginx/conf/nginx.conf "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#nginx配置文件,包含gitlab-http.conf文件")]),s._v("\n\n/var/opt/gitlab/nginx/conf/gitlab"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("http.conf "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#gitlab核心nginx配置文件")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ul",[a("li",[s._v("重启 nginx、gitlab服务")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@gitlab ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# gitlab-ctl restart")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@gitlab ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart nginx.service")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"title"}),a("p",[s._v("访问可能出现报502。原因是nginx用户无法访问gitlab用户的socket文件。 重启gitlab需要重新授权")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@gitlab ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# chmod -R o+x /var/opt/gitlab/gitlab-rails")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);