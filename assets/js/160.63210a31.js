(window.webpackJsonp=window.webpackJsonp||[]).push([[160],{562:function(s,n,t){"use strict";t.r(n);var a=t(2),e=Object(a.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"使用场景"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用场景"}},[s._v("#")]),s._v(" 使用场景")]),s._v(" "),n("p",[s._v("\n最近在使用PHP重写一个使用JAVA写的项目，因为需要查看之前的项目，所以要在本地搭建一个Tomcat来跑JAVA的项目。搭建成功后，因为Tomcat监听的端口是8080，因此，访问的URL前缀是localhost:8080，每次访问项目的时候都要先输入这一串内容，感觉比较繁杂，所以想着将其变成localhost来访问，但是这样的话就是访问80端口了，要达到目的，就得做端口转发。笔者见识比较少，暂时想到的是使用Nginx/Apache等程序做转发。如果有更好的方案，欢迎指教。\n")]),s._v(" "),n("h2",{attrs:{id:"增加nginx虚拟主机"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#增加nginx虚拟主机"}},[s._v("#")]),s._v(" 增加Nginx虚拟主机")]),s._v(" "),n("blockquote",[n("p",[s._v("要做Nginx的转发，当然就要对Nginx做配置。可以通过添加虚拟主机配置来增强Nginx的功能。首先看看Nginx的配置文件，笔者的Nginx文件是在/etc/nginx/nginx.conf。从上图可以看到Nginx在最后引入了vhosts.d目录下的配置文件。那么就要在/etc/nginx/vhosts.d目录下创建以.conf为后缀的文件（如果该目录不存在需要自己创建）。")])]),s._v(" "),n("h2",{attrs:{id:"nginx做非80端口转发"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx做非80端口转发"}},[s._v("#")]),s._v(" Nginx做非80端口转发")]),s._v(" "),n("p",[s._v("要做转发，可以使用Nginx的proxy_pass配置项。Nginx监听80端口，接收到请求之后就会转发到要转发的URL。具体的配置如下:")]),s._v(" "),n("div",{staticClass:"language-yml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yml"}},[n("code",[s._v("      server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          server_name www.test.com\n          listen 80;\n\n          location / "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n              proxy_pass http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//127.0.0.1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("8080;\n          "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("是的，就是这么简单就可以了。这是配置端口转发的核心。")]),s._v(" "),n("p",[s._v("但是，当遇到需要获取真实IP的业务时，还需要添加关于真实IP的配置：")]),s._v(" "),n("div",{staticClass:"language-yml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yml"}},[n("code",[s._v("        server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            server_name www.test.com\n            listen 80;\n\n            location / "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                proxy_pass http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//127.0.0.1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("8080;\n                proxy_set_header Host $host"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("80;\n                proxy_set_header X"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("Real"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("IP $remote_addr;\n                proxy_set_header X"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("Forwarded"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("For $proxy_add_x_forwarded_for;\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[n("code",[s._v("proxy_set_header")]),s._v("这句配置是改变http的请求头。而Host是请求的主机名，"),n("code",[s._v("X-Real-IP")]),s._v("是请求的真实IP，"),n("code",[s._v("X-Forwarded-For")]),s._v("表示请求是由谁发起的。")]),s._v(" "),n("h2",{attrs:{id:"小结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#小结"}},[s._v("#")]),s._v(" 小结")]),s._v(" "),n("p",[s._v("这次的配置可能对大部分人来说都很简单，但是笔者刚接触Nginx配置这一块，因此记录下来，分享给有需要的人。如有建议和批评，欢迎指出。通过这次的学习发现，Nginx的配置是很值得学习的。")])])}),[],!1,null,null,null);n.default=e.exports}}]);