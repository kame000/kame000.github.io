(window.webpackJsonp=window.webpackJsonp||[]).push([[97],{509:function(a,s,t){"use strict";t.r(s);var e=t(2),r=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h2",{attrs:{id:"netfilter-iptables学习"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#netfilter-iptables学习"}},[a._v("#")]),a._v(" netfilter/iptables学习")]),a._v(" "),s("h3",{attrs:{id:"_1、链和表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、链和表"}},[a._v("#")]),a._v(" 1、链和表")]),a._v(" "),s("p",[a._v("表：filter：用于过滤的时候\n​    nat：用于做nat的时候\n链：INPUT:位于filter表，匹配目的IP是本机的数据包\n​    FORWARD：位于filter表，匹配穿过本机的数据包\n​    PREROUTING：位于nat表，用于修改目的地址（DNAT）\n​    POSTROUTING：位于nat表，用于修改源地址（SNAT）")]),a._v(" "),s("h3",{attrs:{id:"_2、iptables语法结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、iptables语法结构"}},[a._v("#")]),a._v(" 2、iptables语法结构")]),a._v(" "),s("blockquote",[s("p",[a._v("iptables [-t 要操作的表] <操作命令> [要操作的链] [规则号码] [匹配条件] [-j 匹配到以后的动作]")])]),a._v(" "),s("p",[a._v("操作命令：（-A -I -D -R -P -F）\n查看命令：（-[vxn]L）")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("-A <链名>：APPEND，追加一条规则。")]),a._v(" "),s("p",[s("code",[a._v("如：iptables -t filter -A INPUT -j DROP 在filter表的INPUT链中，匹配所有访问本机IP的数据包，匹配到的丢弃。")])])]),a._v(" "),s("li",[s("p",[a._v("-I <链名> [规则号码]：INSERT，插入一条规则")]),a._v(" "),s("p",[s("code",[a._v("如：iptables -I INPUT 3 -j DROP 在filter表的INPUT链中插入一条规则，插入成第三条。 -t filter可不写，默认是filter表")])])]),a._v(" "),s("li",[s("p",[a._v("-D  <链名> <规则号码|具体规则内容>:DELETE,删除一条规则。")]),a._v(" "),s("p",[s("code",[a._v("如：iptables -D INPUT 3 删除filter表INPUT链中第三条规则，不管是啥东东。")]),a._v(" "),s("code",[a._v("iptables -D INPUT -s 192.168.0.1 -j DROP 删除filter表INPUT链中匹配“-s 192.168.0.1 -j DROP”规则，不论位置。")])])]),a._v(" "),s("li",[s("p",[a._v("-R <链名> <规则号码> <具体规则内容>:REPLACE,替换一条规则")]),a._v(" "),s("p",[s("code",[a._v('如：iptables -R INPUT 3 -j ACCEPT 替换filter表中INPUT链的第三条规则内容替换为"-j ACCEPT"')])])]),a._v(" "),s("li",[s("p",[a._v("-P <链名> <动作>：POLICY,设置某个链的默认规则。")]),a._v(" "),s("p",[s("code",[a._v("如：iptables -P INPUT DROP 设置filter表IPUT链的默认规则为DROP，当数据包未被规则列表中的任何规则匹配到时，按此默认规则处理。*：此处是唯一的匹配动作前不加-j的情况。")])])]),a._v(" "),s("li",[s("p",[a._v("-F [链名]：FLUSH，清空规则\n"),s("code",[a._v("如：iptables -F INPUT 清空filter表INPUT链的所有规则。")]),a._v(" "),s("code",[a._v("iptables -t nat -F PREROUTING 清空nat表PREROUTING链中所有的规则。在设置了默认规则DROP后，使用-F一定要小心。")])])]),a._v(" "),s("li",[s("p",[a._v("-L [链名]：LIST，列出规则。")])])]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("v：显示详细信息，包括每条规则的匹配包数量和匹配字节数。\nx:在v的基础上，禁止自动单位换算。（K,M）\nn:只显示IP地址和端口号码，不显示域名和服务名称。\n如：iptables "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-L")]),a._v("   粗略列出filter表所有链及所有规则。\niptables "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-vnL")]),a._v("  用详细方式列出nat表的所有链和规则，只显示IP地址和端口号\niptables "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-vxnL")]),a._v(" PREROUTING     用详细方式列出nat表的PREROUTING链的所有规则及详细数字，不反解。\n\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])]),s("h2",{attrs:{id:"_3、匹配条件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3、匹配条件"}},[a._v("#")]),a._v(" 3、匹配条件")]),a._v(" "),s("ul",[s("li",[a._v("流入、流出接口（-i,-o）")]),a._v(" "),s("li",[a._v("来源、目的地址(-s,-d)")]),a._v(" "),s("li",[a._v("协议类型(-p)")]),a._v(" "),s("li",[a._v("来源、目的端口(--sport,--dport)")])]),a._v(" "),s("h3",{attrs:{id:"_1-、按网络接口匹配"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-、按网络接口匹配"}},[a._v("#")]),a._v(" (1)、按网络接口匹配")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("    如：-i eth0    匹配是否从网络接口eth0进来\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" eth0    匹配是否从网络接口eht0出去\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("h3",{attrs:{id:"_2-、-匹配来源地址-s-匹配来源地址-来源地址可以是ip-net-domain-也可以为空"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-、-匹配来源地址-s-匹配来源地址-来源地址可以是ip-net-domain-也可以为空"}},[a._v("#")]),a._v(" (2)、 匹配来源地址: -s [匹配来源地址]  来源地址可以是IP，net，domain,也可以为空")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("如：-s "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".0.1    匹配来自192.168.0.1的数据包。\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".1.0/24 匹配来自192.168.1.0/24网络的数据包。\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v(" www.abc.com    匹配来自域名www.abc.com网络的数据包。\n "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("匹配目的地址"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("  目的地址可以使IP,NET,domain，也可以为空。\n如：-d "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("202.131")]),a._v(".78.220  匹配去往202.131.78.220的数据包。\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("202.131")]),a._v(".0.0/16  匹配去往202.131.0.0/16网络的数据包。\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" www.abc.com     匹配去往域名www.abc.com的数据包。\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])]),s("h3",{attrs:{id:"_3-、按协议类型匹配"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-、按协议类型匹配"}},[a._v("#")]),a._v(" (3)、按协议类型匹配")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("匹配协议类型"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("  协议类型可以是tcp,udp,icmp等，也可以为空。\n如：-p tcp\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" udp\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" icmp --icmp-type 类型\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("h3",{attrs:{id:"_4-、按来源目的端口匹配。"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-、按来源目的端口匹配。"}},[a._v("#")]),a._v(" (4)、按来源目的端口匹配。")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--sport")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("匹配源端口"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("    源端口可以是个别端口，也可以是端口范围。\n如：--sport "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1000")]),a._v("        匹配源端口是1000的数据包。\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--sport")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1000")]),a._v(":3000   匹配源端口是1000-3000的数据包（含1000,3000）\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--sport")]),a._v(" :3000       匹配源端口是3000以下的数据包（含3000）\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--sport")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1000")]),a._v(":       匹配源端口是1000以上的数据包（含1000）\n "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dport")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("匹配目的端口"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("   目的端口可以是个别端口，也可以是端口范围。\n如：--dport "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("80")]),a._v("           匹配目的端口是80的数据包\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dport")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("6000")]),a._v(":8000    匹配目的端口是6000-8000的数据包（包含6000-8000）\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dport")]),a._v(" :3000        匹配目的端口是3000以下的数据包（含3000）\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dport")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1000")]),a._v(":        匹配目的端口是1000以上的数据包（含1000）\n注：--sport 和 --dport必须配合-p参数使用。\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br")])]),s("blockquote",[s("p",[a._v("匹配应用举例：")])]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" udp "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dport")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("53")]),a._v("           匹配网络中目的端口是53的udp协议数据包\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10.1")]),a._v(".0.0/24 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("172.17")]),a._v(".0.0/16      匹配来自10.1.0.0/24去往172.17.0.0/16的所有数据包\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".0.1 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" www.abc.com "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dport")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("80")]),a._v("     匹配来自192.168.0.1，去往www.abc.com的80端口的tcp协议数据包。\n条件越多，匹配越细致，匹配范围越小。\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("h2",{attrs:{id:"_4、动作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4、动作"}},[a._v("#")]),a._v(" 4、动作")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("ACCEPT\nDROP\nSNAT\nDNAT\nMASQUERADE\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("ul",[s("li",[a._v("-j ACCEPT  通过，允许数据包通过本链而不拦截它。")])]),a._v(" "),s("p",[s("code",[a._v("如：iptables -A INPUT -j ACCEPT 允许所有访问本机的IP数据包通过。类似cisco中ACL里面的permit")])]),a._v(" "),s("ul",[s("li",[a._v("-j DROP    丢弃，阻止数据包通过本链而丢弃它。类似cisco中ACL里面的deny")])]),a._v(" "),s("p",[s("code",[a._v("如：iptables -A FORWARD -s 192.168.80.39 -j DROP 阻止来源地址为192.168.80.39的数据包通过本机。")])]),a._v(" "),s("ul",[s("li",[a._v("-j DNAT --to IP[-IP][:端口-端口] （nat表的PREROUTING链）    目的地址转换。DNAT支持转换为单IP，也支持转换到IP地址池（一组连续的IP地址）")])]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("如：iptables "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" PREROUTING "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-i")]),a._v(" ppp0 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dport")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("80")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" DNAT "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--to")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".0.1    把从ppp0进来的药访问tcp/80的数据包目的地址转为192.168.0.1\n    iptables "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" PREROUTING "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-i")]),a._v(" ppp0 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dport")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("81")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" DNAT "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--to")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".0.2:80\n    iptables "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" PREROUTING "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-i")]),a._v(" PPP0 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-P")]),a._v(" tcp "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dport")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("80")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" DNAT "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--to")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".0.1-192.168.0.10\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("ul",[s("li",[a._v("-j SNAT --to IP[-IP] [:端口-端口]（nat表中的POSTROUTING链）    源地址转换。SNAT支持转换为单IP，也支持转换到IP地址池（一组练习的IP地址）")])]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("如：iptables "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" POSTROUTING "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".0.0/24 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" SNAT "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--to")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1.1")]),a._v(".1.1    将内网192.168.0.0、24的源地址改为1.1.1.1，用于nat\n    iptables "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" POSTROUTING "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-S")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".0.0/24 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-J")]),a._v(" SNAT "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--TO")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1.1")]),a._v(".1.1-1.1.1.10\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("ul",[s("li",[a._v("-j MASQUERADE       动态源地址转换。（动态IP的情况下使用）")])]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("如：iptables "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" POSTROUTING "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-S")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".0.0/24 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" MASQUEREADE    将源地址是192.168.0.0/24的数据包进行地址伪装。\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h2",{attrs:{id:"_5、附加模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5、附加模块"}},[a._v("#")]),a._v(" 5、附加模块")]),a._v(" "),s("p",[a._v("按包状态匹配。（state）\n按来源mac匹配（mac）\n按包速率匹配（limit）\n多端口匹配（multiport）")]),a._v(" "),s("h3",{attrs:{id:"_1-、-m-state-state-状态"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-、-m-state-state-状态"}},[a._v("#")]),a._v(" 1）、-m state --state 状态")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("    状态：NEW、RELATED、ESTABLISHED、INVALID\n    NEW:有别于tcp的syn\n    ESTABLISHED：连接态。\n    RELATED：衍生态，与conntrack关联（ftp）\n    INVALID:不能被识别属于哪个连接或没有任何状态。\n    如：iptables "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" INPUT "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-m")]),a._v(" state "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--state")]),a._v(" RELATED,ESTABLISHED "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("h3",{attrs:{id:"_2-、-m-mac-mac-source-mac-匹配某个mac地址"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-、-m-mac-mac-source-mac-匹配某个mac地址"}},[a._v("#")]),a._v(" 2)、-m mac --mac-source MAC    匹配某个MAC地址")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("如：iptables "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" FORWARD "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-m")]),a._v(" mac --mac-source xx:xx:xx:xx:xx:xx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" DROP    阻断来自某MAC地址的数据包通过本机。\n  注：报文在经过路由后，数据包中原有的MAC信息会被替换，所以在路由后的iptables中使用mac模块是没有意义的。\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("h3",{attrs:{id:"_3-、-m-limit-limit-匹配速率-burst-缓冲数量-用一定的速率去匹配数据包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-、-m-limit-limit-匹配速率-burst-缓冲数量-用一定的速率去匹配数据包"}},[a._v("#")]),a._v(" 3)、-m limit --limit 匹配速率 [--burst 缓冲数量]     用一定的速率去匹配数据包")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("如：iptables "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" FORWARD "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".0.1 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-m")]),a._v(" limit "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--limit")]),a._v(" 50m/s "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT\n    iptables "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" FORWARD "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".0.1 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" DROP\n注：limit英语上看是限制的意思，但实际上只是按一定速率去匹配，要想限制的话后面要再跟一条DROP\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("h3",{attrs:{id:"_4-、multiport"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-、multiport"}},[a._v("#")]),a._v(" 4)、multiport")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-m")]),a._v(" multiport "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("--sports"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("--dports"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("--ports"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" 端口1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("，端口2,"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(",端口n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("  一次性匹配多个端口，可以匹分源端口，目的端口或不指定端口。\n如:iptables "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" INPUT "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-P")]),a._v(" tcp "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-m")]),a._v(" multiport "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dports")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("21,22")]),a._v(",25,80,110 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT   匹配到达本机端口的21,22,25,80,110的数据包通过。 必须于-p参数一起使用。\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])])])}),[],!1,null,null,null);s.default=r.exports}}]);