(window.webpackJsonp=window.webpackJsonp||[]).push([[127],{532:function(t,e,a){"use strict";a.r(e);var s=a(2),l=Object(s.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h2",{attrs:{id:"记录一次-elk问题"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#记录一次-elk问题"}},[t._v("#")]),t._v(" 记录一次 ELK问题")]),t._v(" "),e("h3",{attrs:{id:"问题现象"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#问题现象"}},[t._v("#")]),t._v(" 问题现象")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("代码更新后，出现大量写日志情况。")])]),t._v(" "),e("li",[e("p",[t._v("ELK 服务器日志量增大， 存储空间占用量高达 95%")])]),t._v(" "),e("li",[e("p",[t._v("核心业务服务器  CPU 飙升")])]),t._v(" "),e("li",[e("p",[t._v("代码修复后，CPU 降低")])]),t._v(" "),e("li",[e("p",[t._v("ELK存储较低， 删除ELK  索引  几天，腾出空间。")])])]),t._v(" "),e("blockquote",[e("p",[t._v("所有事情都处理完，以为没有什么事了，")])]),t._v(" "),e("p",[t._v("**结果查看  ELK **   "),e("strong",[t._v("CPU及 网络流量  仍旧居高不下")])]),t._v(" "),e("p",[e("img",{attrs:{src:"http://p3v4jqpee.bkt.clouddn.com/BM_elk-1.png",alt:"img"}})]),t._v(" "),e("h3",{attrs:{id:"分析"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#分析"}},[t._v("#")]),t._v(" 分析")]),t._v(" "),e("ol",[e("li",[e("p",[t._v("由于日志队列  还未跑完（等待10分钟没有恢复正常）  PASS")])]),t._v(" "),e("li",[e("p",[t._v("查看核心服务器，通过  htop 、iotop 等工具 发现")])])]),t._v(" "),e("ul",[e("li",[e("p",[t._v("filebeat   占用CPU 过高")])]),t._v(" "),e("li",[e("p",[t._v("查看filebeat日志 报错如下：")])])]),t._v(" "),e("div",{staticClass:"language-yml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("2018-06-13T23:59:25+08:00 WARN Can not index event (status=403)")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v('"type"'),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cluster_block_exception"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v('"reason"'),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"blocked by: [FORBIDDEN/12/index read-only / allow delete (api)];"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("p",[e("strong",[t._v("google  搜索")])]),t._v(" "),e("p",[t._v("https://github.com/ankane/searchkick/issues/1040")]),t._v(" "),e("p",[t._v("https://discuss.elastic.co/t/config-error-403-forbidden-blocked-by-forbidden-12-index-read-only-allow-delete-api-cluster-block-exception-blocked-by-forbidden-12-index-read-only-allow-delete-api/113361")]),t._v(" "),e("p",[t._v("通过查询，发现  "),e("code",[t._v("elasticsearch")]),t._v(" 当磁盘过满时候，会转为只读  无法再写入")]),t._v(" "),e("p",[t._v("但是"),e("code",[t._v("filebeat")]),t._v(" 队列依旧存在。")]),t._v(" "),e("p",[t._v("重启所有客户端 "),e("code",[t._v("filebeat")]),t._v(" 世界一下清净了。。")]),t._v(" "),e("p",[e("img",{attrs:{src:"http://p3v4jqpee.bkt.clouddn.com/BM-elk-2.png",alt:"img"}})]),t._v(" "),e("h2",{attrs:{id:"总结"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),e("ul",[e("li",[t._v("一定要监控es健康指标")]),t._v(" "),e("li",[t._v("对filebeat要做相应把控")]),t._v(" "),e("li",[t._v("尽量做到所有事情不影响线上业务")])])])}),[],!1,null,null,null);e.default=l.exports}}]);