(window.webpackJsonp=window.webpackJsonp||[]).push([[183],{588:function(s,a,t){"use strict";t.r(a);var e=t(2),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"svn-使用ldap"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#svn-使用ldap"}},[s._v("#")]),s._v(" SVN 使用LDAP")]),s._v(" "),a("h3",{attrs:{id:"介绍sasl"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#介绍sasl"}},[s._v("#")]),s._v(" 介绍SASL")]),s._v(" "),a("blockquote",[a("p",[s._v("简单认证与安全层是卡内基梅隆大学出品的一个开源软件（准确的说，是John Gardiner Myers写的），它将通用的身份验证和加密功能添加到任何网络协议，从1.5版本以后，Subversion（这是SVN的全称……）服务端和客户端都知道如何使用这个库。以下情况将决定SASL是否可用：如果你打算自行编译SVN并使SASL可用，那么必须安装2.1或者更高的SASL版本，并且保证在编译期间，你安装的SASL能被编译进程检测到。如果你使用预先编译好的二进制包，你需要联系维护者确定SASL特性支持已经被编译进去了。SASL使用各种模块来对应不同的身份验证系统：Kerberos (GSSAPI), NTLM, One-Time-Passwords (OTP), DIGEST-MD5, LDAP, Secure-Remote-Password (SRP)等，某种验证机制是否可用，取决于你是否拥有这种机制对应的模块。")])]),s._v(" "),a("p",[a("strong",[s._v("SVN 从LDAP 获取用户名和密码主要是用通过SASL服务器")])]),s._v(" "),a("h3",{attrs:{id:"安装与配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装与配置"}},[s._v("#")]),s._v(" 安装与配置")]),s._v(" "),a("p",[s._v("环境要求：\nCentos7 及以上")]),s._v(" "),a("h4",{attrs:{id:"安装相关组件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装相关组件"}},[s._v("#")]),s._v(" 安装相关组件")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" subversion cyrus-sasl cyrus-sasl-lib cyrus-sasl-plain\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"查看sasl版本和提供的验证模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看sasl版本和提供的验证模块"}},[s._v("#")]),s._v(" 查看SASL版本和提供的验证模块")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# saslauthd -v")]),s._v("\nsaslauthd "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.1")]),s._v(".26\nauthentication mechanisms: getpwent kerberos5 pam rimap shadow ldap httpform "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#此处提供了对LDAP的支持。")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h4",{attrs:{id:"修改sasl的用户验证方式为ldap"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改sasl的用户验证方式为ldap"}},[s._v("#")]),s._v(" 修改sasl的用户验证方式为ldap")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /etc/sysconfig/saslauthd /etc/sysconfig/saslauthd.save\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/MECH=pam/MECH=ldap/'")]),s._v(" /etc/sysconfig/saslauthd\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"修改sasl配置文件-etc-saslauthd-conf"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改sasl配置文件-etc-saslauthd-conf"}},[s._v("#")]),s._v(" 修改sasl配置文件/etc/saslauthd.conf")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("ldap_servers: ldap://ldapserver   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#填写你的服务器，域名或者IP均可，前提是你的DNS能正常工作  ")]),s._v("\nldap_default_domain:domain.com    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#默认域名")]),s._v("\nldap_search_base:DC"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("domain,dc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("com "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#具体 OU信息")]),s._v("\nldap_bind_dn:domain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("user "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 域控可以访问的用户名")]),s._v("\nldap_password:password\nldap_deref: never\nldap_restart: "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\nldap_scope: sub\nldap_use_sasl: no\nldap_start_tls: no\nldap_version: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\nldap_auth_method: "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("bind")]),s._v("\nldap_mech: DIGEST-MD5\nldap_filter:sAMAccountName"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("%u  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 获取英文名")]),s._v("\nldap_password_attr:userPassword\nldap_timeout: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\nldap_cache_ttl: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("\nldap_cache_mem: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32786")]),s._v("\n此处是填写的LDAP协议的各个要素。\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("h4",{attrs:{id:"重启sasl服务以应用配置文件并测试是否通过"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#重启sasl服务以应用配置文件并测试是否通过"}},[s._v("#")]),s._v(" 重启sasl服务以应用配置文件并测试是否通过")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("systemctl restart saslauthd.service\ntestsaslauthd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" user "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'password'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#添加测试的用户名和密码")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"修改svn的sasl配置文件-etc-sasl-svn-conf"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改svn的sasl配置文件-etc-sasl-svn-conf"}},[s._v("#")]),s._v(" 修改SVN的sasl配置文件/etc/sasl/svn.conf")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/sasl2/svn.conf\n   pwcheck_method:saslauthd "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#用户验证方法")]),s._v("\n   mech_list: plain login  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#用户验证信息怎么传输")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h4",{attrs:{id:"修改版本库的配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改版本库的配置"}},[s._v("#")]),s._v(" 修改版本库的配置")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /yourrepository/conf/svnserve.conf  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## SVN 具体库地址 配置信息修改")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("general"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n anon-access "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" none\n auth-access "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#password-db = passwd #关闭passwd")]),s._v("\n authz-db "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" authz "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果要对版本库进行权限控制，开启authz")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("sasl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n use-sasl "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#开启sasl用户验证")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h4",{attrs:{id:"重启svn-测试一下即可"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#重启svn-测试一下即可"}},[s._v("#")]),s._v(" 重启SVN,测试一下即可")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("svnserve "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-r")]),s._v("  /data/svn  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 具体仓库地址")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("/path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nusername "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r\nusername "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" rw "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#没写就是没权限……用@符号表示用户组，用户组的创建就是")]),s._v("\ngroupname "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" user1,user2,\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("blockquote",[a("p",[s._v("测试通过  搞定收工\n注意点： LDAP确认网络可以使用；  确认登录的LDAP用户可以获取正常的OU信息")])])])}),[],!1,null,null,null);a.default=n.exports}}]);