(window.webpackJsonp=window.webpackJsonp||[]).push([[149],{553:function(s,t,a){"use strict";a.r(t);var n=a(2),r=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"zabbix-自定义邮件发送脚本-python"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#zabbix-自定义邮件发送脚本-python"}},[s._v("#")]),s._v(" Zabbix 自定义邮件发送脚本（Python）")]),s._v(" "),t("h3",{attrs:{id:"zabbix添加处理方法-管理-处理方法-create-media-type"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#zabbix添加处理方法-管理-处理方法-create-media-type"}},[s._v("#")]),s._v(" Zabbix添加处理方法：管理——处理方法——create media type")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://img.liuwenqi.com/blog/2019-09-25-092052.jpg",alt:""}})]),s._v(" "),t("p",[s._v("zabbix会传给脚本三个参数：接收用户，邮件主题，邮件内容")]),s._v(" "),t("p",[s._v("脚本名称"),t("code",[s._v("zabbix_sendmail.py")])]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/usr/bin/python")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#coding:utf-8")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" smtplib\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" email"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mime"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("text "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" MIMEText\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" sys\n\nmail_host "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'smtp.163.com'")]),s._v("\nmail_user "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'username'")]),s._v("\nmail_pass "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'password'")]),s._v("\nmail_postfix "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'163.com'")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("send_mail")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("to_list"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("subject"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("content"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    me "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" mail_user"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("mail_user"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"@"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("mail_postfix"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('">"')]),s._v("\n    msg "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" MIMEText"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("content"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Subject'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" subject\n    msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'From'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" me\n    msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'to'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" to_list\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        s "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" smtplib"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SMTP"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("connect"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mail_host"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("login"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mail_user"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("mail_pass"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sendmail"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("me"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("to_list"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("as_string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("close"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("except")]),s._v(" Exception"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("str")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("False")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" __name__ "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"__main__"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n    send_mail"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sys"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("argv"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" sys"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("argv"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" sys"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("argv"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br")])]),t("h3",{attrs:{id:"添加触发设置-系统配置-操作-create-action"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#添加触发设置-系统配置-操作-create-action"}},[s._v("#")]),s._v(" 添加触发设置：系统配置——操作——create action")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://img.liuwenqi.com/blog/2019-09-25-092300.jpg",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"http://img.liuwenqi.com/blog/2019-09-25-092310.jpg",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"http://img.liuwenqi.com/blog/2019-09-25-092323.jpg",alt:""}})]),s._v(" "),t("h3",{attrs:{id:"zabbix-server添加脚本配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#zabbix-server添加脚本配置"}},[s._v("#")]),s._v(" zabbix_server添加脚本配置")]),s._v(" "),t("p",[t("code",[s._v("mkdir -p /usr/local/zabbix/scripts")])]),s._v(" "),t("ul",[t("li",[s._v("把脚本上传到该目录")])]),s._v(" "),t("p",[s._v("修改"),t("code",[s._v("zabbix_server.conf")]),s._v("配置：")]),s._v(" "),t("p",[t("code",[s._v("AlertScriptsPath=/usr/local/zabbix/scripts")])]),s._v(" "),t("p",[t("strong",[s._v("然后重启服务")])]),s._v(" "),t("h3",{attrs:{id:"zabbix-server添加脚本配置-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#zabbix-server添加脚本配置-2"}},[s._v("#")]),s._v(" zabbix_server添加脚本配置：")]),s._v(" "),t("p",[t("code",[s._v("mkdir -p /usr/local/zabbix/scripts")])]),s._v(" "),t("p",[s._v("把脚本上传到该目录")]),s._v(" "),t("p",[s._v("修改zabbix_server.conf配置：")]),s._v(" "),t("p",[t("code",[s._v("AlertScriptsPath=/usr/local/zabbix/scripts")])]),s._v(" "),t("p",[t("strong",[s._v("然后重启服务")])])])}),[],!1,null,null,null);t.default=r.exports}}]);