(window.webpackJsonp=window.webpackJsonp||[]).push([[153],{561:function(s,t,a){"use strict";a.r(t);var n=a(2),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("[TOC]")]),s._v(" "),t("p",[t("code",[s._v("Nginx")]),s._v(" æ˜¯ä¸€æ¬¾é¢å‘æ€§èƒ½è®¾è®¡çš„ HTTP æœåŠ¡å™¨ï¼Œèƒ½åå‘ä»£ç† HTTPï¼ŒHTTPS å’Œé‚®ä»¶ç›¸å…³(SMTPï¼ŒPOP3ï¼ŒIMAP)çš„åè®®é“¾æ¥ã€‚å¹¶ä¸”æä¾›äº†è´Ÿè½½å‡è¡¡ä»¥åŠ HTTP ç¼“å­˜ã€‚å®ƒçš„è®¾è®¡å……åˆ†ä½¿ç”¨å¼‚æ­¥äº‹ä»¶æ¨¡å‹ï¼Œå‰Šå‡ä¸Šä¸‹æ–‡è°ƒåº¦çš„å¼€é”€ï¼Œæé«˜æœåŠ¡å™¨å¹¶å‘èƒ½åŠ›ã€‚é‡‡ç”¨äº†æ¨¡å—åŒ–è®¾è®¡ï¼Œæä¾›äº†ä¸°å¯Œæ¨¡å—çš„ç¬¬ä¸‰æ–¹æ¨¡å—ã€‚")]),s._v(" "),t("p",[s._v("æ‰€ä»¥å…³äº Nginxï¼Œæœ‰è¿™äº›æ ‡ç­¾ï¼šã€Œå¼‚æ­¥ã€ã€Œäº‹ä»¶ã€ã€Œæ¨¡å—åŒ–ã€ã€Œé«˜æ€§èƒ½ã€ã€Œé«˜å¹¶å‘ã€ã€Œåå‘ä»£ç†ã€ã€Œè´Ÿè½½å‡è¡¡ã€")]),s._v(" "),t("p",[s._v("Linuxç³»ç»Ÿï¼š"),t("code",[s._v("Centos 7 x64")]),s._v("\nNginxç‰ˆæœ¬ï¼š"),t("code",[s._v("1.11.5")])]),s._v(" "),t("h2",{attrs:{id:"å®‰è£…"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å®‰è£…"}},[s._v("#")]),s._v(" å®‰è£…")]),s._v(" "),t("h3",{attrs:{id:"å®‰è£…ä¾èµ–"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å®‰è£…ä¾èµ–"}},[s._v("#")]),s._v(" å®‰è£…ä¾èµ–")]),s._v(" "),t("blockquote",[t("p",[s._v("prce(é‡å®šå‘æ”¯æŒ)å’Œopenssl(httpsæ”¯æŒï¼Œå¦‚æœä¸éœ€è¦httpså¯ä»¥ä¸å®‰è£…ã€‚)")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" pcre-devel \nyum "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" gcc "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" gcc-c++ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v("\nyum "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" openssl openssl-devel \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("CentOS 6.5 æˆ‘å®‰è£…çš„æ—¶å€™æ˜¯é€‰æ‹©çš„â€œåŸºæœ¬æœåŠ¡å™¨â€ï¼Œé»˜è®¤è¿™ä¸¤ä¸ªåŒ…éƒ½æ²¡å®‰è£…å…¨ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªéƒ½è¿è¡Œå®‰è£…å³å¯ã€‚")]),s._v(" "),t("h3",{attrs:{id:"ä¸‹è½½"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¸‹è½½"}},[s._v("#")]),s._v(" ä¸‹è½½")]),s._v(" "),t("p",[t("a",{attrs:{href:"http://nginx.org/download/",target:"_blank",rel:"noopener noreferrer"}},[s._v("nginxçš„æ‰€æœ‰ç‰ˆæœ¬åœ¨è¿™é‡Œ"),t("OutboundLink")],1)]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" http://nginx.org/download/nginx-1.13.3.tar.gz\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" http://nginx.org/download/nginx-1.13.7.tar.gz\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å¦‚æœæ²¡æœ‰å®‰è£…wget")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ä¸‹è½½å·²ç¼–è¯‘ç‰ˆæœ¬")]),s._v("\n$ yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è§£å‹å‹ç¼©åŒ…")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" zxf nginx-1.13.3.tar.gz\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h3",{attrs:{id:"ç¼–è¯‘å®‰è£…"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç¼–è¯‘å®‰è£…"}},[s._v("#")]),s._v(" ç¼–è¯‘å®‰è£…")]),s._v(" "),t("p",[s._v("ç„¶åè¿›å…¥ç›®å½•ç¼–è¯‘å®‰è£…ï¼Œ"),t("a",{attrs:{href:"#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E"}},[s._v("configureå‚æ•°è¯´æ˜")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" nginx-1.11.5\n./configure\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\nConfiguration summary\n  + using system PCRE library\n  + OpenSSL library is not used\n  + using system zlib library\n\n  nginx path prefix: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/nginx"')]),s._v("\n  nginx binary file: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/nginx/sbin/nginx"')]),s._v("\n  nginx modules path: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/nginx/modules"')]),s._v("\n  nginx configuration prefix: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/nginx/conf"')]),s._v("\n  nginx configuration file: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/nginx/conf/nginx.conf"')]),s._v("\n  nginx pid file: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/nginx/logs/nginx.pid"')]),s._v("\n  nginx error log file: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/nginx/logs/error.log"')]),s._v("\n  nginx http access log file: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/nginx/logs/access.log"')]),s._v("\n  nginx http client request body temporary files: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"client_body_temp"')]),s._v("\n  nginx http proxy temporary files: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"proxy_temp"')]),s._v("\n  nginx http fastcgi temporary files: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"fastcgi_temp"')]),s._v("\n  nginx http uwsgi temporary files: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"uwsgi_temp"')]),s._v("\n  nginx http scgi temporary files: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"scgi_temp"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br")])]),t("p",[s._v("å®‰è£…æŠ¥é”™è¯¯çš„è¯æ¯”å¦‚ï¼šâ€œC compiler cc is not foundâ€ï¼Œè¿™ä¸ªå°±æ˜¯ç¼ºå°‘ç¼–è¯‘ç¯å¢ƒï¼Œå®‰è£…ä¸€ä¸‹å°±å¯ä»¥äº† "),t("strong",[s._v("yum -y install gcc make gcc-c++ openssl-devel")])]),s._v(" "),t("p",[s._v("å¦‚æœæ²¡æœ‰errorä¿¡æ¯ï¼Œå°±å¯ä»¥æ‰§è¡Œä¸‹è¾¹çš„å®‰è£…äº†ï¼š")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"nginxæµ‹è¯•"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginxæµ‹è¯•"}},[s._v("#")]),s._v(" nginxæµ‹è¯•")]),s._v(" "),t("p",[s._v("è¿è¡Œä¸‹é¢å‘½ä»¤ä¼šå‡ºç°ä¸¤ä¸ªç»“æœï¼Œä¸€èˆ¬æƒ…å†µnginxä¼šå®‰è£…åœ¨"),t("code",[s._v("/usr/local/nginx")]),s._v("ç›®å½•ä¸­")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/nginx/sbin/\n./nginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nginx: configuration file /usr/local/nginx/conf/nginx.conf test is successful")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"è®¾ç½®å…¨å±€nginxå‘½ä»¤"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#è®¾ç½®å…¨å±€nginxå‘½ä»¤"}},[s._v("#")]),s._v(" è®¾ç½®å…¨å±€nginxå‘½ä»¤")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" ~/.bash_profile\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("å°†ä¸‹é¢å†…å®¹æ·»åŠ åˆ° "),t("code",[s._v("~/.bash_profile")]),s._v(" æ–‡ä»¶ä¸­")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/bin:/usr/local/nginx/sbin/\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("è¿è¡Œå‘½ä»¤ "),t("strong",[t("code",[s._v("source ~/.bash_profile")])]),s._v(" è®©é…ç½®ç«‹å³ç”Ÿæ•ˆã€‚ä½ å°±å¯ä»¥å…¨å±€è¿è¡Œ "),t("code",[s._v("nginx")]),s._v(" å‘½ä»¤äº†ã€‚")]),s._v(" "),t("h2",{attrs:{id:"mac-å®‰è£…"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mac-å®‰è£…"}},[s._v("#")]),s._v(" Mac å®‰è£…")]),s._v(" "),t("p",[s._v("Mac OSX å®‰è£…ç‰¹åˆ«ç®€å•ï¼Œé¦–å…ˆä½ éœ€è¦å®‰è£… "),t("a",{attrs:{href:"https://brew.sh/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Brew"),t("OutboundLink")],1),s._v("ï¼Œ é€šè¿‡ "),t("code",[s._v("brew")]),s._v(" å¿«é€Ÿå®‰è£… "),t("code",[s._v("nginx")]),s._v("ã€‚")]),s._v(" "),t("h3",{attrs:{id:"å®‰è£…nginx"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å®‰è£…nginx"}},[s._v("#")]),s._v(" å®‰è£…nginx")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("brew "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" nginx\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Updating Homebrew...")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ==> Auto-updated Homebrew!")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Updated 2 taps (homebrew/core, homebrew/cask).")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ==> Updated Formulae")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ==> Installing dependencies for nginx: openssl, pcre")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ==> Installing nginx dependency: openssl")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ==> Downloading https://homebrew.bintray.com/bottles/openssl-1.0.2o_1.high_sierra.bottle.tar.gz")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ######################################################################## 100.0%")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ==> Pouring openssl-1.0.2o_1.high_sierra.bottle.tar.gz")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ==> Caveats")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# A CA file has been bootstrapped using certificates from the SystemRoots")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# keychain. To add additional certificates (e.g. the certificates added in")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# the System keychain), place .pem files in")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   /usr/local/etc/openssl/certs")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# and run")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   /usr/local/opt/openssl/bin/c_rehash")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# This formula is keg-only, which means it was not symlinked into /usr/local,")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# because Apple has deprecated use of OpenSSL in favor of its own TLS and crypto libraries.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# If you need to have this software first in your PATH run:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   echo 'export PATH=\"/usr/local/opt/openssl/bin:$PATH\"' >> ~/.zshrc")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# For compilers to find this software you may need to set:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     LDFLAGS:  -L/usr/local/opt/openssl/lib")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     CPPFLAGS: -I/usr/local/opt/openssl/include")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# For pkg-config to find this software you may need to set:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     PKG_CONFIG_PATH: /usr/local/opt/openssl/lib/pkgconfig")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ==> Summary")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ğŸº  /usr/local/Cellar/openssl/1.0.2o_1: 1,791 files, 12.3MB")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ==> Installing nginx dependency: pcre")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ==> Downloading https://homebrew.bintray.com/bottles/pcre-8.42.high_sierra.bottle.tar.gz")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ######################################################################## 100.0%")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ==> Pouring pcre-8.42.high_sierra.bottle.tar.gz")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ğŸº  /usr/local/Cellar/pcre/8.42: 204 files, 5.3MB")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ==> Installing nginx")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ==> Downloading https://homebrew.bintray.com/bottles/nginx-1.13.12.high_sierra.bottle.tar.gz")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ######################################################################## 100.0%")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ==> Pouring nginx-1.13.12.high_sierra.bottle.tar.gz")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ==> Caveats")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Docroot is: /usr/local/var/www")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The default port has been set in /usr/local/etc/nginx/nginx.conf to 8080 so that")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nginx can run without sudo.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nginx will load all files in /usr/local/etc/nginx/servers/.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# To have launchd start nginx now and restart at login:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   brew services start nginx")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Or, if you don't wacd /usr/local/Cellar/nginx/1.13.12/n just run:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd /usr/local/Cellar/nginx/1.13.12/")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br")])]),t("h3",{attrs:{id:"å¯åŠ¨æœåŠ¡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¯åŠ¨æœåŠ¡"}},[s._v("#")]),s._v(" å¯åŠ¨æœåŠ¡")]),s._v(" "),t("p",[s._v("æ³¨æ„é»˜è®¤ç«¯å£ä¸æ˜¯ "),t("code",[s._v("8080")]),s._v(" æŸ¥çœ‹ç¡®è®¤ç«¯å£æ˜¯å¦è¢«å ç”¨ã€‚")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("brew services start nginx\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# http://localhost:8080/")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h2",{attrs:{id:"å¼€æœºè‡ªå¯åŠ¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¼€æœºè‡ªå¯åŠ¨"}},[s._v("#")]),s._v(" å¼€æœºè‡ªå¯åŠ¨")]),s._v(" "),t("p",[t("strong",[s._v("å¼€æœºè‡ªå¯åŠ¨æ–¹æ³•ä¸€ï¼š")])]),s._v(" "),t("p",[s._v("ç¼–è¾‘ "),t("strong",[s._v("vi /lib/systemd/system/nginx.service")]),s._v(" æ–‡ä»¶ï¼Œæ²¡æœ‰åˆ›å»ºä¸€ä¸ª "),t("strong",[s._v("touch nginx.service")]),s._v(" ç„¶åå°†å¦‚ä¸‹å†…å®¹æ ¹æ®å…·ä½“æƒ…å†µè¿›è¡Œä¿®æ”¹åï¼Œæ·»åŠ åˆ°nginx.serviceæ–‡ä»¶ä¸­ï¼š")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Description")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("After")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("network.target remote-fs.target nss-lookup.target\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Type")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("forking\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PIDFile")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/run/nginx.pid\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStartPre")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/nginx/sbin/nginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" /usr/local/nginx/conf/nginx.conf\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/nginx/sbin/nginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" /usr/local/nginx/conf/nginx.conf\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecReload")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/bin/kill "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" HUP "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$MAINPID")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStop")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/bin/kill "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" QUIT "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$MAINPID")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PrivateTmp")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("WantedBy")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("multi-user.target\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("ul",[t("li",[t("code",[s._v("[Unit]")]),s._v(":æœåŠ¡çš„è¯´æ˜")]),s._v(" "),t("li",[t("code",[s._v("Description")]),s._v(":æè¿°æœåŠ¡")]),s._v(" "),t("li",[t("code",[s._v("After")]),s._v(":æè¿°æœåŠ¡ç±»åˆ«")]),s._v(" "),t("li",[t("code",[s._v("[Service]")]),s._v("æœåŠ¡è¿è¡Œå‚æ•°çš„è®¾ç½®")]),s._v(" "),t("li",[t("code",[s._v("Type=forking")]),s._v("æ˜¯åå°è¿è¡Œçš„å½¢å¼")]),s._v(" "),t("li",[t("code",[s._v("ExecStart")]),s._v("ä¸ºæœåŠ¡çš„å…·ä½“è¿è¡Œå‘½ä»¤")]),s._v(" "),t("li",[t("code",[s._v("ExecReload")]),s._v("ä¸ºé‡å¯å‘½ä»¤")]),s._v(" "),t("li",[t("code",[s._v("ExecStop")]),s._v("ä¸ºåœæ­¢å‘½ä»¤")]),s._v(" "),t("li",[t("code",[s._v("PrivateTmp=True")]),s._v("è¡¨ç¤ºç»™æœåŠ¡åˆ†é…ç‹¬ç«‹çš„ä¸´æ—¶ç©ºé—´")])]),s._v(" "),t("p",[s._v("æ³¨æ„ï¼š"),t("code",[s._v("[Service]")]),s._v("çš„å¯åŠ¨ã€é‡å¯ã€åœæ­¢å‘½ä»¤å…¨éƒ¨è¦æ±‚ä½¿ç”¨ç»å¯¹è·¯å¾„ã€‚")]),s._v(" "),t("p",[t("code",[s._v("[Install]")]),s._v("è¿è¡Œçº§åˆ«ä¸‹æœåŠ¡å®‰è£…çš„ç›¸å…³è®¾ç½®ï¼Œå¯è®¾ç½®ä¸ºå¤šç”¨æˆ·ï¼Œå³ç³»ç»Ÿè¿è¡Œçº§åˆ«ä¸º"),t("code",[s._v("3")]),s._v("ã€‚")]),s._v(" "),t("p",[s._v("ä¿å­˜é€€å‡ºã€‚")]),s._v(" "),t("p",[s._v("è®¾ç½®å¼€æœºå¯åŠ¨ï¼Œä½¿é…ç½®ç”Ÿæ•ˆï¼š")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å¯åŠ¨nginxæœåŠ¡")]),s._v("\nsystemctl start nginx.service\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åœæ­¢å¼€æœºè‡ªå¯åŠ¨")]),s._v("\nsystemctl disable nginx.service\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æŸ¥çœ‹æœåŠ¡å½“å‰çŠ¶æ€")]),s._v("\nsystemctl status nginx.service\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æŸ¥çœ‹æ‰€æœ‰å·²å¯åŠ¨çš„æœåŠ¡")]),s._v("\nsystemctl list-units "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--type")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("service\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é‡æ–°å¯åŠ¨æœåŠ¡")]),s._v("\nsystemctl restart nginx.service\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è®¾ç½®å¼€æœºè‡ªå¯åŠ¨")]),s._v("\nsystemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" nginx.service\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è¾“å‡ºä¸‹é¢å†…å®¹è¡¨ç¤ºæˆåŠŸäº†")]),s._v("\nCreated symlink from /etc/systemd/system/multi-user.target.wants/nginx.service to /usr/lib/systemd/system/nginx.service.\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("systemctl is-enabled servicename.service "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æŸ¥è¯¢æœåŠ¡æ˜¯å¦å¼€æœºå¯åŠ¨")]),s._v("\nsystemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" *.service "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å¼€æœºè¿è¡ŒæœåŠ¡")]),s._v("\nsystemctl disable *.service "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å–æ¶ˆå¼€æœºè¿è¡Œ")]),s._v("\nsystemctl start *.service "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å¯åŠ¨æœåŠ¡")]),s._v("\nsystemctl stop *.service "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åœæ­¢æœåŠ¡")]),s._v("\nsystemctl restart *.service "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é‡å¯æœåŠ¡")]),s._v("\nsystemctl reload *.service "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é‡æ–°åŠ è½½æœåŠ¡é…ç½®æ–‡ä»¶")]),s._v("\nsystemctl status *.service "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æŸ¥è¯¢æœåŠ¡è¿è¡ŒçŠ¶æ€")]),s._v("\nsystemctl "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--failed")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ˜¾ç¤ºå¯åŠ¨å¤±è´¥çš„æœåŠ¡")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("æ³¨ï¼š*ä»£è¡¨æŸä¸ªæœåŠ¡çš„åå­—ï¼Œå¦‚httpçš„æœåŠ¡åä¸ºhttpd")]),s._v(" "),t("p",[t("strong",[s._v("å¼€æœºè‡ªå¯åŠ¨æ–¹æ³•äºŒï¼š")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/rc.local\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åœ¨ rc.local æ–‡ä»¶ä¸­ï¼Œæ·»åŠ ä¸‹é¢è¿™æ¡å‘½ä»¤")]),s._v("\n/usr/local/nginx/sbin/nginx start\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("å¦‚æœå¼€æœºåå‘ç°è‡ªå¯åŠ¨è„šæœ¬æ²¡æœ‰æ‰§è¡Œï¼Œä½ è¦å»ç¡®è®¤ä¸€ä¸‹rc.localè¿™ä¸ªæ–‡ä»¶çš„è®¿é—®æƒé™æ˜¯å¦æ˜¯å¯æ‰§è¡Œçš„ï¼Œå› ä¸ºrc.localé»˜è®¤æ˜¯ä¸å¯æ‰§è¡Œçš„ã€‚ä¿®æ”¹rc.localè®¿é—®æƒé™ï¼Œå¢åŠ å¯æ‰§è¡Œæƒé™ï¼š")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /etc/rc.localæ˜¯/etc/rc.d/rc.localçš„è½¯è¿æ¥ï¼Œ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x /etc/rc.d/rc.local\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("å®˜æ–¹è„šæœ¬ "),t("a",{attrs:{href:"https://www.nginx.com/resources/wiki/start/topics/examples/redhatnginxinit/",target:"_blank",rel:"noopener noreferrer"}},[s._v("ed Hat NGINX Init Script"),t("OutboundLink")],1),s._v("ã€‚")]),s._v(" "),t("h2",{attrs:{id:"è¿ç»´"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#è¿ç»´"}},[s._v("#")]),s._v(" è¿ç»´")]),s._v(" "),t("h3",{attrs:{id:"æœåŠ¡ç®¡ç†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æœåŠ¡ç®¡ç†"}},[s._v("#")]),s._v(" æœåŠ¡ç®¡ç†")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å¯åŠ¨")]),s._v("\n/usr/local/nginx/sbin/nginx\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é‡å¯")]),s._v("\n/usr/local/nginx/sbin/nginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" reload\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å…³é—­è¿›ç¨‹")]),s._v("\n/usr/local/nginx/sbin/nginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" stop\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å¹³æ»‘å…³é—­nginx")]),s._v("\n/usr/local/nginx/sbin/nginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" quit\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æŸ¥çœ‹nginxçš„å®‰è£…çŠ¶æ€ï¼Œ")]),s._v("\n/usr/local/nginx/sbin/nginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-V")]),s._v(" \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("p",[t("strong",[s._v("å…³é—­é˜²ç«å¢™ï¼Œæˆ–è€…æ·»åŠ é˜²ç«å¢™è§„åˆ™å°±å¯ä»¥æµ‹è¯•äº†")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" iptables stop\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("æˆ–è€…ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/sysconfig/iptables\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("æ·»åŠ è¿™æ ·ä¸€æ¡å¼€æ”¾80ç«¯å£çš„è§„åˆ™åä¿å­˜ï¼š")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-A")]),s._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" state "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--state")]),s._v(" NEW "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--dport")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-j")]),s._v(" ACCEPT\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("é‡å¯æœåŠ¡å³å¯:")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" iptables restart\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å‘½ä»¤è¿›è¡ŒæŸ¥çœ‹ç›®å‰nat")]),s._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" nat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-L")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"é‡å¯æœåŠ¡é˜²ç«å¢™æŠ¥é”™è§£å†³"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é‡å¯æœåŠ¡é˜²ç«å¢™æŠ¥é”™è§£å†³"}},[s._v("#")]),s._v(" é‡å¯æœåŠ¡é˜²ç«å¢™æŠ¥é”™è§£å†³")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" iptables restart\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Redirecting to /bin/systemctl restart  iptables.service")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Failed to restart iptables.service: Unit iptables.service failed to load: No such file or directory.")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("åœ¨CentOS 7æˆ–RHEL 7æˆ–Fedoraä¸­é˜²ç«å¢™ç”± "),t("strong",[s._v("firewalld")]),s._v(" æ¥ç®¡ç†ï¼Œå½“ç„¶ä½ å¯ä»¥è¿˜åŸä¼ ç»Ÿçš„ç®¡ç†æ–¹å¼ã€‚æˆ–åˆ™ä½¿ç”¨æ–°çš„å‘½ä»¤è¿›è¡Œç®¡ç†ã€‚\nå‡å¦‚é‡‡ç”¨ä¼ ç»Ÿè¯·æ‰§è¡Œä¸€ä¸‹å‘½ä»¤ï¼š")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ä¼ ç»Ÿå‘½ä»¤")]),s._v("\nsystemctl stop firewalld\nsystemctl mask firewalld\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å®‰è£…å‘½ä»¤")]),s._v("\nyum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" iptables-services\n\nsystemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" iptables \n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" iptables restart\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h2",{attrs:{id:"nginxå¸è½½"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginxå¸è½½"}},[s._v("#")]),s._v(" nginxå¸è½½")]),s._v(" "),t("p",[s._v("å¦‚æœé€šè¿‡yumå®‰è£…ï¼Œä½¿ç”¨ä¸‹é¢å‘½ä»¤å®‰è£…ã€‚")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("yum remove nginx\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("ç¼–è¯‘å®‰è£…ï¼Œåˆ é™¤/usr/local/nginxç›®å½•å³å¯\nå¦‚æœé…ç½®äº†è‡ªå¯åŠ¨è„šæœ¬ï¼Œä¹Ÿéœ€è¦åˆ é™¤ã€‚")]),s._v(" "),t("h2",{attrs:{id:"å‚æ•°è¯´æ˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å‚æ•°è¯´æ˜"}},[s._v("#")]),s._v(" å‚æ•°è¯´æ˜")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("å‚æ•°")]),s._v(" "),t("th",[s._v("è¯´æ˜")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("--prefix="),t("code",[s._v("<path>")])]),s._v(" "),t("td",[s._v("Nginxå®‰è£…è·¯å¾„ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä¸º /usr/local/nginxã€‚")])]),s._v(" "),t("tr",[t("td",[s._v("--sbin-path="),t("code",[s._v("<path>")])]),s._v(" "),t("td",[s._v("Nginxå¯æ‰§è¡Œæ–‡ä»¶å®‰è£…è·¯å¾„ã€‚åªèƒ½å®‰è£…æ—¶æŒ‡å®šï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä¸º"),t("code",[s._v("<prefix>")]),s._v("/sbin/nginxã€‚")])]),s._v(" "),t("tr",[t("td",[s._v("--conf-path="),t("code",[s._v("<path>")])]),s._v(" "),t("td",[s._v("åœ¨æ²¡æœ‰ç»™å®š-cé€‰é¡¹ä¸‹é»˜è®¤çš„nginx.confçš„è·¯å¾„ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä¸º"),t("code",[s._v("<prefix>")]),s._v("/conf/nginx.confã€‚")])]),s._v(" "),t("tr",[t("td",[s._v("--pid-path="),t("code",[s._v("<path>")])]),s._v(" "),t("td",[s._v("åœ¨nginx.confä¸­æ²¡æœ‰æŒ‡å®špidæŒ‡ä»¤çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤çš„nginx.pidçš„è·¯å¾„ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä¸º "),t("code",[s._v("<prefix>")]),s._v("/logs/nginx.pidã€‚")])]),s._v(" "),t("tr",[t("td",[s._v("--lock-path="),t("code",[s._v("<path>")])]),s._v(" "),t("td",[s._v("nginx.lockæ–‡ä»¶çš„è·¯å¾„ã€‚")])]),s._v(" "),t("tr",[t("td",[s._v("--error-log-path="),t("code",[s._v("<path>")])]),s._v(" "),t("td",[s._v("åœ¨nginx.confä¸­æ²¡æœ‰æŒ‡å®šerror_logæŒ‡ä»¤çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤çš„é”™è¯¯æ—¥å¿—çš„è·¯å¾„ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä¸º "),t("code",[s._v("<prefix>")]),s._v("/- logs/error.logã€‚")])]),s._v(" "),t("tr",[t("td",[s._v("--http-log-path="),t("code",[s._v("<path>")])]),s._v(" "),t("td",[s._v("åœ¨nginx.confä¸­æ²¡æœ‰æŒ‡å®šaccess_logæŒ‡ä»¤çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤çš„è®¿é—®æ—¥å¿—çš„è·¯å¾„ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä¸º "),t("code",[s._v("<prefix>")]),s._v("/- logs/access.logã€‚")])]),s._v(" "),t("tr",[t("td",[s._v("--user="),t("code",[s._v("<user>")])]),s._v(" "),t("td",[s._v("åœ¨nginx.confä¸­æ²¡æœ‰æŒ‡å®šuseræŒ‡ä»¤çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤çš„nginxä½¿ç”¨çš„ç”¨æˆ·ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä¸º nobodyã€‚")])]),s._v(" "),t("tr",[t("td",[s._v("--group="),t("code",[s._v("<group>")])]),s._v(" "),t("td",[s._v("åœ¨nginx.confä¸­æ²¡æœ‰æŒ‡å®šuseræŒ‡ä»¤çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤çš„nginxä½¿ç”¨çš„ç»„ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä¸º nobodyã€‚")])]),s._v(" "),t("tr",[t("td",[s._v("--builddir=DIR")]),s._v(" "),t("td",[s._v("æŒ‡å®šç¼–è¯‘çš„ç›®å½•")])]),s._v(" "),t("tr",[t("td",[s._v("--with-rtsig_module")]),s._v(" "),t("td",[s._v("å¯ç”¨ rtsig æ¨¡å—")])]),s._v(" "),t("tr",[t("td",[s._v("--with-select_module --without-select_module")]),s._v(" "),t("td",[s._v("å…è®¸æˆ–ä¸å…è®¸å¼€å¯SELECTæ¨¡å¼ï¼Œå¦‚æœ configure æ²¡æœ‰æ‰¾åˆ°æ›´åˆé€‚çš„æ¨¡å¼ï¼Œæ¯”å¦‚ï¼škqueue(sun os),epoll (linux kenel 2.6+), rtsig(- å®æ—¶ä¿¡å·)æˆ–è€…/dev/poll(ä¸€ç§ç±»ä¼¼selectçš„æ¨¡å¼ï¼Œåº•å±‚å®ç°ä¸SELECTåŸºæœ¬ç›¸ åŒï¼Œéƒ½æ˜¯é‡‡ç”¨è½®è®­æ–¹æ³•) SELECTæ¨¡å¼å°†æ˜¯é»˜è®¤å®‰è£…æ¨¡å¼")])]),s._v(" "),t("tr",[t("td",[s._v("--with-poll_module --without-poll_module")]),s._v(" "),t("td",[s._v("Whether or not to enable the poll module. This module is enabled by, default if a more suitable method such as kqueue, epoll, rtsig or /dev/poll is not discovered by configure.")])]),s._v(" "),t("tr",[t("td",[s._v("--with-http_ssl_module")]),s._v(" "),t("td",[s._v("Enable ngx_http_ssl_module. Enables SSL support and the ability to handle HTTPS requests. Requires OpenSSL. On Debian, this is libssl-dev. å¼€å¯HTTP SSLæ¨¡å—ï¼Œä½¿NGINXå¯ä»¥æ”¯æŒHTTPSè¯·æ±‚ã€‚è¿™ä¸ªæ¨¡å—éœ€è¦å·²ç»å®‰è£…äº†OPENSSLï¼Œåœ¨DEBIANä¸Šæ˜¯libssl")])]),s._v(" "),t("tr",[t("td",[s._v("--with-http_realip_module")]),s._v(" "),t("td",[s._v("å¯ç”¨ ngx_http_realip_module")])]),s._v(" "),t("tr",[t("td",[s._v("--with-http_addition_module")]),s._v(" "),t("td",[s._v("å¯ç”¨ ngx_http_addition_module")])]),s._v(" "),t("tr",[t("td",[s._v("--with-http_sub_module")]),s._v(" "),t("td",[s._v("å¯ç”¨ ngx_http_sub_module")])]),s._v(" "),t("tr",[t("td",[s._v("--with-http_dav_module")]),s._v(" "),t("td",[s._v("å¯ç”¨ ngx_http_dav_module")])]),s._v(" "),t("tr",[t("td",[s._v("--with-http_flv_module")]),s._v(" "),t("td",[s._v("å¯ç”¨ ngx_http_flv_module")])]),s._v(" "),t("tr",[t("td",[s._v("--with-http_stub_status_module")]),s._v(" "),t("td",[s._v('å¯ç”¨ "server status" é¡µ')])]),s._v(" "),t("tr",[t("td",[s._v("--without-http_charset_module")]),s._v(" "),t("td",[s._v("ç¦ç”¨ ngx_http_charset_module")])]),s._v(" "),t("tr",[t("td",[s._v("--without-http_gzip_module")]),s._v(" "),t("td",[s._v("ç¦ç”¨ ngx_http_gzip_module. å¦‚æœå¯ç”¨ï¼Œéœ€è¦ zlib ã€‚")])]),s._v(" "),t("tr",[t("td",[s._v("--without-http_ssi_module")]),s._v(" "),t("td",[s._v("ç¦ç”¨ ngx_http_ssi_module")])]),s._v(" "),t("tr",[t("td",[s._v("--without-http_userid_module")]),s._v(" "),t("td",[s._v("ç¦ç”¨ ngx_http_userid_module")])]),s._v(" "),t("tr",[t("td",[s._v("--without-http_access_module")]),s._v(" "),t("td",[s._v("ç¦ç”¨ ngx_http_access_module")])]),s._v(" "),t("tr",[t("td",[s._v("--without-http_auth_basic_module")]),s._v(" "),t("td",[s._v("ç¦ç”¨ ngx_http_auth_basic_module")])]),s._v(" "),t("tr",[t("td",[s._v("--without-http_autoindex_module")]),s._v(" "),t("td",[s._v("ç¦ç”¨ ngx_http_autoindex_module")])]),s._v(" "),t("tr",[t("td",[s._v("--without-http_geo_module")]),s._v(" "),t("td",[s._v("ç¦ç”¨ ngx_http_geo_module")])]),s._v(" "),t("tr",[t("td",[s._v("--without-http_map_module")]),s._v(" "),t("td",[s._v("ç¦ç”¨ ngx_http_map_module")])]),s._v(" "),t("tr",[t("td",[s._v("--without-http_referer_module")]),s._v(" "),t("td",[s._v("ç¦ç”¨ ngx_http_referer_module")])]),s._v(" "),t("tr",[t("td",[s._v("--without-http_rewrite_module")]),s._v(" "),t("td",[s._v("ç¦ç”¨ ngx_http_rewrite_module. å¦‚æœå¯ç”¨éœ€è¦ PCRE ã€‚")])]),s._v(" "),t("tr",[t("td",[s._v("--without-http_proxy_module")]),s._v(" "),t("td",[s._v("ç¦ç”¨ ngx_http_proxy_module")])]),s._v(" "),t("tr",[t("td",[s._v("--without-http_fastcgi_module")]),s._v(" "),t("td",[s._v("ç¦ç”¨ ngx_http_fastcgi_module")])]),s._v(" "),t("tr",[t("td",[s._v("--without-http_memcached_module")]),s._v(" "),t("td",[s._v("ç¦ç”¨ ngx_http_memcached_module")])]),s._v(" "),t("tr",[t("td",[s._v("--without-http_limit_zone_module")]),s._v(" "),t("td",[s._v("ç¦ç”¨ ngx_http_limit_zone_module")])]),s._v(" "),t("tr",[t("td",[s._v("--without-http_empty_gif_module")]),s._v(" "),t("td",[s._v("ç¦ç”¨ ngx_http_empty_gif_module")])]),s._v(" "),t("tr",[t("td",[s._v("--without-http_browser_module")]),s._v(" "),t("td",[s._v("ç¦ç”¨ ngx_http_browser_module")])]),s._v(" "),t("tr",[t("td",[s._v("--without-http_upstream_ip_hash_module")]),s._v(" "),t("td",[s._v("ç¦ç”¨ ngx_http_upstream_ip_hash_module")])]),s._v(" "),t("tr",[t("td",[s._v("--with-http_perl_module")]),s._v(" "),t("td",[s._v("å¯ç”¨ ngx_http_perl_module")])]),s._v(" "),t("tr",[t("td",[s._v("--with-perl_modules_path=PATH")]),s._v(" "),t("td",[s._v("æŒ‡å®š perl æ¨¡å—çš„è·¯å¾„")])]),s._v(" "),t("tr",[t("td",[s._v("--with-perl=PATH")]),s._v(" "),t("td",[s._v("æŒ‡å®š perl æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„")])]),s._v(" "),t("tr",[t("td",[s._v("--http-log-path=PATH")]),s._v(" "),t("td",[s._v("Set path to the http access log")])]),s._v(" "),t("tr",[t("td",[s._v("--http-client-body-temp-path=PATH")]),s._v(" "),t("td",[s._v("Set path to the http client request body temporary files")])]),s._v(" "),t("tr",[t("td",[s._v("--http-proxy-temp-path=PATH")]),s._v(" "),t("td",[s._v("Set path to the http proxy temporary files")])]),s._v(" "),t("tr",[t("td",[s._v("--http-fastcgi-temp-path=PATH")]),s._v(" "),t("td",[s._v("Set path to the http fastcgi temporary files")])]),s._v(" "),t("tr",[t("td",[s._v("--without-http")]),s._v(" "),t("td",[s._v("ç¦ç”¨ HTTP server")])]),s._v(" "),t("tr",[t("td",[s._v("--with-mail")]),s._v(" "),t("td",[s._v("å¯ç”¨ IMAP4/POP3/SMTP ä»£ç†æ¨¡å—")])]),s._v(" "),t("tr",[t("td",[s._v("--with-mail_ssl_module")]),s._v(" "),t("td",[s._v("å¯ç”¨ ngx_mail_ssl_module")])]),s._v(" "),t("tr",[t("td",[s._v("--with-cc=PATH")]),s._v(" "),t("td",[s._v("æŒ‡å®š C ç¼–è¯‘å™¨çš„è·¯å¾„")])]),s._v(" "),t("tr",[t("td",[s._v("--with-cpp=PATH")]),s._v(" "),t("td",[s._v("æŒ‡å®š C é¢„å¤„ç†å™¨çš„è·¯å¾„")])]),s._v(" "),t("tr",[t("td",[s._v("--with-cc-opt=OPTIONS")]),s._v(" "),t("td",[s._v('Additional parameters which will be added to the variable CFLAGS. With the use of the system library PCRE in FreeBSD, it is necessary to indicate --with-cc-opt="-I /usr/local/include". If we are using select() and it is necessary to increase the number of file descriptors, then this also can be assigned here: --with-cc-opt="-D FD_SETSIZE=2048".')])]),s._v(" "),t("tr",[t("td",[s._v("--with-ld-opt=OPTIONS")]),s._v(" "),t("td",[s._v('Additional parameters passed to the linker. With the use of the system library PCRE in - FreeBSD, it is necessary to indicate --with-ld-opt="-L /usr/local/lib".')])]),s._v(" "),t("tr",[t("td",[s._v("--with-cpu-opt=CPU")]),s._v(" "),t("td",[s._v("ä¸ºç‰¹å®šçš„ CPU ç¼–è¯‘ï¼Œæœ‰æ•ˆçš„å€¼åŒ…æ‹¬ï¼špentium, pentiumpro, pentium3, pentium4, athlon, opteron, amd64, sparc32, sparc64, ppc64")])]),s._v(" "),t("tr",[t("td",[s._v("--without-pcre")]),s._v(" "),t("td",[s._v('ç¦æ­¢ PCRE åº“çš„ä½¿ç”¨ã€‚åŒæ—¶ä¹Ÿä¼šç¦æ­¢ HTTP rewrite æ¨¡å—ã€‚åœ¨ "location" é…ç½®æŒ‡ä»¤ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼ä¹Ÿéœ€è¦ PCRE ã€‚')])]),s._v(" "),t("tr",[t("td",[s._v("--with-pcre=DIR")]),s._v(" "),t("td",[s._v("æŒ‡å®š PCRE åº“çš„æºä»£ç çš„è·¯å¾„ã€‚")])]),s._v(" "),t("tr",[t("td",[s._v("--with-pcre-opt=OPTIONS")]),s._v(" "),t("td",[s._v("Set additional options for PCRE building.")])]),s._v(" "),t("tr",[t("td",[s._v("--with-md5=DIR")]),s._v(" "),t("td",[s._v("Set path to md5 library sources.")])]),s._v(" "),t("tr",[t("td",[s._v("--with-md5-opt=OPTIONS")]),s._v(" "),t("td",[s._v("Set additional options for md5 building.")])]),s._v(" "),t("tr",[t("td",[s._v("--with-md5-asm")]),s._v(" "),t("td",[s._v("Use md5 assembler sources.")])]),s._v(" "),t("tr",[t("td",[s._v("--with-sha1=DIR")]),s._v(" "),t("td",[s._v("Set path to sha1 library sources.")])]),s._v(" "),t("tr",[t("td",[s._v("--with-sha1-opt=OPTIONS")]),s._v(" "),t("td",[s._v("Set additional options for sha1 building.")])]),s._v(" "),t("tr",[t("td",[s._v("--with-sha1-asm")]),s._v(" "),t("td",[s._v("Use sha1 assembler sources.")])]),s._v(" "),t("tr",[t("td",[s._v("--with-zlib=DIR")]),s._v(" "),t("td",[s._v("Set path to zlib library sources.")])]),s._v(" "),t("tr",[t("td",[s._v("--with-zlib-opt=OPTIONS")]),s._v(" "),t("td",[s._v("Set additional options for zlib building.")])]),s._v(" "),t("tr",[t("td",[s._v("--with-zlib-asm=CPU")]),s._v(" "),t("td",[s._v("Use zlib assembler sources optimized for specified CPU, valid values are: pentium, pentiumpro")])]),s._v(" "),t("tr",[t("td",[s._v("--with-openssl=DIR")]),s._v(" "),t("td",[s._v("Set path to OpenSSL library sources")])]),s._v(" "),t("tr",[t("td",[s._v("--with-openssl-opt=OPTIONS")]),s._v(" "),t("td",[s._v("Set additional options for OpenSSL building")])]),s._v(" "),t("tr",[t("td",[s._v("--with-debug")]),s._v(" "),t("td",[s._v("å¯ç”¨è°ƒè¯•æ—¥å¿—")])]),s._v(" "),t("tr",[t("td",[s._v("--add-module=PATH")]),s._v(" "),t("td",[s._v("Add in a third-party module found in directory PATH")])])])]),s._v(" "),t("h2",{attrs:{id:"é…ç½®"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é…ç½®"}},[s._v("#")]),s._v(" é…ç½®")]),s._v(" "),t("p",[s._v("åœ¨Centos é»˜è®¤é…ç½®æ–‡ä»¶åœ¨ "),t("strong",[s._v("/usr/local/nginx-1.5.1/conf/nginx.conf")]),s._v(" æˆ‘ä»¬è¦åœ¨è¿™é‡Œé…ç½®ä¸€äº›æ–‡ä»¶ã€‚nginx.confæ˜¯ä¸»é…ç½®æ–‡ä»¶ï¼Œç”±è‹¥å¹²ä¸ªéƒ¨åˆ†ç»„æˆï¼Œæ¯ä¸ªå¤§æ‹¬å·"),t("code",[s._v("{}")]),s._v("è¡¨ç¤ºä¸€ä¸ªéƒ¨åˆ†ã€‚æ¯ä¸€è¡ŒæŒ‡ä»¤éƒ½ç”±åˆ†å·ç»“æŸ"),t("code",[s._v(";")]),s._v("ï¼Œæ ‡å¿—ç€ä¸€è¡Œçš„ç»“æŸã€‚")]),s._v(" "),t("h3",{attrs:{id:"å¸¸ç”¨æ­£åˆ™"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¸¸ç”¨æ­£åˆ™"}},[s._v("#")]),s._v(" å¸¸ç”¨æ­£åˆ™")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("æ­£åˆ™")]),s._v(" "),t("th",[s._v("è¯´æ˜")]),s._v(" "),t("th",[s._v("æ­£åˆ™")]),s._v(" "),t("th",[s._v("è¯´æ˜")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[t("code",[s._v(".")])]),s._v(" "),t("td",[s._v("åŒ¹é…é™¤æ¢è¡Œç¬¦ä»¥å¤–çš„ä»»æ„å­—ç¬¦")]),s._v(" "),t("td",[t("code",[s._v("$")])]),s._v(" "),t("td",[s._v("åŒ¹é…å­—ç¬¦ä¸²çš„ç»“æŸ")])]),s._v(" "),t("tr",[t("td",[t("code",[s._v("?")])]),s._v(" "),t("td",[s._v("é‡å¤0æ¬¡æˆ–1æ¬¡")]),s._v(" "),t("td",[t("code",[s._v("{n}")])]),s._v(" "),t("td",[s._v("é‡å¤næ¬¡")])]),s._v(" "),t("tr",[t("td",[t("code",[s._v("+")])]),s._v(" "),t("td",[s._v("é‡å¤1æ¬¡æˆ–æ›´å¤šæ¬¡")]),s._v(" "),t("td",[t("code",[s._v("{n,}")])]),s._v(" "),t("td",[s._v("é‡å¤næ¬¡æˆ–æ›´å¤šæ¬¡")])]),s._v(" "),t("tr",[t("td",[t("code",[s._v("*")])]),s._v(" "),t("td",[s._v("é‡å¤0æ¬¡æˆ–æ›´å¤šæ¬¡")]),s._v(" "),t("td",[t("code",[s._v("[c]")])]),s._v(" "),t("td",[s._v("åŒ¹é…å•ä¸ªå­—ç¬¦c")])]),s._v(" "),t("tr",[t("td",[t("code",[s._v("\\d")])]),s._v(" "),t("td",[s._v("åŒ¹é…æ•°å­—")]),s._v(" "),t("td",[t("code",[s._v("[a-z]")])]),s._v(" "),t("td",[s._v("åŒ¹é…a-zå°å†™å­—æ¯çš„ä»»æ„ä¸€ä¸ª")])]),s._v(" "),t("tr",[t("td",[t("code",[s._v("^")])]),s._v(" "),t("td",[s._v("åŒ¹é…å­—ç¬¦ä¸²çš„å¼€å§‹")]),s._v(" "),t("td",[s._v("-")]),s._v(" "),t("td",[s._v("-")])])])]),s._v(" "),t("h3",{attrs:{id:"å…¨å±€å˜é‡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å…¨å±€å˜é‡"}},[s._v("#")]),s._v(" å…¨å±€å˜é‡")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("å˜é‡")]),s._v(" "),t("th",[s._v("è¯´æ˜")]),s._v(" "),t("th",[s._v("å˜é‡")]),s._v(" "),t("th",[s._v("è¯´æ˜")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("$args")]),s._v(" "),t("td",[s._v("è¿™ä¸ªå˜é‡ç­‰äºè¯·æ±‚è¡Œä¸­çš„å‚æ•°ï¼ŒåŒ$query_string")]),s._v(" "),t("td",[s._v("$remote_port")]),s._v(" "),t("td",[s._v("å®¢æˆ·ç«¯çš„ç«¯å£ã€‚")])]),s._v(" "),t("tr",[t("td",[s._v("$content_length")]),s._v(" "),t("td",[s._v("è¯·æ±‚å¤´ä¸­çš„Content-lengthå­—æ®µã€‚")]),s._v(" "),t("td",[s._v("$remote_user")]),s._v(" "),t("td",[s._v("å·²ç»ç»è¿‡Auth Basic ModuleéªŒè¯çš„ç”¨æˆ·åã€‚")])]),s._v(" "),t("tr",[t("td",[s._v("$content_type")]),s._v(" "),t("td",[s._v("è¯·æ±‚å¤´ä¸­çš„Content-Typeå­—æ®µã€‚")]),s._v(" "),t("td",[s._v("$request_filename")]),s._v(" "),t("td",[s._v("å½“å‰è¯·æ±‚çš„æ–‡ä»¶è·¯å¾„ï¼Œç”±rootæˆ–aliasæŒ‡ä»¤ä¸URIè¯·æ±‚ç”Ÿæˆã€‚")])]),s._v(" "),t("tr",[t("td",[s._v("$document_root")]),s._v(" "),t("td",[s._v("å½“å‰è¯·æ±‚åœ¨rootæŒ‡ä»¤ä¸­æŒ‡å®šçš„å€¼ã€‚")]),s._v(" "),t("td",[s._v("$scheme")]),s._v(" "),t("td",[s._v("HTTPæ–¹æ³•ï¼ˆå¦‚httpï¼Œhttpsï¼‰ã€‚")])]),s._v(" "),t("tr",[t("td",[s._v("$host")]),s._v(" "),t("td",[s._v("è¯·æ±‚ä¸»æœºå¤´å­—æ®µï¼Œå¦åˆ™ä¸ºæœåŠ¡å™¨åç§°ã€‚")]),s._v(" "),t("td",[s._v("$server_protocol")]),s._v(" "),t("td",[s._v("è¯·æ±‚ä½¿ç”¨çš„åè®®ï¼Œé€šå¸¸æ˜¯HTTP/1.0æˆ–HTTP/1.1ã€‚")])]),s._v(" "),t("tr",[t("td",[s._v("$http_user_agent")]),s._v(" "),t("td",[s._v("å®¢æˆ·ç«¯agentä¿¡æ¯")]),s._v(" "),t("td",[s._v("$server_addr")]),s._v(" "),t("td",[s._v("æœåŠ¡å™¨åœ°å€ï¼Œåœ¨å®Œæˆä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨åå¯ä»¥ç¡®å®šè¿™ä¸ªå€¼ã€‚")])]),s._v(" "),t("tr",[t("td",[s._v("$http_cookie")]),s._v(" "),t("td",[s._v("å®¢æˆ·ç«¯cookieä¿¡æ¯")]),s._v(" "),t("td",[s._v("$server_name")]),s._v(" "),t("td",[s._v("æœåŠ¡å™¨åç§°ã€‚")])]),s._v(" "),t("tr",[t("td",[s._v("$limit_rate")]),s._v(" "),t("td",[s._v("è¿™ä¸ªå˜é‡å¯ä»¥é™åˆ¶è¿æ¥é€Ÿç‡ã€‚")]),s._v(" "),t("td",[s._v("$server_port")]),s._v(" "),t("td",[s._v("è¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨çš„ç«¯å£å·ã€‚")])]),s._v(" "),t("tr",[t("td",[s._v("$request_method")]),s._v(" "),t("td",[s._v("å®¢æˆ·ç«¯è¯·æ±‚çš„åŠ¨ä½œï¼Œé€šå¸¸ä¸ºGETæˆ–POSTã€‚")]),s._v(" "),t("td",[s._v("$request_uri")]),s._v(" "),t("td",[s._v("åŒ…å«è¯·æ±‚å‚æ•°çš„åŸå§‹URIï¼Œä¸åŒ…å«ä¸»æœºåï¼Œå¦‚ï¼š/foo/bar.php?arg=bazã€‚")])]),s._v(" "),t("tr",[t("td",[s._v("$remote_addr")]),s._v(" "),t("td",[s._v("å®¢æˆ·ç«¯çš„IPåœ°å€ã€‚")]),s._v(" "),t("td",[s._v("$uri")]),s._v(" "),t("td",[s._v("ä¸å¸¦è¯·æ±‚å‚æ•°çš„å½“å‰URIï¼Œ$uriä¸åŒ…å«ä¸»æœºåï¼Œå¦‚/foo/bar.htmlã€‚")])]),s._v(" "),t("tr",[t("td",[s._v("$document_uri")]),s._v(" "),t("td",[s._v("ä¸$uriç›¸åŒã€‚")]),s._v(" "),t("td",[s._v("-")]),s._v(" "),t("td",[s._v("-")])])])]),s._v(" "),t("p",[s._v("ä¾‹å¦‚è¯·æ±‚ï¼š"),t("code",[s._v("http://localhost:3000/test1/test2/test.php")])]),s._v(" "),t("p",[s._v("$hostï¼šlocalhost"),t("br"),s._v("\n$server_portï¼š3000"),t("br"),s._v("\n$request_uriï¼š/test1/test2/test.php"),t("br"),s._v("\n$document_uriï¼š/test1/test2/test.php"),t("br"),s._v("\n$document_rootï¼š/var/www/html"),t("br"),s._v("\n$request_filenameï¼š/var/www/html/test1/test2/test.php")]),s._v(" "),t("h3",{attrs:{id:"ç¬¦å·å‚è€ƒ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç¬¦å·å‚è€ƒ"}},[s._v("#")]),s._v(" ç¬¦å·å‚è€ƒ")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("ç¬¦å·")]),s._v(" "),t("th",[s._v("è¯´æ˜")]),s._v(" "),t("th",[s._v("ç¬¦å·")]),s._v(" "),t("th",[s._v("è¯´æ˜")]),s._v(" "),t("th",[s._v("ç¬¦å·")]),s._v(" "),t("th",[s._v("è¯´æ˜")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("k,K")]),s._v(" "),t("td",[s._v("åƒå­—èŠ‚")]),s._v(" "),t("td",[s._v("m,M")]),s._v(" "),t("td",[s._v("å…†å­—èŠ‚")]),s._v(" "),t("td",[s._v("ms")]),s._v(" "),t("td",[s._v("æ¯«ç§’")])]),s._v(" "),t("tr",[t("td",[s._v("s")]),s._v(" "),t("td",[s._v("ç§’")]),s._v(" "),t("td",[s._v("m")]),s._v(" "),t("td",[s._v("åˆ†é’Ÿ")]),s._v(" "),t("td",[s._v("h")]),s._v(" "),t("td",[s._v("å°æ—¶")])]),s._v(" "),t("tr",[t("td",[s._v("d")]),s._v(" "),t("td",[s._v("æ—¥")]),s._v(" "),t("td",[s._v("w")]),s._v(" "),t("td",[s._v("å‘¨")]),s._v(" "),t("td",[s._v("M")]),s._v(" "),t("td",[s._v("ä¸€ä¸ªæœˆ, 30å¤©")])])])]),s._v(" "),t("p",[s._v('ä¾‹å¦‚ï¼Œ"8k"ï¼Œ"1m" ä»£è¡¨å­—èŠ‚æ•°è®¡é‡ã€‚'),t("br"),s._v('\nä¾‹å¦‚ï¼Œ"1h 30m"ï¼Œ"1y 6M"ã€‚ä»£è¡¨ "1å°æ—¶ 30åˆ†"ï¼Œ"1å¹´é›¶6ä¸ªæœˆ"ã€‚')]),s._v(" "),t("h3",{attrs:{id:"é…ç½®æ–‡ä»¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é…ç½®æ–‡ä»¶"}},[s._v("#")]),s._v(" é…ç½®æ–‡ä»¶")]),s._v(" "),t("p",[s._v("nginx çš„é…ç½®ç³»ç»Ÿç”±ä¸€ä¸ªä¸»é…ç½®æ–‡ä»¶å’Œå…¶ä»–ä¸€äº›è¾…åŠ©çš„é…ç½®æ–‡ä»¶æ„æˆã€‚è¿™äº›é…ç½®æ–‡ä»¶å‡æ˜¯çº¯æ–‡æœ¬æ–‡ä»¶ï¼Œå…¨éƒ¨ä½äº nginx å®‰è£…ç›®å½•ä¸‹çš„ conf ç›®å½•ä¸‹ã€‚")]),s._v(" "),t("p",[s._v("æŒ‡ä»¤ç”± nginx çš„å„ä¸ªæ¨¡å—æä¾›ï¼Œä¸åŒçš„æ¨¡å—ä¼šæä¾›ä¸åŒçš„æŒ‡ä»¤æ¥å®ç°é…ç½®ã€‚\næŒ‡ä»¤é™¤äº† Key-Value çš„å½¢å¼ï¼Œè¿˜æœ‰ä½œç”¨åŸŸæŒ‡ä»¤ã€‚")]),s._v(" "),t("p",[s._v("nginx.conf ä¸­çš„é…ç½®ä¿¡æ¯ï¼Œæ ¹æ®å…¶é€»è¾‘ä¸Šçš„æ„ä¹‰ï¼Œå¯¹å®ƒä»¬è¿›è¡Œäº†åˆ†ç±»ï¼Œä¹Ÿå°±æ˜¯åˆ†æˆäº†å¤šä¸ªä½œç”¨åŸŸï¼Œæˆ–è€…ç§°ä¹‹ä¸ºé…ç½®æŒ‡ä»¤ä¸Šä¸‹æ–‡ã€‚ä¸åŒçš„ä½œç”¨åŸŸå«æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªé…ç½®é¡¹ã€‚")]),s._v(" "),t("p",[s._v("ä¸‹é¢çš„è¿™äº›ä¸Šä¸‹æ–‡æŒ‡ä»¤æ˜¯ç”¨çš„æ¯”è¾ƒå¤šï¼š")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("Directive")]),s._v(" "),t("th",[s._v("Description")]),s._v(" "),t("th",[s._v("Contains Directive")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("main")]),s._v(" "),t("td",[s._v("nginx åœ¨è¿è¡Œæ—¶ä¸å…·ä½“ä¸šåŠ¡åŠŸèƒ½ï¼ˆæ¯”å¦‚ http æœåŠ¡æˆ–è€… email æœåŠ¡ä»£ç†ï¼‰æ— å…³çš„ä¸€äº›å‚æ•°ï¼Œæ¯”å¦‚å·¥ä½œè¿›ç¨‹æ•°ï¼Œè¿è¡Œçš„èº«ä»½ç­‰ã€‚")]),s._v(" "),t("td",[s._v("user, worker_processes, error_log, events, http, mail")])]),s._v(" "),t("tr",[t("td",[s._v("http")]),s._v(" "),t("td",[s._v("ä¸æä¾› http æœåŠ¡ç›¸å…³çš„ä¸€äº›é…ç½®å‚æ•°ã€‚ä¾‹å¦‚ï¼šæ˜¯å¦ä½¿ç”¨ keepalive å•Šï¼Œæ˜¯å¦ä½¿ç”¨ gzip è¿›è¡Œå‹ç¼©ç­‰ã€‚")]),s._v(" "),t("td",[s._v("server")])]),s._v(" "),t("tr",[t("td",[s._v("server")]),s._v(" "),t("td",[s._v("http æœåŠ¡ä¸Šæ”¯æŒè‹¥å¹²è™šæ‹Ÿä¸»æœºã€‚æ¯ä¸ªè™šæ‹Ÿä¸»æœºä¸€ä¸ªå¯¹åº”çš„ server é…ç½®é¡¹ï¼Œé…ç½®é¡¹é‡Œé¢åŒ…å«è¯¥è™šæ‹Ÿä¸»æœºç›¸å…³çš„é…ç½®ã€‚åœ¨æä¾› mail æœåŠ¡çš„ä»£ç†æ—¶ï¼Œä¹Ÿå¯ä»¥å»ºç«‹è‹¥å¹² server. æ¯ä¸ª server é€šè¿‡ç›‘å¬çš„åœ°å€æ¥åŒºåˆ†ã€‚")]),s._v(" "),t("td",[s._v("listen, server_name, access_log, location, protocol, proxy, smtp_auth, xclient")])]),s._v(" "),t("tr",[t("td",[s._v("location")]),s._v(" "),t("td",[s._v("http æœåŠ¡ä¸­ï¼ŒæŸäº›ç‰¹å®šçš„ URL å¯¹åº”çš„ä¸€ç³»åˆ—é…ç½®é¡¹ã€‚")]),s._v(" "),t("td",[s._v("index, root")])]),s._v(" "),t("tr",[t("td",[s._v("mail")]),s._v(" "),t("td",[s._v("å®ç° email ç›¸å…³çš„ SMTP/IMAP/POP3 ä»£ç†æ—¶ï¼Œå…±äº«çš„ä¸€äº›é…ç½®é¡¹ï¼ˆå› ä¸ºå¯èƒ½å®ç°å¤šä¸ªä»£ç†ï¼Œå·¥ä½œåœ¨å¤šä¸ªç›‘å¬åœ°å€ä¸Šï¼‰ã€‚")]),s._v(" "),t("td",[s._v("server, http, imap_capabilities")])]),s._v(" "),t("tr",[t("td",[s._v("include")]),s._v(" "),t("td",[s._v("ä»¥ä¾¿å¢å¼ºé…ç½®æ–‡ä»¶çš„å¯è¯»æ€§ï¼Œä½¿å¾—éƒ¨åˆ†é…ç½®æ–‡ä»¶å¯ä»¥é‡æ–°ä½¿ç”¨ã€‚")]),s._v(" "),t("td",[s._v("-")])]),s._v(" "),t("tr",[t("td",[s._v("valid_referers")]),s._v(" "),t("td",[s._v("ç”¨æ¥æ ¡éªŒHttpè¯·æ±‚å¤´Refereræ˜¯å¦æœ‰æ•ˆã€‚")]),s._v(" "),t("td",[s._v("-")])]),s._v(" "),t("tr",[t("td",[s._v("try_files")]),s._v(" "),t("td",[s._v("ç”¨åœ¨serveréƒ¨åˆ†ï¼Œä¸è¿‡æœ€å¸¸è§çš„è¿˜æ˜¯ç”¨åœ¨locationéƒ¨åˆ†ï¼Œå®ƒä¼šæŒ‰ç…§ç»™å®šçš„å‚æ•°é¡ºåºè¿›è¡Œå°è¯•ï¼Œç¬¬ä¸€ä¸ªè¢«åŒ¹é…åˆ°çš„å°†ä¼šè¢«ä½¿ç”¨ã€‚")]),s._v(" "),t("td",[s._v("-")])]),s._v(" "),t("tr",[t("td",[s._v("if")]),s._v(" "),t("td",[s._v("å½“åœ¨locationå—ä¸­ä½¿ç”¨ifæŒ‡ä»¤ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹å®ƒå¹¶ä¸æŒ‰ç…§é¢„æœŸè¿è¡Œï¼Œä¸€èˆ¬æ¥è¯´é¿å…ä½¿ç”¨ifæŒ‡ä»¤ã€‚")]),s._v(" "),t("td",[s._v("-")])])])]),s._v(" "),t("p",[s._v("ä¾‹å¦‚æˆ‘ä»¬å† "),t("strong",[s._v("nginx.conf")]),s._v(" é‡Œé¢å¼•ç”¨ä¸¤ä¸ªé…ç½® vhost/example.com.conf å’Œ vhost/gitlab.com.conf å®ƒä»¬éƒ½è¢«æ”¾åœ¨ä¸€ä¸ªæˆ‘è‡ªå·±æ–°å»ºçš„ç›®å½• vhost ä¸‹é¢ã€‚nginx.conf é…ç½®å¦‚ä¸‹ï¼š")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("worker_processes")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("events")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("worker_connections")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include")]),s._v("       mime.types")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default_type")]),s._v("  application/octet-stream")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#                  '$status $body_bytes_sent \"$http_referer\" '")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#                  \'"$http_user_agent" "$http_x_forwarded_for"\';')]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#access_log  logs/access.log  main;")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sendfile")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("on")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#tcp_nopush     on;")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#keepalive_timeout  0;")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("keepalive_timeout")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("65")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#gzip  on;")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  localhost")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("   html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v("  index.html index.htm")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("error_page")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("502")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("504")]),s._v("  /50x.html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" = /50x.html")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("   html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include")]),s._v("  vhost/example.com.conf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include")]),s._v("  vhost/gitlab.com.conf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br")])]),t("p",[s._v("ç®€å•çš„é…ç½®: example.com.conf")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ä¾¦å¬çš„80ç«¯å£")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  baidu.com app.baidu.com")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è¿™é‡ŒæŒ‡å®šåŸŸå")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v("        index.html index.htm")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è¿™é‡ŒæŒ‡å®šé»˜è®¤å…¥å£é¡µé¢")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" /home/www/app.baidu.com")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è¿™é‡ŒæŒ‡å®šç›®å½•")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h3",{attrs:{id:"å†…ç½®é¢„å®šä¹‰å˜é‡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å†…ç½®é¢„å®šä¹‰å˜é‡"}},[s._v("#")]),s._v(" å†…ç½®é¢„å®šä¹‰å˜é‡")]),s._v(" "),t("p",[s._v("Nginxæä¾›äº†è®¸å¤šé¢„å®šä¹‰çš„å˜é‡ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä½¿ç”¨setæ¥è®¾ç½®å˜é‡ã€‚ä½ å¯ä»¥åœ¨ifä¸­ä½¿ç”¨é¢„å®šä¹‰å˜é‡ï¼Œä¹Ÿå¯ä»¥å°†å®ƒä»¬ä¼ é€’ç»™ä»£ç†æœåŠ¡å™¨ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„é¢„å®šä¹‰å˜é‡ï¼Œ"),t("a",{attrs:{href:"http://nginx.org/en/docs/varindex.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("æ›´å¤šè¯¦è§"),t("OutboundLink")],1)]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("å˜é‡åç§°")]),s._v(" "),t("th",[s._v("å€¼")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("$args_name")]),s._v(" "),t("td",[s._v("åœ¨è¯·æ±‚ä¸­çš„nameå‚æ•°")])]),s._v(" "),t("tr",[t("td",[s._v("$args")]),s._v(" "),t("td",[s._v("æ‰€æœ‰è¯·æ±‚å‚æ•°")])]),s._v(" "),t("tr",[t("td",[s._v("$query_string")]),s._v(" "),t("td",[s._v("$argsçš„åˆ«å")])]),s._v(" "),t("tr",[t("td",[s._v("$content_length")]),s._v(" "),t("td",[s._v("è¯·æ±‚å¤´Content-Lengthçš„å€¼")])]),s._v(" "),t("tr",[t("td",[s._v("$content_type")]),s._v(" "),t("td",[s._v("è¯·æ±‚å¤´Content-Typeçš„å€¼")])]),s._v(" "),t("tr",[t("td",[s._v("$host")]),s._v(" "),t("td",[s._v("å¦‚æœå½“å‰æœ‰Hostï¼Œåˆ™ä¸ºè¯·æ±‚å¤´Hostçš„å€¼ï¼›å¦‚æœæ²¡æœ‰è¿™ä¸ªå¤´ï¼Œé‚£ä¹ˆè¯¥å€¼ç­‰äºåŒ¹é…è¯¥è¯·æ±‚çš„server_nameçš„å€¼")])]),s._v(" "),t("tr",[t("td",[s._v("$remote_addr")]),s._v(" "),t("td",[s._v("å®¢æˆ·ç«¯çš„IPåœ°å€")])]),s._v(" "),t("tr",[t("td",[s._v("$request")]),s._v(" "),t("td",[s._v("å®Œæ•´çš„è¯·æ±‚ï¼Œä»å®¢æˆ·ç«¯æ”¶åˆ°ï¼ŒåŒ…æ‹¬Httpè¯·æ±‚æ–¹æ³•ã€URIã€Httpåè®®ã€å¤´ã€è¯·æ±‚ä½“")])]),s._v(" "),t("tr",[t("td",[s._v("$request_uri")]),s._v(" "),t("td",[s._v("å®Œæ•´è¯·æ±‚çš„URIï¼Œä»å®¢æˆ·ç«¯æ¥çš„è¯·æ±‚ï¼ŒåŒ…æ‹¬å‚æ•°")])]),s._v(" "),t("tr",[t("td",[s._v("$scheme")]),s._v(" "),t("td",[s._v("å½“å‰è¯·æ±‚çš„åè®®")])]),s._v(" "),t("tr",[t("td",[s._v("$uri")]),s._v(" "),t("td",[s._v("å½“å‰è¯·æ±‚çš„æ ‡å‡†åŒ–URI")])])])]),s._v(" "),t("h3",{attrs:{id:"åå‘ä»£ç†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#åå‘ä»£ç†"}},[s._v("#")]),s._v(" åå‘ä»£ç†")]),s._v(" "),t("p",[s._v("åå‘ä»£ç†æ˜¯ä¸€ä¸ªWebæœåŠ¡å™¨ï¼Œå®ƒæ¥å—å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ï¼Œç„¶åå°†è¯·æ±‚è½¬å‘ç»™ä¸Šæ¸¸æœåŠ¡å™¨ï¼Œå¹¶å°†ä»æœåŠ¡å™¨å¾—åˆ°çš„ç»“æœè¿”å›ç»™è¿æ¥çš„å®¢æˆ·ç«¯ã€‚ä¸‹é¢ç®€å•çš„åå‘ä»£ç†çš„ä¾‹å­ï¼š")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  \n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("                                                        \n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  localhost")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("                                              \n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("client_max_body_size")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024M")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å…è®¸å®¢æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å•æ–‡ä»¶å­—èŠ‚æ•°")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v("                         http://localhost:8080")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Host              "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),s._v(":"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$server_port")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X-Forwarded-For   "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# HTTPçš„è¯·æ±‚ç«¯çœŸå®çš„IP")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X-Forwarded-Proto "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$scheme")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ä¸ºäº†æ­£ç¡®åœ°è¯†åˆ«å®é™…ç”¨æˆ·å‘å‡ºçš„åè®®æ˜¯ http è¿˜æ˜¯ https")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("å¤æ‚çš„é…ç½®: gitlab.com.confã€‚")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ä¾¦å¬çš„80ç«¯å£")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  git.example.cn")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v("   http://localhost:3000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ä»¥ä¸‹æ˜¯ä¸€äº›åå‘ä»£ç†çš„é…ç½®å¯åˆ é™¤")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_redirect")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("off")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#åç«¯çš„WebæœåŠ¡å™¨å¯ä»¥é€šè¿‡X-Forwarded-Forè·å–ç”¨æˆ·çœŸå®IP")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v("           Host "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("client_max_body_size")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10m")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#å…è®¸å®¢æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å•æ–‡ä»¶å­—èŠ‚æ•°")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("client_body_buffer_size")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("128k")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ç¼“å†²åŒºä»£ç†ç¼“å†²ç”¨æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å­—èŠ‚æ•°")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_connect_timeout")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#nginxè·Ÿåç«¯æœåŠ¡å™¨è¿æ¥è¶…æ—¶æ—¶é—´(ä»£ç†è¿æ¥è¶…æ—¶)")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_send_timeout")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#åç«¯æœåŠ¡å™¨æ•°æ®å›ä¼ æ—¶é—´(ä»£ç†å‘é€è¶…æ—¶)")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_read_timeout")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#è¿æ¥æˆåŠŸåï¼Œåç«¯æœåŠ¡å™¨å“åº”æ—¶é—´(ä»£ç†æ¥æ”¶è¶…æ—¶)")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_buffer_size")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4k")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#è®¾ç½®ä»£ç†æœåŠ¡å™¨ï¼ˆnginxï¼‰ä¿å­˜ç”¨æˆ·å¤´ä¿¡æ¯çš„ç¼“å†²åŒºå¤§å°")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_buffers")]),s._v("              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32k")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#proxy_buffersç¼“å†²åŒºï¼Œç½‘é¡µå¹³å‡åœ¨32kä»¥ä¸‹çš„è¯ï¼Œè¿™æ ·è®¾ç½®")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_busy_buffers_size")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64k")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#é«˜è´Ÿè·ä¸‹ç¼“å†²å¤§å°ï¼ˆproxy_buffers*2ï¼‰")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("p",[s._v("ä»£ç†åˆ°ä¸Šæ¸¸æœåŠ¡å™¨çš„é…ç½®ä¸­ï¼Œæœ€é‡è¦çš„æ˜¯proxy_passæŒ‡ä»¤ã€‚ä»¥ä¸‹æ˜¯ä»£ç†æ¨¡å—ä¸­çš„ä¸€äº›å¸¸ç”¨æŒ‡ä»¤ï¼š")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("æŒ‡ä»¤")]),s._v(" "),t("th",[s._v("è¯´æ˜")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("proxy_connect_timeout")]),s._v(" "),t("td",[s._v("Nginxä»æ¥å—è¯·æ±‚è‡³è¿æ¥åˆ°ä¸Šæ¸¸æœåŠ¡å™¨çš„æœ€é•¿ç­‰å¾…æ—¶é—´")])]),s._v(" "),t("tr",[t("td",[s._v("proxy_send_timeout")]),s._v(" "),t("td",[s._v("åç«¯æœåŠ¡å™¨æ•°æ®å›ä¼ æ—¶é—´(ä»£ç†å‘é€è¶…æ—¶)")])]),s._v(" "),t("tr",[t("td",[s._v("proxy_read_timeout")]),s._v(" "),t("td",[s._v("è¿æ¥æˆåŠŸåï¼Œåç«¯æœåŠ¡å™¨å“åº”æ—¶é—´(ä»£ç†æ¥æ”¶è¶…æ—¶)")])]),s._v(" "),t("tr",[t("td",[s._v("proxy_cookie_domain")]),s._v(" "),t("td",[s._v("æ›¿ä»£ä»ä¸Šæ¸¸æœåŠ¡å™¨æ¥çš„Set-Cookieå¤´çš„domainå±æ€§")])]),s._v(" "),t("tr",[t("td",[s._v("proxy_cookie_path")]),s._v(" "),t("td",[s._v("æ›¿ä»£ä»ä¸Šæ¸¸æœåŠ¡å™¨æ¥çš„Set-Cookieå¤´çš„pathå±æ€§")])]),s._v(" "),t("tr",[t("td",[s._v("proxy_buffer_size")]),s._v(" "),t("td",[s._v("è®¾ç½®ä»£ç†æœåŠ¡å™¨ï¼ˆnginxï¼‰ä¿å­˜ç”¨æˆ·å¤´ä¿¡æ¯çš„ç¼“å†²åŒºå¤§å°")])]),s._v(" "),t("tr",[t("td",[s._v("proxy_buffers")]),s._v(" "),t("td",[s._v("proxy_buffersç¼“å†²åŒºï¼Œç½‘é¡µå¹³å‡åœ¨å¤šå°‘kä»¥ä¸‹")])]),s._v(" "),t("tr",[t("td",[s._v("proxy_set_header")]),s._v(" "),t("td",[s._v("é‡å†™å‘é€åˆ°ä¸Šæ¸¸æœåŠ¡å™¨å¤´çš„å†…å®¹ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å°†æŸä¸ªå¤´éƒ¨çš„å€¼è®¾ç½®ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œè€Œä¸å‘é€æŸä¸ªå¤´éƒ¨çš„æ–¹æ³•å®ç°")])]),s._v(" "),t("tr",[t("td",[s._v("proxy_ignore_headers")]),s._v(" "),t("td",[s._v("è¿™ä¸ªæŒ‡ä»¤ç¦æ­¢å¤„ç†æ¥è‡ªä»£ç†æœåŠ¡å™¨çš„åº”ç­”ã€‚")])]),s._v(" "),t("tr",[t("td",[s._v("proxy_intercept_errors")]),s._v(" "),t("td",[s._v("ä½¿nginxé˜»æ­¢HTTPåº”ç­”ä»£ç ä¸º400æˆ–è€…æ›´é«˜çš„åº”ç­”ã€‚")])])])]),s._v(" "),t("h3",{attrs:{id:"è´Ÿè½½å‡è¡¡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#è´Ÿè½½å‡è¡¡"}},[s._v("#")]),s._v(" è´Ÿè½½å‡è¡¡")]),s._v(" "),t("p",[s._v("upstreamæŒ‡ä»¤å¯ç”¨ä¸€ä¸ªæ–°çš„é…ç½®åŒºæ®µï¼Œåœ¨è¯¥åŒºæ®µå®šä¹‰ä¸€ç»„ä¸Šæ¸¸æœåŠ¡å™¨ã€‚è¿™äº›æœåŠ¡å™¨å¯èƒ½è¢«è®¾ç½®ä¸åŒçš„æƒé‡ï¼Œä¹Ÿå¯èƒ½å‡ºäºå¯¹æœåŠ¡å™¨è¿›è¡Œç»´æŠ¤ï¼Œæ ‡è®°ä¸ºdownã€‚")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" gitlab")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ip_hash")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# upstreamçš„è´Ÿè½½å‡è¡¡ï¼Œweightæ˜¯æƒé‡ï¼Œå¯ä»¥æ ¹æ®æœºå™¨é…ç½®å®šä¹‰æƒé‡ã€‚weigthå‚æ•°è¡¨ç¤ºæƒå€¼ï¼Œæƒå€¼è¶Šé«˜è¢«åˆ†é…åˆ°çš„å‡ ç‡è¶Šå¤§ã€‚")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 192.168.122.11:8081")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 127.0.0.1:82 weight=3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 127.0.0.1:83 weight=3 down")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 127.0.0.1:84 weight=3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("max_fails=3")]),s._v("  fail_timeout=20s")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 127.0.0.1:85 weight=4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("keepalive")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ä¾¦å¬çš„80ç«¯å£")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  git.example.cn")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v("   http://gitlab")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#åœ¨è¿™é‡Œè®¾ç½®ä¸€ä¸ªä»£ç†ï¼Œå’Œupstreamçš„åå­—ä¸€æ ·")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ä»¥ä¸‹æ˜¯ä¸€äº›åå‘ä»£ç†çš„é…ç½®å¯åˆ é™¤")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_redirect")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("off")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#åç«¯çš„WebæœåŠ¡å™¨å¯ä»¥é€šè¿‡X-Forwarded-Forè·å–ç”¨æˆ·çœŸå®IP")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v("           Host "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v("           X-Real-IP "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v("           X-Forwarded-For "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$proxy_add_x_forwarded_for")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("client_max_body_size")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10m")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#å…è®¸å®¢æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å•æ–‡ä»¶å­—èŠ‚æ•°")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("client_body_buffer_size")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("128k")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ç¼“å†²åŒºä»£ç†ç¼“å†²ç”¨æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å­—èŠ‚æ•°")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_connect_timeout")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#nginxè·Ÿåç«¯æœåŠ¡å™¨è¿æ¥è¶…æ—¶æ—¶é—´(ä»£ç†è¿æ¥è¶…æ—¶)")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_send_timeout")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#åç«¯æœåŠ¡å™¨æ•°æ®å›ä¼ æ—¶é—´(ä»£ç†å‘é€è¶…æ—¶)")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_read_timeout")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#è¿æ¥æˆåŠŸåï¼Œåç«¯æœåŠ¡å™¨å“åº”æ—¶é—´(ä»£ç†æ¥æ”¶è¶…æ—¶)")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_buffer_size")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4k")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#è®¾ç½®ä»£ç†æœåŠ¡å™¨ï¼ˆnginxï¼‰ä¿å­˜ç”¨æˆ·å¤´ä¿¡æ¯çš„ç¼“å†²åŒºå¤§å°")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_buffers")]),s._v("              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32k")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ç¼“å†²åŒºï¼Œç½‘é¡µå¹³å‡åœ¨32kä»¥ä¸‹çš„è¯ï¼Œè¿™æ ·è®¾ç½®")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_busy_buffers_size")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64k")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#é«˜è´Ÿè·ä¸‹ç¼“å†²å¤§å°ï¼ˆproxy_buffers*2ï¼‰")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_temp_file_write_size")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64k")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#è®¾å®šç¼“å­˜æ–‡ä»¶å¤¹å¤§å°ï¼Œå¤§äºè¿™ä¸ªå€¼ï¼Œå°†ä»upstreamæœåŠ¡å™¨ä¼ ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br")])]),t("p",[s._v("æ¯ä¸ªè¯·æ±‚æŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ï¼Œå¦‚æœåç«¯æœåŠ¡å™¨downæ‰ï¼Œèƒ½è‡ªåŠ¨å‰”é™¤ã€‚")]),s._v(" "),t("p",[t("strong",[s._v("è´Ÿè½½å‡è¡¡ï¼š")])]),s._v(" "),t("p",[s._v("upstreamæ¨¡å—èƒ½å¤Ÿä½¿ç”¨3ç§è´Ÿè½½å‡è¡¡ç®—æ³•ï¼šè½®è¯¢ã€IPå“ˆå¸Œã€æœ€å°‘è¿æ¥æ•°ã€‚")]),s._v(" "),t("p",[t("strong",[s._v("è½®è¯¢ï¼š")]),s._v(" é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨è½®è¯¢ç®—æ³•ï¼Œä¸éœ€è¦é…ç½®æŒ‡ä»¤æ¥æ¿€æ´»å®ƒï¼Œå®ƒæ˜¯åŸºäºåœ¨é˜Ÿåˆ—ä¸­è°æ˜¯ä¸‹ä¸€ä¸ªçš„åŸç†ç¡®ä¿è®¿é—®å‡åŒ€åœ°åˆ†å¸ƒåˆ°æ¯ä¸ªä¸Šæ¸¸æœåŠ¡å™¨ï¼›"),t("br"),s._v(" "),t("strong",[s._v("IPå“ˆå¸Œï¼š")]),s._v(" é€šè¿‡ip_hashæŒ‡ä»¤æ¥æ¿€æ´»ï¼ŒNginxé€šè¿‡IPv4åœ°å€çš„å‰3ä¸ªå­—èŠ‚æˆ–è€…æ•´ä¸ªIPv6åœ°å€ä½œä¸ºå“ˆå¸Œé”®æ¥å®ç°ï¼ŒåŒä¸€ä¸ªIPåœ°å€æ€»æ˜¯èƒ½è¢«æ˜ å°„åˆ°åŒä¸€ä¸ªä¸Šæ¸¸æœåŠ¡å™¨ï¼›"),t("br"),s._v(" "),t("strong",[s._v("æœ€å°‘è¿æ¥æ•°ï¼š")]),s._v(" é€šè¿‡least_connæŒ‡ä»¤æ¥æ¿€æ´»ï¼Œè¯¥ç®—æ³•é€šè¿‡é€‰æ‹©ä¸€ä¸ªæ´»è·ƒæ•°æœ€å°‘çš„ä¸Šæ¸¸æœåŠ¡å™¨è¿›è¡Œè¿æ¥ã€‚å¦‚æœä¸Šæ¸¸æœåŠ¡å™¨å¤„ç†èƒ½åŠ›ä¸åŒï¼Œå¯ä»¥é€šè¿‡ç»™serveré…ç½®weightæƒé‡æ¥è¯´æ˜ï¼Œè¯¥ç®—æ³•å°†è€ƒè™‘åˆ°ä¸åŒæœåŠ¡å™¨çš„åŠ æƒæœ€å°‘è¿æ¥æ•°ã€‚")]),s._v(" "),t("h4",{attrs:{id:"rr"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#rr"}},[s._v("#")]),s._v(" RR")]),s._v(" "),t("p",[t("strong",[s._v("ç®€å•é…ç½®")]),s._v(" ï¼Œè¿™é‡Œæˆ‘é…ç½®äº†2å°æœåŠ¡å™¨ï¼Œå½“ç„¶å®é™…ä¸Šæ˜¯ä¸€å°ï¼Œåªæ˜¯ç«¯å£ä¸ä¸€æ ·è€Œå·²ï¼Œè€Œ8081çš„æœåŠ¡å™¨æ˜¯ä¸å­˜åœ¨çš„ï¼Œä¹Ÿå°±æ˜¯è¯´è®¿é—®ä¸åˆ°ï¼Œä½†æ˜¯æˆ‘ä»¬è®¿é—® "),t("code",[s._v("http://localhost")]),s._v(" çš„æ—¶å€™ï¼Œä¹Ÿä¸ä¼šæœ‰é—®é¢˜ï¼Œä¼šé»˜è®¤è·³è½¬åˆ°"),t("code",[s._v("http://localhost:8080")]),s._v("å…·ä½“æ˜¯å› ä¸ºNginxä¼šè‡ªåŠ¨åˆ¤æ–­æœåŠ¡å™¨çš„çŠ¶æ€ï¼Œå¦‚æœæœåŠ¡å™¨å¤„äºä¸èƒ½è®¿é—®ï¼ˆæœåŠ¡å™¨æŒ‚äº†ï¼‰ï¼Œå°±ä¸ä¼šè·³è½¬åˆ°è¿™å°æœåŠ¡å™¨ï¼Œæ‰€ä»¥ä¹Ÿé¿å…äº†ä¸€å°æœåŠ¡å™¨æŒ‚äº†å½±å“ä½¿ç”¨çš„æƒ…å†µï¼Œç”±äºNginxé»˜è®¤æ˜¯RRç­–ç•¥ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦å…¶ä»–æ›´å¤šçš„è®¾ç½®")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" test")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" localhost:8080")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" localhost:8081")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("81")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  localhost")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("client_max_body_size")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024M")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://test")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Host "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),s._v(":"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$server_port")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("p",[t("strong",[s._v("è´Ÿè½½å‡è¡¡çš„æ ¸å¿ƒä»£ç ä¸º")])]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" test")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" localhost:8080")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" localhost:8081")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h4",{attrs:{id:"æƒé‡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æƒé‡"}},[s._v("#")]),s._v(" æƒé‡")]),s._v(" "),t("p",[s._v("æŒ‡å®šè½®è¯¢å‡ ç‡ï¼Œweightå’Œè®¿é—®æ¯”ç‡æˆæ­£æ¯”ï¼Œç”¨äºåç«¯æœåŠ¡å™¨æ€§èƒ½ä¸å‡çš„æƒ…å†µã€‚ ä¾‹å¦‚")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" test")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" localhost:8080 weight=9")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" localhost:8081 weight=1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("é‚£ä¹ˆ10æ¬¡ä¸€èˆ¬åªä¼šæœ‰1æ¬¡ä¼šè®¿é—®åˆ°8081ï¼Œè€Œæœ‰9æ¬¡ä¼šè®¿é—®åˆ°8080")]),s._v(" "),t("h4",{attrs:{id:"ip-hash"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ip-hash"}},[s._v("#")]),s._v(" ip_hash")]),s._v(" "),t("p",[s._v("ä¸Šé¢çš„2ç§æ–¹å¼éƒ½æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯ä¸‹ä¸€ä¸ªè¯·æ±‚æ¥çš„æ—¶å€™è¯·æ±‚å¯èƒ½åˆ†å‘åˆ°å¦å¤–ä¸€ä¸ªæœåŠ¡å™¨ï¼Œå½“æˆ‘ä»¬çš„ç¨‹åºä¸æ˜¯æ— çŠ¶æ€çš„æ—¶å€™ï¼ˆé‡‡ç”¨äº†sessionä¿å­˜æ•°æ®ï¼‰ï¼Œè¿™æ—¶å€™å°±æœ‰ä¸€ä¸ªå¾ˆå¤§çš„å¾ˆé—®é¢˜äº†ï¼Œæ¯”å¦‚æŠŠç™»å½•ä¿¡æ¯ä¿å­˜åˆ°äº†sessionä¸­ï¼Œé‚£ä¹ˆè·³è½¬åˆ°å¦å¤–ä¸€å°æœåŠ¡å™¨çš„æ—¶å€™å°±éœ€è¦é‡æ–°ç™»å½•äº†ï¼Œæ‰€ä»¥å¾ˆå¤šæ—¶å€™æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå®¢æˆ·åªè®¿é—®ä¸€ä¸ªæœåŠ¡å™¨ï¼Œé‚£ä¹ˆå°±éœ€è¦ç”¨iphashäº†ï¼Œiphashçš„æ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—®ipçš„hashç»“æœåˆ†é…ï¼Œè¿™æ ·æ¯ä¸ªè®¿å®¢å›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œå¯ä»¥è§£å†³sessionçš„é—®é¢˜ã€‚")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" test")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ip_hash")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" localhost:8080")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" localhost:8081")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h4",{attrs:{id:"fair"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#fair"}},[s._v("#")]),s._v(" fair")]),s._v(" "),t("p",[s._v("è¿™æ˜¯ä¸ªç¬¬ä¸‰æ–¹æ¨¡å—ï¼ŒæŒ‰åç«¯æœåŠ¡å™¨çš„å“åº”æ—¶é—´æ¥åˆ†é…è¯·æ±‚ï¼Œå“åº”æ—¶é—´çŸ­çš„ä¼˜å…ˆåˆ†é…ã€‚")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" backend")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fair")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" localhost:8080")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" localhost:8081")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h4",{attrs:{id:"url-hash"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#url-hash"}},[s._v("#")]),s._v(" url_hash")]),s._v(" "),t("p",[s._v("è¿™æ˜¯ä¸ªç¬¬ä¸‰æ–¹æ¨¡å—ï¼ŒæŒ‰è®¿é—®urlçš„hashç»“æœæ¥åˆ†é…è¯·æ±‚ï¼Œä½¿æ¯ä¸ªurlå®šå‘åˆ°åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œåç«¯æœåŠ¡å™¨ä¸ºç¼“å­˜æ—¶æ¯”è¾ƒæœ‰æ•ˆã€‚ åœ¨upstreamä¸­åŠ å…¥hashè¯­å¥ï¼Œserverè¯­å¥ä¸­ä¸èƒ½å†™å…¥weightç­‰å…¶ä»–çš„å‚æ•°ï¼Œhash_methodæ˜¯ä½¿ç”¨çš„hashç®—æ³•")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" backend")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("hash")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request_uri")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("hash_method")]),s._v(" crc32")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" localhost:8080")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" localhost:8081")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("ä»¥ä¸Š5ç§è´Ÿè½½å‡è¡¡å„è‡ªé€‚ç”¨ä¸åŒæƒ…å†µä¸‹ä½¿ç”¨ï¼Œæ‰€ä»¥å¯ä»¥æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©ä½¿ç”¨å“ªç§ç­–ç•¥æ¨¡å¼ï¼Œä¸è¿‡fairå’Œurl_hashéœ€è¦å®‰è£…ç¬¬ä¸‰æ–¹æ¨¡å—æ‰èƒ½ä½¿ç”¨")]),s._v(" "),t("p",[t("strong",[s._v("serveræŒ‡ä»¤å¯é€‰å‚æ•°ï¼š")])]),s._v(" "),t("ol",[t("li",[s._v("weightï¼šè®¾ç½®ä¸€ä¸ªæœåŠ¡å™¨çš„è®¿é—®æƒé‡ï¼Œæ•°å€¼è¶Šé«˜ï¼Œæ”¶åˆ°çš„è¯·æ±‚ä¹Ÿè¶Šå¤šï¼›")]),s._v(" "),t("li",[s._v("fail_timeoutï¼šåœ¨è¿™ä¸ªæŒ‡å®šçš„æ—¶é—´å†…æœåŠ¡å™¨å¿…é¡»æä¾›å“åº”ï¼Œå¦‚æœåœ¨è¿™ä¸ªæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°å“åº”ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°†ä¼šè¢«æ ‡è®°ä¸ºdownçŠ¶æ€ï¼›")]),s._v(" "),t("li",[s._v("max_failsï¼šè®¾ç½®åœ¨fail_timeoutæ—¶é—´ä¹‹å†…å°è¯•å¯¹ä¸€ä¸ªæœåŠ¡å™¨è¿æ¥çš„æœ€å¤§æ¬¡æ•°ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªæ¬¡æ•°ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°†ä¼šè¢«æ ‡è®°ä¸ºdown;")]),s._v(" "),t("li",[s._v("downï¼šæ ‡è®°ä¸€ä¸ªæœåŠ¡å™¨ä¸å†æ¥å—ä»»ä½•è¯·æ±‚ï¼›")]),s._v(" "),t("li",[s._v("backupï¼šä¸€æ—¦å…¶ä»–æœåŠ¡å™¨å®•æœºï¼Œé‚£ä¹ˆæœ‰è¯¥æ ‡è®°çš„æœºå™¨å°†ä¼šæ¥æ”¶è¯·æ±‚ã€‚")])]),s._v(" "),t("p",[t("strong",[s._v("keepaliveæŒ‡ä»¤ï¼š")])]),s._v(" "),t("p",[s._v("NginxæœåŠ¡å™¨å°†ä¼šä¸ºæ¯ä¸€ä¸ªworkerè¿›è¡Œä¿æŒåŒä¸Šæ¸¸æœåŠ¡å™¨çš„è¿æ¥ã€‚")]),s._v(" "),t("h3",{attrs:{id:"å±è”½ip"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å±è”½ip"}},[s._v("#")]),s._v(" å±è”½ip")]),s._v(" "),t("p",[s._v("åœ¨nginxçš„é…ç½®æ–‡ä»¶"),t("code",[s._v("nginx.conf")]),s._v("ä¸­åŠ å…¥å¦‚ä¸‹é…ç½®ï¼Œå¯ä»¥æ”¾åˆ°http, server, location, limit_exceptè¯­å¥å—ï¼Œéœ€è¦æ³¨æ„ç›¸å¯¹è·¯å¾„ï¼Œæœ¬ä¾‹å½“ä¸­"),t("code",[s._v("nginx.conf")]),s._v("ï¼Œ"),t("code",[s._v("blocksip.conf")]),s._v("åœ¨åŒä¸€ä¸ªç›®å½•ä¸­ã€‚")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include")]),s._v(" blockip.conf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("åœ¨blockip.confé‡Œé¢è¾“å…¥å†…å®¹ï¼Œå¦‚ï¼š")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("deny")]),s._v(" 165.91.122.67")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("deny")]),s._v(" IP")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å±è”½å•ä¸ªipè®¿é—®")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("allow")]),s._v(" IP")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å…è®¸å•ä¸ªipè®¿é—®")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("deny")]),s._v(" all")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å±è”½æ‰€æœ‰ipè®¿é—®")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("allow")]),s._v(" all")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å…è®¸æ‰€æœ‰ipè®¿é—®")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("deny")]),s._v(" 123.0.0.0/8   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å±è”½æ•´ä¸ªæ®µå³ä»123.0.0.1åˆ°123.255.255.254è®¿é—®çš„å‘½ä»¤")]),s._v("\ndeny 124.45.0.0/16 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å±è”½IPæ®µå³ä»123.45.0.1åˆ°123.45.255.254è®¿é—®çš„å‘½ä»¤")]),s._v("\ndeny 123.45.6.0/24 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å±è”½IPæ®µå³ä»123.45.6.1åˆ°123.45.6.254è®¿é—®çš„å‘½ä»¤")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å¦‚æœä½ æƒ³å®ç°è¿™æ ·çš„åº”ç”¨ï¼Œé™¤äº†å‡ ä¸ªIPå¤–ï¼Œå…¶ä»–å…¨éƒ¨æ‹’ç»")]),s._v("\nallow 1.1.1.1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("allow")]),s._v(" 1.1.1.2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("deny")]),s._v(" all")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("h2",{attrs:{id:"ç¬¬ä¸‰æ–¹æ¨¡å—å®‰è£…æ–¹æ³•"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç¬¬ä¸‰æ–¹æ¨¡å—å®‰è£…æ–¹æ³•"}},[s._v("#")]),s._v(" ç¬¬ä¸‰æ–¹æ¨¡å—å®‰è£…æ–¹æ³•")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("./configure --prefix=/ä½ çš„å®‰è£…ç›®å½•  --add-module=/ç¬¬ä¸‰æ–¹æ¨¡å—ç›®å½•\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"é‡å®šå‘"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é‡å®šå‘"}},[s._v("#")]),s._v(" é‡å®šå‘")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("permanent")]),s._v(" æ°¸ä¹…æ€§é‡å®šå‘ã€‚è¯·æ±‚æ—¥å¿—ä¸­çš„çŠ¶æ€ç ä¸º301")]),s._v(" "),t("li",[t("code",[s._v("redirect")]),s._v(" ä¸´æ—¶é‡å®šå‘ã€‚è¯·æ±‚æ—¥å¿—ä¸­çš„çŠ¶æ€ç ä¸º302")])]),s._v(" "),t("h3",{attrs:{id:"é‡å®šå‘æ•´ä¸ªç½‘ç«™"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é‡å®šå‘æ•´ä¸ªç½‘ç«™"}},[s._v("#")]),s._v(" é‡å®šå‘æ•´ä¸ªç½‘ç«™")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v(" old-site.com\n    return "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("301")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$scheme")]),s._v("://new-site.com"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request_uri")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"é‡å®šå‘å•é¡µ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é‡å®šå‘å•é¡µ"}},[s._v("#")]),s._v(" é‡å®šå‘å•é¡µ")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" = /oldpage.html")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("301")]),s._v(" http://example.org/newpage.html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"é‡å®šå‘æ•´ä¸ªå­è·¯å¾„"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é‡å®šå‘æ•´ä¸ªå­è·¯å¾„"}},[s._v("#")]),s._v(" é‡å®šå‘æ•´ä¸ªå­è·¯å¾„")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /old-site")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rewrite")]),s._v(" ^/old-site/(.*) http://example.org/new-site/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v(" permanent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h2",{attrs:{id:"æ€§èƒ½"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€§èƒ½"}},[s._v("#")]),s._v(" æ€§èƒ½")]),s._v(" "),t("h3",{attrs:{id:"å†…å®¹ç¼“å­˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å†…å®¹ç¼“å­˜"}},[s._v("#")]),s._v(" å†…å®¹ç¼“å­˜")]),s._v(" "),t("p",[s._v("å…è®¸æµè§ˆå™¨åŸºæœ¬ä¸Šæ°¸ä¹…åœ°ç¼“å­˜é™æ€å†…å®¹ã€‚ Nginxå°†ä¸ºæ‚¨è®¾ç½®Expireså’ŒCache-Controlå¤´ä¿¡æ¯ã€‚")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" /data")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("expires")]),s._v(" max")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("å¦‚æœè¦æ±‚æµè§ˆå™¨æ°¸è¿œä¸ä¼šç¼“å­˜å“åº”ï¼ˆä¾‹å¦‚ç”¨äºè·Ÿè¸ªè¯·æ±‚ï¼‰ï¼Œè¯·ä½¿ç”¨-1ã€‚")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" = /empty.gif")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("empty_gif")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("expires")]),s._v(" -1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"gzipå‹ç¼©"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#gzipå‹ç¼©"}},[s._v("#")]),s._v(" Gzipå‹ç¼©")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("on")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip_buffers")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8k")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip_comp_level")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip_http_version")]),s._v(" 1.1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip_min_length")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("256")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip_proxied")]),s._v(" any")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip_vary")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("on")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip_types")]),s._v("\n    text/xml application/xml application/atom+xml application/rss+xml application/xhtml+xml image/svg+xml\n    text/javascript application/javascript application/x-javascript\n    text/x-json application/json application/x-web-app-manifest+json\n    text/css text/plain text/x-component\n    font/opentype application/x-font-ttf application/vnd.ms-fontobject\n    image/x-icon")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip_disable")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"msie6"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("h3",{attrs:{id:"æ‰“å¼€æ–‡ä»¶ç¼“å­˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ‰“å¼€æ–‡ä»¶ç¼“å­˜"}},[s._v("#")]),s._v(" æ‰“å¼€æ–‡ä»¶ç¼“å­˜")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("open_file_cache")]),s._v(" max=1000 inactive=20s")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("open_file_cache_valid")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30s")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("open_file_cache_min_uses")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("open_file_cache_errors")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("on")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"sslç¼“å­˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sslç¼“å­˜"}},[s._v("#")]),s._v(" SSLç¼“å­˜")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_session_cache")]),s._v(" shared:SSL:10m")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_session_timeout")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10m")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"ä¸Šæ¸¸keepalive"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¸Šæ¸¸keepalive"}},[s._v("#")]),s._v(" ä¸Šæ¸¸Keepalive")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" backend")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 127.0.0.1:8080")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("keepalive")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    ...\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /api/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://backend")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_http_version")]),s._v(" 1.1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Connection "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("h3",{attrs:{id:"ç›‘æ§"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç›‘æ§"}},[s._v("#")]),s._v(" ç›‘æ§")]),s._v(" "),t("p",[s._v("ä½¿ç”¨"),t("code",[s._v("ngxtop")]),s._v("å®æ—¶è§£ænginxè®¿é—®æ—¥å¿—ï¼Œå¹¶ä¸”å°†å¤„ç†ç»“æœè¾“å‡ºåˆ°ç»ˆç«¯ï¼ŒåŠŸèƒ½ç±»ä¼¼äºç³»ç»Ÿå‘½ä»¤topã€‚æ‰€æœ‰ç¤ºä¾‹éƒ½è¯»å–nginxé…ç½®æ–‡ä»¶çš„è®¿é—®æ—¥å¿—ä½ç½®å’Œæ ¼å¼ã€‚å¦‚æœè¦æŒ‡å®šè®¿é—®æ—¥å¿—æ–‡ä»¶å’Œ/æˆ–æ—¥å¿—æ ¼å¼ï¼Œè¯·ä½¿ç”¨-få’Œ-aé€‰é¡¹ã€‚")]),s._v(" "),t("p",[s._v("æ³¨æ„ï¼šåœ¨nginxé…ç½®ä¸­"),t("code",[s._v("/usr/local/nginx/conf/nginx.conf")]),s._v("æ—¥å¿—æ–‡ä»¶å¿…é¡»æ˜¯ç»å¯¹è·¯å¾„ã€‚")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å®‰è£… ngxtop")]),s._v("\npip "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" ngxtop\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å®æ—¶çŠ¶æ€")]),s._v("\nngxtop\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# çŠ¶æ€ä¸º404çš„å‰10ä¸ªè¯·æ±‚çš„è·¯å¾„ï¼š")]),s._v("\nngxtop "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" request_path "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--filter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'status == 404'")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å‘é€æ€»å­—èŠ‚æ•°æœ€å¤šçš„å‰10ä¸ªè¯·æ±‚")]),s._v("\nngxtop --order-by "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'avg(bytes_sent) * count'")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ’åå‰åä½çš„IPï¼Œä¾‹å¦‚ï¼Œè°æ”»å‡»ä½ æœ€å¤š")]),s._v("\nngxtop --group-by remote_addr\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ‰“å°å…·æœ‰4xxæˆ–5xxçŠ¶æ€çš„è¯·æ±‚ï¼Œä»¥åŠstatuså’Œhttp referer")]),s._v("\nngxtop "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'status >= 400'")]),s._v(" print request status http_referer\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ç”±200ä¸ªè¯·æ±‚è·¯å¾„å“åº”å‘é€çš„å¹³å‡æ­£æ–‡å­—èŠ‚ä»¥'foo'å¼€å§‹ï¼š")]),s._v("\nngxtop avg bytes_sent "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--filter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'status == 200 and request_path.startswith(\"foo\")'")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ä½¿ç”¨â€œcommonâ€æ—¥å¿—æ ¼å¼ä»è¿œç¨‹æœºå™¨åˆ†æapacheè®¿é—®æ—¥å¿—")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" remote "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" /var/log/apache2/access.log "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ngxtop "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" common\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br")])]),t("h2",{attrs:{id:"å¸¸è§ä½¿ç”¨åœºæ™¯"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¸¸è§ä½¿ç”¨åœºæ™¯"}},[s._v("#")]),s._v(" å¸¸è§ä½¿ç”¨åœºæ™¯")]),s._v(" "),t("h3",{attrs:{id:"è·¨åŸŸé—®é¢˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#è·¨åŸŸé—®é¢˜"}},[s._v("#")]),s._v(" è·¨åŸŸé—®é¢˜")]),s._v(" "),t("p",[s._v("åœ¨å·¥ä½œä¸­ï¼Œæœ‰æ—¶å€™ä¼šé‡åˆ°ä¸€äº›æ¥å£ä¸æ”¯æŒè·¨åŸŸï¼Œè¿™æ—¶å€™å¯ä»¥ç®€å•çš„æ·»åŠ add_headersæ¥æ”¯æŒcorsè·¨åŸŸã€‚é…ç½®å¦‚ä¸‹ï¼š")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v(" api.xxx.com")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Access-Control-Allow-Origin'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Access-Control-Allow-Credentials'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'true'")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Access-Control-Allow-Methods'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'GET,POST,HEAD'")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://127.0.0.1:3000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X-Real-IP "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X-Forwarded-For "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$proxy_add_x_forwarded_for")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Host  "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_host")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    \n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("p",[s._v("ä¸Šé¢æ›´æ”¹å¤´ä¿¡æ¯ï¼Œè¿˜æœ‰ä¸€ç§ï¼Œä½¿ç”¨ "),t("a",{attrs:{href:"http://nginx.org/en/docs/http/ngx_http_rewrite_module.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("rewrite"),t("OutboundLink")],1),s._v(" æŒ‡ä»¤é‡å®šå‘URIæ¥è§£å†³è·¨åŸŸé—®é¢˜ã€‚")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" test")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 127.0.0.1:8080")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" localhost:8081")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v(" api.xxx.com")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("  html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("                   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#å»è¯·æ±‚../htmlæ–‡ä»¶å¤¹é‡Œçš„æ–‡ä»¶")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v("  index.html index.htm")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#é¦–é¡µå“åº”åœ°å€")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ç”¨äºæ‹¦æˆªè¯·æ±‚ï¼ŒåŒ¹é…ä»»ä½•ä»¥ /api/å¼€å¤´çš„åœ°å€ï¼Œ")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åŒ¹é…ç¬¦åˆä»¥åï¼Œåœæ­¢å¾€ä¸‹æœç´¢æ­£åˆ™ã€‚")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" ^~/api/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ä»£è¡¨é‡å†™æ‹¦æˆªè¿›æ¥çš„è¯·æ±‚ï¼Œå¹¶ä¸”åªèƒ½å¯¹åŸŸååè¾¹çš„é™¤å»ä¼ é€’çš„å‚æ•°å¤–çš„å­—ç¬¦ä¸²èµ·ä½œç”¨ï¼Œ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ä¾‹å¦‚www.a.com/proxy/api/msg?meth=1&par=2é‡å†™ï¼Œåªå¯¹/proxy/api/msgé‡å†™ã€‚")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rewriteåé¢çš„å‚æ•°æ˜¯ä¸€ä¸ªç®€å•çš„æ­£åˆ™ ^/api/(.*)$ï¼Œ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# $1ä»£è¡¨æ­£åˆ™ä¸­çš„ç¬¬ä¸€ä¸ª()ï¼Œ$2ä»£è¡¨ç¬¬äºŒä¸ª()çš„å€¼ï¼Œä»¥æ­¤ç±»æ¨ã€‚")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rewrite")]),s._v(" ^/api/(.*)$ /"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v(" break")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æŠŠè¯·æ±‚ä»£ç†åˆ°å…¶ä»–ä¸»æœº ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å…¶ä¸­ http://www.b.com/ å†™æ³•å’Œ http://www.b.comå†™æ³•çš„åŒºåˆ«å¦‚ä¸‹")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å¦‚æœä½ çš„è¯·æ±‚åœ°å€æ˜¯ä»– http://server/html/test.jsp")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é…ç½®ä¸€ï¼š http://www.b.com/ åé¢æœ‰â€œ/â€ ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#         å°†åå‘ä»£ç†æˆ http://www.b.com/html/test.jsp è®¿é—®")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é…ç½®ä¸€ï¼š http://www.b.com åé¢æ²¡æœ‰æœ‰â€œ/â€ ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#         å°†åå‘ä»£ç†æˆ http://www.b.com/test.jsp è®¿é—®")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://test")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å¦‚æœ proxy_pass  URL æ˜¯ http://a.xx.com/platform/ è¿™ç§æƒ…å†µ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# proxy_cookie_pathåº”è¯¥è®¾ç½®æˆ /platform/ / (æ³¨æ„ä¸¤ä¸ªæ–œæ ä¹‹é—´æœ‰ç©ºæ ¼)ã€‚")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_cookie_path")]),s._v(" /platfrom/ /")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_pass_header")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è®¾ç½® Cookie å¤´é€šè¿‡")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass_header")]),s._v(" Set-Cookie")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br")])]),t("h3",{attrs:{id:"è·³è½¬åˆ°å¸¦wwwçš„åŸŸä¸Šé¢"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#è·³è½¬åˆ°å¸¦wwwçš„åŸŸä¸Šé¢"}},[s._v("#")]),s._v(" è·³è½¬åˆ°å¸¦wwwçš„åŸŸä¸Šé¢")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é…ç½®æ­£å¸¸çš„å¸¦wwwçš„åŸŸå")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v(" www.wangchujiang.com")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" /home/www/wabg/download")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try_files")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v("/ /index.html =404")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è¿™ä¸ªè¦æ”¾åˆ°ä¸‹é¢ï¼Œ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å°†ä¸å¸¦wwwçš„ wangchujiang.com æ°¸ä¹…æ€§é‡å®šå‘åˆ°  https://www.wangchujiang.com")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v(" wangchujiang.com")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rewrite")]),s._v(" ^(.*) https://www.wangchujiang.com"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v(" permanent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("h3",{attrs:{id:"ä»£ç†è½¬å‘"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä»£ç†è½¬å‘"}},[s._v("#")]),s._v(" ä»£ç†è½¬å‘")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" server-api")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# api ä»£ç†æœåŠ¡åœ°å€")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 127.0.0.1:3110")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" server-resource")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é™æ€èµ„æº ä»£ç†æœåŠ¡åœ°å€")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 127.0.0.1:3120")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3111")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  localhost")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è¿™é‡ŒæŒ‡å®šåŸŸå")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" /home/www/server-statics")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åŒ¹é… api è·¯ç”±çš„åå‘ä»£ç†åˆ°APIæœåŠ¡")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" ^~/api/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rewrite")]),s._v(" ^/(.*)$ /"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v(" break")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://server-api")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å‡è®¾è¿™é‡ŒéªŒè¯ç ä¹Ÿåœ¨APIæœåŠ¡ä¸­")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" ^~/captcha")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rewrite")]),s._v(" ^/(.*)$ /"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v(" break")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://server-api")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å‡è®¾ä½ çš„å›¾ç‰‡èµ„æºå…¨éƒ¨åœ¨å¦å¤–ä¸€ä¸ªæœåŠ¡ä¸Šé¢")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" ^~/img/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rewrite")]),s._v(" ^/(.*)$ /"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v(" break")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://server-resource")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è·¯ç”±åœ¨å‰ç«¯ï¼Œåç«¯æ²¡æœ‰çœŸå®è·¯ç”±ï¼Œåœ¨è·¯ç”±ä¸å­˜åœ¨çš„ 404çŠ¶æ€çš„é¡µé¢è¿”å› /index.html")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è¿™ä¸ªæ–¹å¼ä½¿ç”¨åœºæ™¯ï¼Œä½ åœ¨å†™Reactæˆ–è€…Vueé¡¹ç›®çš„æ—¶å€™ï¼Œæ²¡æœ‰çœŸå®è·¯ç”±")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try_files")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v("/ /index.html =404")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#                               ^ ç©ºæ ¼å¾ˆé‡è¦")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br")])]),t("h3",{attrs:{id:"ç›‘æ§çŠ¶æ€ä¿¡æ¯"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç›‘æ§çŠ¶æ€ä¿¡æ¯"}},[s._v("#")]),s._v(" ç›‘æ§çŠ¶æ€ä¿¡æ¯")]),s._v(" "),t("p",[s._v("é€šè¿‡ "),t("code",[s._v("nginx -V")]),s._v(" æ¥æŸ¥çœ‹æ˜¯å¦æœ‰ "),t("code",[s._v("with-http_stub_status_module")]),s._v(" è¯¥æ¨¡å—ã€‚")]),s._v(" "),t("blockquote",[t("p",[t("code",[s._v("nginx -V")]),s._v(" è¿™é‡Œ "),t("code",[s._v("V")]),s._v(" æ˜¯å¤§å†™çš„ï¼Œå¦‚æœæ˜¯å°å†™çš„ "),t("code",[s._v("v")]),s._v(" å³ "),t("code",[s._v("nginx -v")]),s._v("ï¼Œåˆ™ä¸ä¼šå‡ºç°æœ‰å“ªäº›æ¨¡å—ï¼Œåªä¼šå‡ºç° "),t("code",[s._v("nginx")]),s._v(" çš„ç‰ˆæœ¬")])]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /nginx_status")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("stub_status")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("on")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("access_log")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("off")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("é€šè¿‡ http://127.0.0.1/nginx_status è®¿é—®å‡ºç°ä¸‹é¢ç»“æœã€‚")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("Active connections: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\nserver accepts handled requests\n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" \nReading: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" Writing: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" Waiting: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("ol",[t("li",[s._v("ä¸»åŠ¨è¿æ¥(ç¬¬ 1 è¡Œ)")])]),s._v(" "),t("p",[s._v("å½“å‰ä¸httpå»ºç«‹çš„è¿æ¥æ•°ï¼ŒåŒ…æ‹¬ç­‰å¾…çš„å®¢æˆ·ç«¯è¿æ¥ï¼š3")]),s._v(" "),t("ol",{attrs:{start:"2"}},[t("li",[s._v("æœåŠ¡å™¨æ¥å—å¤„ç†çš„è¯·æ±‚(ç¬¬ 2~3 è¡Œ)")])]),s._v(" "),t("p",[s._v("æ¥å—çš„å®¢æˆ·ç«¯è¿æ¥æ€»æ•°ç›®ï¼š7"),t("br"),s._v("\nå¤„ç†çš„å®¢æˆ·ç«¯è¿æ¥æ€»æ•°ç›®ï¼š7"),t("br"),s._v("\nå®¢æˆ·ç«¯æ€»çš„è¯·æ±‚æ•°ç›®ï¼š5")]),s._v(" "),t("ol",{attrs:{start:"3"}},[t("li",[s._v("è¯»å–å…¶å®ƒä¿¡(ç¬¬ 4 è¡Œ)")])]),s._v(" "),t("p",[s._v("å½“å‰ï¼Œnginxè¯»è¯·æ±‚è¿æ¥"),t("br"),s._v("\nå½“å‰ï¼Œnginxå†™å“åº”è¿”å›ç»™å®¢æˆ·ç«¯"),t("br"),s._v("\nç›®å‰æœ‰å¤šå°‘ç©ºé—²å®¢æˆ·ç«¯è¯·æ±‚è¿æ¥")]),s._v(" "),t("h3",{attrs:{id:"ä»£ç†è½¬å‘è¿æ¥æ›¿æ¢"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä»£ç†è½¬å‘è¿æ¥æ›¿æ¢"}},[s._v("#")]),s._v(" ä»£ç†è½¬å‘è¿æ¥æ›¿æ¢")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" ^~/api/upload")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rewrite")]),s._v(" ^/(.*)$ /wfs/v1/upload break")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://wfs-api")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"sslé…ç½®"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sslé…ç½®"}},[s._v("#")]),s._v(" sslé…ç½®")]),s._v(" "),t("p",[s._v("è¶…æ–‡æœ¬ä¼ è¾“å®‰å…¨åè®®ï¼ˆç¼©å†™ï¼šHTTPSï¼Œè‹±è¯­ï¼šHypertext Transfer Protocol Secureï¼‰æ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®å’ŒSSL/TLSçš„ç»„åˆï¼Œç”¨ä»¥æä¾›åŠ å¯†é€šè®¯åŠå¯¹ç½‘ç»œæœåŠ¡å™¨èº«ä»½çš„é‰´å®šã€‚HTTPSè¿æ¥ç»å¸¸è¢«ç”¨äºä¸‡ç»´ç½‘ä¸Šçš„äº¤æ˜“æ”¯ä»˜å’Œä¼ä¸šä¿¡æ¯ç³»ç»Ÿä¸­æ•æ„Ÿä¿¡æ¯çš„ä¼ è¾“ã€‚HTTPSä¸åº”ä¸åœ¨RFC 2660ä¸­å®šä¹‰çš„å®‰å…¨è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆS-HTTPï¼‰ç›¸æ··ã€‚HTTPS ç›®å‰å·²ç»æ˜¯æ‰€æœ‰æ³¨é‡éšç§å’Œå®‰å…¨çš„ç½‘ç«™çš„é¦–é€‰ï¼Œéšç€æŠ€æœ¯çš„ä¸æ–­å‘å±•ï¼ŒHTTPS ç½‘ç«™å·²ä¸å†æ˜¯å¤§å‹ç½‘ç«™çš„ä¸“åˆ©ï¼Œæ‰€æœ‰æ™®é€šçš„ä¸ªäººç«™é•¿å’Œåšå®¢å‡å¯ä»¥è‡ªå·±åŠ¨æ‰‹æ­å»ºä¸€ä¸ªå®‰å…¨çš„åŠ å¯†çš„ç½‘ç«™ã€‚")]),s._v(" "),t("p",[s._v("åˆ›å»ºSSLè¯ä¹¦ï¼Œå¦‚æœä½ è´­ä¹°çš„è¯ä¹¦ï¼Œå°±å¯ä»¥ç›´æ¥ä¸‹è½½")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /etc/nginx/ssl\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åˆ›å»ºäº†æœ‰æ•ˆæœŸ100å¹´ï¼ŒåŠ å¯†å¼ºåº¦ä¸ºRSA2048çš„SSLå¯†é’¥keyå’ŒX509è¯ä¹¦æ–‡ä»¶ã€‚")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" openssl req "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-x509")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-nodes")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-days")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("36500")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-newkey")]),s._v(" rsa:2048 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-keyout")]),s._v(" /etc/nginx/ssl/nginx.key "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-out")]),s._v(" /etc/nginx/ssl/nginx.crt\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ä¸Šé¢å‘½ä»¤ï¼Œä¼šæœ‰ä¸‹é¢éœ€è¦å¡«å†™å†…å®¹")]),s._v("\nCountry Name "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" letter code"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("AU"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":US\nState or Province Name "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("full name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Some-State"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":New York\nLocality Name "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("eg, city"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":New York City\nOrganization Name "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("eg, company"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Internet Widgits Pty Ltd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":Bouncy Castles, Inc.\nOrganizational Unit Name "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("eg, section"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":Ministry of Water Slides\nCommon Name "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("e.g. server FQDN or YOUR name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":your_domain.com\nEmail Address "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":admin@your_domain.com\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[s._v("åˆ›å»ºè‡ªç­¾è¯ä¹¦")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("é¦–å…ˆï¼Œåˆ›å»ºè¯ä¹¦å’Œç§é’¥çš„ç›®å½•\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir -p /etc/nginx/cert")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd /etc/nginx/cert")]),s._v("\nåˆ›å»ºæœåŠ¡å™¨ç§é’¥ï¼Œå‘½ä»¤ä¼šè®©ä½ è¾“å…¥ä¸€ä¸ªå£ä»¤ï¼š\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# openssl genrsa -des3 -out nginx.key 2048")]),s._v("\nåˆ›å»ºç­¾åè¯·æ±‚çš„è¯ä¹¦ï¼ˆCSRï¼‰ï¼š\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# openssl req -new -key nginx.key -out nginx.csr")]),s._v("\nåœ¨åŠ è½½SSLæ”¯æŒçš„Nginxå¹¶ä½¿ç”¨ä¸Šè¿°ç§é’¥æ—¶é™¤å»å¿…é¡»çš„å£ä»¤ï¼š\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cp nginx.key nginx.key.org")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# openssl rsa -in nginx.key.org -out nginx.key")]),s._v("\næœ€åæ ‡è®°è¯ä¹¦ä½¿ç”¨ä¸Šè¿°ç§é’¥å’ŒCSRï¼š\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# openssl x509 -req -days 365 -in nginx.csr -signkey nginx.key -out nginx.crt")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("æŸ¥çœ‹ç›®å‰nginxç¼–è¯‘é€‰é¡¹")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sbin/nginx -V\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è¾“å‡ºä¸‹é¢å†…å®¹")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("nginx version: nginx/1.7.8\nbuilt by gcc 4.4.7 20120313 (Red Hat 4.4.7-4) (GCC)\nTLS SNI support enabled\nconfigure arguments: --prefix=/usr/local/nginx-1.7.8 --with-http_ssl_module --with-http_spdy_module --with-http_stub_status_module --with-pcre\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("å¦‚æœä¾èµ–çš„æ¨¡å—ä¸å­˜åœ¨ï¼Œå¯ä»¥è¿›å…¥å®‰è£…ç›®å½•ï¼Œè¾“å…¥ä¸‹é¢å‘½ä»¤é‡æ–°ç¼–è¯‘å®‰è£…ã€‚")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("./configure "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--prefix")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è¿è¡Œå®Œæˆä¹‹åè¿˜éœ€è¦"),t("code",[s._v("make")]),s._v(" (ä¸ç”¨make install)")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å¤‡ä»½nginxçš„äºŒè¿›åˆ¶æ–‡ä»¶")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rf")]),s._v(" /usr/local/nginx/sbin/nginxã€€ /usr/local/nginx/sbin/nginx.bak\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è¦†ç›–nginxçš„äºŒè¿›åˆ¶æ–‡ä»¶")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rf")]),s._v(" objs/nginx   /usr/local/nginx/sbin/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("HTTPS server")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v(" ssl")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  localhost")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_certificate")]),s._v(" /etc/nginx/ssl/nginx.crt")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_certificate_key")]),s._v(" /etc/nginx/ssl/nginx.key")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ç¦æ­¢åœ¨headerä¸­å‡ºç°æœåŠ¡å™¨ç‰ˆæœ¬ï¼Œé˜²æ­¢é»‘å®¢åˆ©ç”¨ç‰ˆæœ¬æ¼æ´æ”»å‡»")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_tokens")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("off")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è®¾ç½®ssl/tlsä¼šè¯ç¼“å­˜çš„ç±»å‹å’Œå¤§å°ã€‚å¦‚æœè®¾ç½®äº†è¿™ä¸ªå‚æ•°ä¸€èˆ¬æ˜¯sharedï¼Œbuildinå¯èƒ½ä¼šå‚æ•°å†…å­˜ç¢ç‰‡ï¼Œé»˜è®¤æ˜¯noneï¼Œå’Œoffå·®ä¸å¤šï¼Œåœç”¨ç¼“å­˜ã€‚å¦‚shared:SSL:10mè¡¨ç¤ºæˆ‘æ‰€æœ‰çš„nginxå·¥ä½œè¿›ç¨‹å…±äº«sslä¼šè¯ç¼“å­˜ï¼Œå®˜ç½‘ä»‹ç»è¯´1Må¯ä»¥å­˜æ”¾çº¦4000ä¸ªsessionsã€‚ ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_session_cache")]),s._v("    shared:SSL:1m")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å®¢æˆ·ç«¯å¯ä»¥é‡ç”¨ä¼šè¯ç¼“å­˜ä¸­sslå‚æ•°çš„è¿‡æœŸæ—¶é—´ï¼Œå†…ç½‘ç³»ç»Ÿé»˜è®¤5åˆ†é’Ÿå¤ªçŸ­äº†ï¼Œå¯ä»¥è®¾æˆ30må³30åˆ†é’Ÿç”šè‡³4hã€‚")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_session_timeout")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5m")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é€‰æ‹©åŠ å¯†å¥—ä»¶ï¼Œä¸åŒçš„æµè§ˆå™¨æ‰€æ”¯æŒçš„å¥—ä»¶ï¼ˆå’Œé¡ºåºï¼‰å¯èƒ½ä¼šä¸åŒã€‚")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è¿™é‡ŒæŒ‡å®šçš„æ˜¯OpenSSLåº“èƒ½å¤Ÿè¯†åˆ«çš„å†™æ³•ï¼Œä½ å¯ä»¥é€šè¿‡ openssl -v cipher 'RC4:HIGH:!aNULL:!MD5'ï¼ˆåé¢æ˜¯ä½ æ‰€æŒ‡å®šçš„å¥—ä»¶åŠ å¯†ç®—æ³•ï¼‰ æ¥çœ‹æ‰€æ”¯æŒç®—æ³•ã€‚")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_ciphers")]),s._v("  HIGH:!aNULL:!MD5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è®¾ç½®åå•†åŠ å¯†ç®—æ³•æ—¶ï¼Œä¼˜å…ˆä½¿ç”¨æˆ‘ä»¬æœåŠ¡ç«¯çš„åŠ å¯†å¥—ä»¶ï¼Œè€Œä¸æ˜¯å®¢æˆ·ç«¯æµè§ˆå™¨çš„åŠ å¯†å¥—ä»¶ã€‚")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_prefer_server_ciphers")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("on")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("   html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v("  index.html index.htm")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br")])]),t("h3",{attrs:{id:"å¼ºåˆ¶å°†httpé‡å®šå‘åˆ°https"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¼ºåˆ¶å°†httpé‡å®šå‘åˆ°https"}},[s._v("#")]),s._v(" å¼ºåˆ¶å°†httpé‡å®šå‘åˆ°https")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  example.com")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rewrite")]),s._v(" ^ https://"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_host")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request_uri?")]),s._v(" permanent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å¼ºåˆ¶å°†httpé‡å®šå‘åˆ°https")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åœ¨é”™è¯¯é¡µé¢å’Œâ€œæœåŠ¡å™¨â€å“åº”å¤´å­—æ®µä¸­å¯ç”¨æˆ–ç¦ç”¨å‘å°„nginxç‰ˆæœ¬ã€‚ é˜²æ­¢é»‘å®¢åˆ©ç”¨ç‰ˆæœ¬æ¼æ´æ”»å‡»")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_tokens")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("off")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h3",{attrs:{id:"ä¸¤ä¸ªè™šæ‹Ÿä¸»æœº"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¸¤ä¸ªè™šæ‹Ÿä¸»æœº"}},[s._v("#")]),s._v(" ä¸¤ä¸ªè™šæ‹Ÿä¸»æœº")]),s._v(" "),t("p",[s._v("çº¯é™æ€-html æ”¯æŒ")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("     www.domain1.com")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("access_log")]),s._v("      logs/domain1.access.log main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" index.html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("  /var/www/domain1.com/htdocs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("     www.domain2.com")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("access_log")]),s._v("      logs/domain2.access.log main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" index.html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("  /var/www/domain2.com/htdocs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("h3",{attrs:{id:"è™šæ‹Ÿä¸»æœºæ ‡å‡†é…ç½®"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#è™šæ‹Ÿä¸»æœºæ ‡å‡†é…ç½®"}},[s._v("#")]),s._v(" è™šæ‹Ÿä¸»æœºæ ‡å‡†é…ç½®")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" default")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("     _ *")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("access_log")]),s._v("      logs/default.access.log main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" index.html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("  /var/www/default/htdocs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("h3",{attrs:{id:"çˆ¬è™«è¿‡æ»¤"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#çˆ¬è™«è¿‡æ»¤"}},[s._v("#")]),s._v(" çˆ¬è™«è¿‡æ»¤")]),s._v(" "),t("p",[s._v("æ ¹æ® "),t("code",[s._v("User-Agent")]),s._v(" è¿‡æ»¤è¯·æ±‚ï¼Œé€šè¿‡ä¸€ä¸ªç®€å•çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œå°±å¯ä»¥è¿‡æ»¤ä¸ç¬¦åˆè¦æ±‚çš„çˆ¬è™«è¯·æ±‚(åˆçº§çˆ¬è™«)ã€‚")]),s._v(" "),t("blockquote",[t("p",[t("code",[s._v("~*")]),s._v(" è¡¨ç¤ºä¸åŒºåˆ†å¤§å°å†™çš„æ­£åˆ™åŒ¹é…")])]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" ("),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_user_agent")]),s._v(" ~* "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"python|curl|java|wget|httpclient|okhttp"')]),s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ­£å¸¸å¤„ç†")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ...")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h3",{attrs:{id:"é˜²ç›—é“¾"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é˜²ç›—é“¾"}},[s._v("#")]),s._v(" é˜²ç›—é“¾")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" ~* \\.(gif|jpg|png|swf|flv)$")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" html\n   valid_referers none blocked *.nginxcn.com")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" ("),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$invalid_referer")]),s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n     rewrite ^/ www.nginx.cn\n     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#return 404;")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h3",{attrs:{id:"è™šæ‹Ÿç›®å½•é…ç½®"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#è™šæ‹Ÿç›®å½•é…ç½®"}},[s._v("#")]),s._v(" è™šæ‹Ÿç›®å½•é…ç½®")]),s._v(" "),t("p",[s._v("aliasæŒ‡å®šçš„ç›®å½•æ˜¯å‡†ç¡®çš„ï¼Œrootæ˜¯æŒ‡å®šç›®å½•çš„ä¸Šçº§ç›®å½•ï¼Œå¹¶ä¸”è¯¥ä¸Šçº§ç›®å½•è¦å«æœ‰locationæŒ‡å®šåç§°çš„åŒåç›®å½•ã€‚")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /img/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alias")]),s._v(" /var/www/image/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è®¿é—®/img/ç›®å½•é‡Œé¢çš„æ–‡ä»¶æ—¶ï¼Œningxä¼šè‡ªåŠ¨å»/var/www/image/ç›®å½•æ‰¾æ–‡ä»¶")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /img/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" /var/www/image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è®¿é—®/img/ç›®å½•ä¸‹çš„æ–‡ä»¶æ—¶ï¼Œnginxä¼šå»/var/www/image/img/ç›®å½•ä¸‹æ‰¾æ–‡ä»¶ã€‚]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h3",{attrs:{id:"é˜²ç›—å›¾é…ç½®"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é˜²ç›—å›¾é…ç½®"}},[s._v("#")]),s._v(" é˜²ç›—å›¾é…ç½®")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" ~ \\/public\\/(css|js|img)\\/.*\\.(js|css|gif|jpg|jpeg|png|bmp|swf)")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("valid_referers")]),s._v(" none blocked *.jslite.io")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" ("),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$invalid_referer")]),s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rewrite")]),s._v(" ^/  http://wangchujiang.com/piratesp.png")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h3",{attrs:{id:"å±è”½-gitç­‰æ–‡ä»¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å±è”½-gitç­‰æ–‡ä»¶"}},[s._v("#")]),s._v(" å±è”½.gitç­‰æ–‡ä»¶")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" ~ (.git|.gitattributes|.gitignore|.svn)")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("deny")]),s._v(" all")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"åŸŸåè·¯å¾„åŠ ä¸åŠ éœ€è¦éƒ½èƒ½æ­£å¸¸è®¿é—®"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#åŸŸåè·¯å¾„åŠ ä¸åŠ éœ€è¦éƒ½èƒ½æ­£å¸¸è®¿é—®"}},[s._v("#")]),s._v(" åŸŸåè·¯å¾„åŠ ä¸åŠ éœ€è¦éƒ½èƒ½æ­£å¸¸è®¿é—®")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("http://wangchujiang.com/api/index.php?a"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("wcj\n                                  ^ æœ‰åç¼€\n\nhttp://wangchujiang.com/api/index?a"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("wcj\n                                 ^ æ²¡æœ‰åç¼€\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("nginx rewriteè§„åˆ™å¦‚ä¸‹ï¼š")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rewrite")]),s._v(" ^/(.*)/$ /index.php?/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v(" permanent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" (!-d "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request_filename")]),s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$rule_1")]),s._v(" 1"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$rule_1")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" (!-f "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request_filename")]),s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$rule_1")]),s._v(" 2"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$rule_1")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" ("),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$rule_1")]),s._v(" = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"21"')]),s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rewrite")]),s._v(" ^/ /index.php last")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("h2",{attrs:{id:"é”™è¯¯é—®é¢˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é”™è¯¯é—®é¢˜"}},[s._v("#")]),s._v(" é”™è¯¯é—®é¢˜")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("The plain HTTP request was sent to HTTPS port\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è§£å†³åŠæ³•ï¼Œ"),t("code",[s._v("fastcgi_param HTTPS $https if_not_empty")]),s._v(" æ·»åŠ è¿™æ¡è§„åˆ™ï¼Œ")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v(" ssl")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ³¨æ„è¿™æ¡è§„åˆ™")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  my.domain.com")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fastcgi_param")]),s._v(" HTTPS "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$https")]),s._v(" if_not_empty")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fastcgi_param")]),s._v(" HTTPS "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("on")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_certificate")]),s._v(" /etc/ssl/certs/your.pem")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_certificate_key")]),s._v(" /etc/ssl/private/your.key")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Your config here...")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("h2",{attrs:{id:"ç²¾å“æ–‡ç« å‚è€ƒ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç²¾å“æ–‡ç« å‚è€ƒ"}},[s._v("#")]),s._v(" ç²¾å“æ–‡ç« å‚è€ƒ")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://my.oschina.net/u/3341316/blog/877206",target:"_blank",rel:"noopener noreferrer"}},[s._v("è´Ÿè½½å‡è¡¡åŸç†çš„è§£æ"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"http://blog.githuber.cn/posts/73",target:"_blank",rel:"noopener noreferrer"}},[s._v("Nginxæ³›åŸŸåè§£æï¼Œå®ç°å¤šä¸ªäºŒçº§åŸŸå "),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://www.nginx.com/blog/inside-nginx-how-we-designed-for-performance-scale/",target:"_blank",rel:"noopener noreferrer"}},[s._v("æ·±å…¥ NGINX: æˆ‘ä»¬å¦‚ä½•è®¾è®¡æ€§èƒ½å’Œæ‰©å±•"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://www.nginx.com/blog/inside-nginx-how-we-designed-for-performance-scale/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Inside NGINX: How We Designed for Performance & Scale"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"http://tengine.taobao.org/book/index.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Nginxå¼€å‘ä»å…¥é—¨åˆ°ç²¾é€š"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"http://os.51cto.com/art/201703/535326.htm#topx",target:"_blank",rel:"noopener noreferrer"}},[s._v("Nginxçš„ä¼˜åŒ–ä¸é˜²ç›—é“¾"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://segmentfault.com/a/1190000009769143",target:"_blank",rel:"noopener noreferrer"}},[s._v("å®æˆ˜å¼€å‘ä¸€ä¸ªNginxæ‰©å±• (Nginx Module)"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://my.oschina.net/xshuai/blog/917097",target:"_blank",rel:"noopener noreferrer"}},[s._v("Nginx+Keepalived(åŒæœºçƒ­å¤‡)æ­å»ºé«˜å¯ç”¨è´Ÿè½½å‡è¡¡ç¯å¢ƒ(HA)"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"http://www.huxd.org/articles/2017/07/24/1500890692329.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Nginx å¹³æ»‘å‡çº§"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzIxNzg5ODE0OA==&mid=2247483708&idx=1&sn=90b0b1dccd9c337922a0588245277666&chksm=97f38cf7a08405e1928e0b46d923d630e529e7db8ac7ca2a91310a075986f8bcb2cee5b4953d#rd",target:"_blank",rel:"noopener noreferrer"}},[s._v("Nginxæœ€æ–°æ¨¡å—â€”ngx_http_mirror_moduleåˆ†æå¯ä»¥åšç‰ˆæœ¬å‘å¸ƒå‰çš„é¢„å…ˆéªŒè¯ï¼Œè¿›è¡Œæµé‡æ”¾å¤§åçš„å‹æµ‹ç­‰ç­‰"),t("OutboundLink")],1)])]),s._v(" "),t("p",[s._v("è½¬è‡ª"),t("a",{attrs:{href:"https://github.com/jaywcjlove/nginx-tutorial/blob/master/README.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("nginx"),t("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=e.exports}}]);