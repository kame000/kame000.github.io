(window.webpackJsonp=window.webpackJsonp||[]).push([[94],{500:function(s,t,a){"use strict";a.r(t);var e=a(2),r=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"glusrefs-历史及由来"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#glusrefs-历史及由来"}},[s._v("#")]),s._v(" glusrefs  历史及由来")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"title"}),t("p",[s._v("GlusterFS 是近年兴起的一个高性能开源分布式文件系统，其目标是全局命名空间、分布式前端的高性能文件系统，目前已被 RedHat 看中，GlusterFS 具有高扩展、高可性、高性能、可横向扩展等特点，并且 GlusterFS 没有元数据服务器的设计，使其没有单点故障问题。")])]),t("h2",{attrs:{id:"glusterfs-集群搭建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#glusterfs-集群搭建"}},[s._v("#")]),s._v(" GlusterFS 集群搭建")]),s._v(" "),t("h3",{attrs:{id:"环境准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#环境准备"}},[s._v("#")]),s._v(" 环境准备")]),s._v(" "),t("p",[t("code",[s._v("搭建环境如下")])]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("主机")]),s._v(" "),t("th",[s._v("域名")]),s._v(" "),t("th",[s._v("磁盘")]),s._v(" "),t("th",[s._v("大小")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("192.168.1.100")]),s._v(" "),t("td",[s._v("test-server1")]),s._v(" "),t("td",[s._v("/dev/sdb")]),s._v(" "),t("td",[s._v("50G")])]),s._v(" "),t("tr",[t("td",[s._v("192.168.1.107")]),s._v(" "),t("td",[s._v("test-server2")]),s._v(" "),t("td",[s._v("/dev/sdb")]),s._v(" "),t("td",[s._v("50G")])]),s._v(" "),t("tr",[t("td",[s._v("192.168.1.126")]),s._v(" "),t("td",[s._v("test-server3")]),s._v(" "),t("td",[s._v("/dev/sdb")]),s._v(" "),t("td",[s._v("50G")])]),s._v(" "),t("tr",[t("td",[s._v("192.168.1.217")]),s._v(" "),t("td",[s._v("test-server4")]),s._v(" "),t("td",[s._v("/dev/sdb")]),s._v(" "),t("td",[s._v("50G")])])])]),s._v(" "),t("h3",{attrs:{id:"安装-glusterfs"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装-glusterfs"}},[s._v("#")]),s._v(" 安装 GlusterFS")]),s._v(" "),t("blockquote",[t("p",[s._v("CentOS7 默认官方 yum 源中有 GlusterFS 相关的 rpm 包，但是发现没有 server 端的，官方给出的安装命令如下")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装 GlusterFS yum 源")]),s._v("\n  yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" centos-release-gluster "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" yum update "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装 GlusterFS 以及客户端")]),s._v("\n  yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" glusterfs glusterfs-fuse glusterfs-cli glusterfs-server glusterfs-api\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"基础环境配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基础环境配置"}},[s._v("#")]),s._v(" 基础环境配置")]),s._v(" "),t("h4",{attrs:{id:"ntp-时钟同步"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ntp-时钟同步"}},[s._v("#")]),s._v(" ntp 时钟同步")]),s._v(" "),t("blockquote",[t("p",[s._v("由于 GlusterFS 需要进行节点间同步，所以各节点时间要保证一致性，故需要安装 ntp 时钟同步工具")])]),s._v(" "),t("ul",[t("li",[s._v("安装 ntp")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("    yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" ntp\n    安装完成后应进行时钟同步，这里暂时使用 windows 的时钟授权服务器，也可以选择其他时钟授权服务器，安装时测试国内的清华大等全部超时……\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ul",[t("li",[s._v("同步时钟")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v(" ntpdate time.windows.com\n 同步完成后最好设置定时同步，以下为每天 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" 时开始没 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" 小时进行一次时钟同步\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ul",[t("li",[s._v("增加 当前用户 cron 任务")])]),s._v(" "),t("p",[t("code",[s._v("crontab -e")])]),s._v(" "),t("ul",[t("li",[t("p",[s._v("写入如下任务")]),s._v(" "),t("p",[t("code",[s._v("* 0-23/3 * * * root /usr/sbin/ntpdate time.windows.com &> /dev/null;")]),s._v(" "),t("code",[s._v("/usr/sbin/clock -w")])])]),s._v(" "),t("li",[t("p",[s._v("host 定义")]),s._v(" "),t("blockquote",[t("p",[s._v("由于使用域名方式访问，所以需要修改本地 hosts 文件，也可以通过自建 dns 服务器来解决，不过据说 dns 服务器方式会有一点点延迟，所以推荐修改本地 hosts(没证明过)")])])]),s._v(" "),t("li",[t("p",[s._v("修改 hosts\n"),t("code",[s._v("vim /etc/hosts")])])]),s._v(" "),t("li",[t("p",[s._v("增加如下")])])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.100 test-server1\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.107 test-server2\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.126 test-server3\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.217 test-server4\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h2",{attrs:{id:"启动并加入节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动并加入节点"}},[s._v("#")]),s._v(" 启动并加入节点")]),s._v(" "),t("p",[t("code",[s._v("GlusterFS")]),s._v("安装完成后可直接通过 "),t("code",[s._v("systemd")]),s._v(" 启动")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("    systemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" glusterd\n    systemctl start glusterd\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("启动完成后便可在任意节点上将其他节点加入进来，组建集群")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("gfs_host")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" gfs-server1 gfs-server2 gfs-server3 gfs-server4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n      gluster peer probe "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$gfs_host")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"磁盘预处理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#磁盘预处理"}},[s._v("#")]),s._v(" 磁盘预处理")]),s._v(" "),t("blockquote",[t("p",[s._v("GlusterFS 集群服务启动并加入其他节点后，就需要为下一步创建卷(volume)准备磁盘，以下以一块 50G 的磁盘为例，在每个节点上执行如下")])]),s._v(" "),t("ul",[t("li",[s._v("首先创建分区")])]),s._v(" "),t("p",[t("code",[s._v("fdisk /dev/sdb")])]),s._v(" "),t("ul",[t("li",[s._v("然后输入 n 创建新分区，再输入 p 选择主分区")]),s._v(" "),t("li",[s._v("最后输入 w 保存分区表，如下所示")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("欢迎使用 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("fdisk")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("util-linux "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.23")]),s._v(".2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("。\n\n更改将停留在内存中，直到您决定将更改写入磁盘。\n使用写入命令前请三思。\n\nDevice does not contain a recognized partition table\n使用磁盘标识符 0x445cdbb5 创建新的 DOS 磁盘标签。\n\n命令"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("输入 m 获取帮助"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("：n\nPartition type:\n   p   primary "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" primary, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" extended, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   e   extended\nSelect "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("default p"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": p\n分区号 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("-4，默认 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("：\n起始 扇区 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("-104857599，默认为 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("：\n将使用默认值 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("\nLast 扇区, +扇区 or +size"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("K,M,G"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("-104857599，默认为 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("104857599")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("：\n将使用默认值 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("104857599")]),s._v("\n分区 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 已设置为 Linux 类型，大小设为 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v(" GiB\n\n命令"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("输入 m 获取帮助"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("：w\nThe partition table has been altered"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n\nCalling ioctl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" to re-read partition table.\n正在同步磁盘。\n分区创建完成后需要对其进行格式化\n\nmkfs.ext4 /dev/sdb\n最后准备接下来要使用的相关挂载目录\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br")])]),t("ul",[t("li",[s._v("创建磁盘挂载目录\n"),t("code",[s._v("mkdir -p /data/gfs")])]),s._v(" "),t("li",[s._v("挂载硬盘\n"),t("code",[s._v("mount -t ext4 /dev/sdb /data/gfs")])]),s._v(" "),t("li",[s._v("创建 GlusterFS 卷目录\n"),t("code",[s._v("mkdir -p /data/gfs/brick0")])])]),s._v(" "),t("p",[s._v("为了保证磁盘一直挂载，最好设置一下开机自动挂载")]),s._v(" "),t("p",[t("strong",[s._v("后面三个选项，defaults 表示使用默认挂载参数，")]),s._v(" "),t("strong",[s._v("# 第一个 1 代表 允许 demp")]),s._v(" "),t("strong",[s._v("# 第二个 1 代表 开机执行挂载分区检查")])]),s._v(" "),t("p",[t("code",[s._v('echo "/dev/sdb /data/gfs ext4 defaults 1 1" >> /etc/fstab')])]),s._v(" "),t("p",[s._v("到此集群基本部署完成")]),s._v(" "),t("h3",{attrs:{id:"glusterfs-存储卷设置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#glusterfs-存储卷设置"}},[s._v("#")]),s._v(" GlusterFS 存储卷设置")]),s._v(" "),t("blockquote",[t("p",[s._v("GlusterFS 集群搭建完成后，便需要创建存储卷(volume)来整合各个集群磁盘存储资源，以便后面进行挂载和使用")])]),s._v(" "),t("h3",{attrs:{id:"创建分布式-hash-卷"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建分布式-hash-卷"}},[s._v("#")]),s._v(" 创建分布式 "),t("code",[s._v("Hash")]),s._v(" 卷")]),s._v(" "),t("blockquote",[t("p",[s._v("分布式 Hash 卷其原理是当向 GlusterFS 写入一个文件时，GlusterFS 通过弹性 Hash 算法对文件名进行计算，然后将其均匀的分布到各个节点上，因此分布式 Hash 卷没有数据冗余，创建分布式 Hash 卷命令如下")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("gluster volume create gfs_disk"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n      gfs-server1:/data/gfs/brick0 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n      gfs-server2:/data/gfs/brick0 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n      gfs-server3:/data/gfs/brick0 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n      gfs-server4:/data/gfs/brick0\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"创建复制卷"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建复制卷"}},[s._v("#")]),s._v(" 创建复制卷")]),s._v(" "),t("p",[s._v("复制卷相当于 RAID1，在向 GlusterFS 中存储文件时，GlusterFS 将其拷贝到所有节点，并且是同步的，这会极大降低磁盘性能，并呈线性降低，但是复制卷随着节点数量增加，起数据冗余能力也在增加，因为每个节点上都有一份数据的完全拷贝，创建复制卷命令如下")]),s._v(" "),t("blockquote",[t("p",[s._v("replica 参数用于指定数据拷贝有多少份\n注意: replica 数量必须与指定的 GlusterFS 集群 brick 数量保持一致")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("gluster volume create gfs_disk replica "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" transport tcp "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        gfs-server1:/data/gfs/brick0 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        gfs-server2:/data/gfs/brick0 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        gfs-server3:/data/gfs/brick0 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        gfs-server4:/data/gfs/brick0\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"创建分布式-hash-复制卷"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建分布式-hash-复制卷"}},[s._v("#")]),s._v(" 创建分布式 Hash 复制卷")]),s._v(" "),t("p",[s._v("顾名思义，分布式 Hash 复制卷就是将 Hash 卷与复制卷整合一下，通过 replica 参数指定复制份数，以下例子为使用4个节点创建，每两个节点组成一个复制卷，然后两对节点再组成 Hash 卷")]),s._v(" "),t("blockquote",[t("p",[s._v("创建 分布式 Hash 复制卷时，只需要保证集群数量是 replica 数量的整数倍即可")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("gluster volume create gfs_disk replica "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" transport tcp "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        gfs-server1:/data/gfs/brick0 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        gfs-server2:/data/gfs/brick0 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        gfs-server3:/data/gfs/brick0 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        gfs-server4:/data/gfs/brick0\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"其他卷"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#其他卷"}},[s._v("#")]),s._v(" 其他卷")]),s._v(" "),t("p",[s._v("条带卷: 条带卷既将文件切分成块，分布存放在各个节点，将 replica 替换成 stripe 即可\n分布式 Hash 条带卷: 同分布式 Hash 复制卷一样，保证节点数量是 stripe 的整数倍即可\n由于条带卷使用并不多，所以不做演示，一般条带卷适用于单个大文件超过磁盘大小时使用")]),s._v(" "),t("h2",{attrs:{id:"glusterfs-挂载及测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#glusterfs-挂载及测试"}},[s._v("#")]),s._v(" GlusterFS 挂载及测试")]),s._v(" "),t("p",[s._v("无论创建的哪种卷，最终创建完成后都可以通过如下命令查看")]),s._v(" "),t("p",[t("code",[s._v("gluster volume info")])]),s._v(" "),t("h3",{attrs:{id:"glusterfs-卷挂载"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#glusterfs-卷挂载"}},[s._v("#")]),s._v(" GlusterFS 卷挂载")]),s._v(" "),t("p",[s._v("卷创建完成后，只需要像正常磁盘一样挂载即可使用，不同的是文件系统类型指定为 glusterfs 而已，操作如下")]),s._v(" "),t("blockquote",[t("p",[s._v("mount 时指定任意一个节点即可")])]),s._v(" "),t("p",[t("code",[s._v("mount -t glusterfs gfs-server1:gfs_disk /mnt/gfs")])]),s._v(" "),t("p",[s._v("为保证一直可用，同样最好设置开机自动挂载")]),s._v(" "),t("p",[t("code",[s._v('echo "gfs-server1:gfs_disk /mnt/gfs glusterfs defaults 0 1" >> /etc/fstab')])]),s._v(" "),t("h3",{attrs:{id:"测试-glusterfs"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#测试-glusterfs"}},[s._v("#")]),s._v(" 测试 GlusterFS")]),s._v(" "),t("p",[s._v("以下以分布式 "),t("code",[s._v("Hash")]),s._v(" 卷为例，由于准备了 4 各节点，并且 replica 为 2，所以理论上向 GlusterFS 写入一个文件应该会在任意两个节点上都有一份")]),s._v(" "),t("blockquote",[t("p",[s._v("在 "),t("code",[s._v("gfs-server1")]),s._v("上执行")])]),s._v(" "),t("p",[t("code",[s._v("cp test.tar.gz /mnt.gfs")])]),s._v(" "),t("blockquote",[t("p",[s._v("最后可以在 "),t("code",[s._v("gfs-server3、gfs-server4")]),s._v("的磁盘目录中看到")])]),s._v(" "),t("p",[t("code",[s._v("ls /data/gfs/brick0")])]),s._v(" "),t("h3",{attrs:{id:"其他相关"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#其他相关"}},[s._v("#")]),s._v(" 其他相关")]),s._v(" "),t("blockquote",[t("p",[s._v("没有任何通用的文件系统，通用意味着通通不能用，关于 "),t("code",[s._v("GlusterFS")]),s._v(" 适用场景以及缺点可参考 换个角度看"),t("code",[s._v("GlusterFS")]),s._v("分布式文件系统 文章，关于 "),t("code",[s._v("GlusterFS")]),s._v(" 性能与监控可参考 "),t("code",[s._v("GlusterFS")]),s._v("性能监控&配额 转载请注明出处，本文采用 CC4.0 协议授权")])])])}),[],!1,null,null,null);t.default=r.exports}}]);