(window.webpackJsonp=window.webpackJsonp||[]).push([[130],{535:function(s,a,t){"use strict";t.r(a);var n=t(2),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"logstash"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#logstash"}},[s._v("#")]),s._v(" Logstash")]),s._v(" "),a("h2",{attrs:{id:"logstash概述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#logstash概述"}},[s._v("#")]),s._v(" Logstash概述")]),s._v(" "),a("h3",{attrs:{id:"集中、转换和存储数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#集中、转换和存储数据"}},[s._v("#")]),s._v(" 集中、转换和存储数据")]),s._v(" "),a("p",[s._v("Logstash 是开源的服务器端数据处理管道，能够同时从多个来源采集数据，转换数据，然后将数据发送到您最喜欢的“存储库”中。")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://www.elastic.co/cn/downloads/logstash",target:"_blank",rel:"noopener noreferrer"}},[s._v("下载"),a("OutboundLink")],1)]),s._v(" "),a("h3",{attrs:{id:"输入、过滤器和输出"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#输入、过滤器和输出"}},[s._v("#")]),s._v(" 输入、过滤器和输出")]),s._v(" "),a("p",[s._v("Logstash 能够动态地采集、转换和传输数据，不受格式或复杂度的影响。利用 Grok 从非结构化数据中派生出结构，从 IP 地址解码出地理坐标，匿名化或排除敏感字段，并简化整体处理过程。")]),s._v(" "),a("h3",{attrs:{id:"采集各种样式、大小和来源的数据-输入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#采集各种样式、大小和来源的数据-输入"}},[s._v("#")]),s._v(" 采集各种样式、大小和来源的数据 （输入）")]),s._v(" "),a("p",[s._v("数据往往以各种各样的形式，或分散或集中地存在于很多系统中。 Logstash 支持 "),a("a",{attrs:{href:"https://www.elastic.co/guide/en/logstash/current/input-plugins.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("各种输入选择"),a("OutboundLink")],1),s._v(" ，可以在同一时间从众多常用来源捕捉事件。能够以连续的流式传输方式，轻松地从您的日志、指标、Web 应用、数据存储以及各种 AWS 服务采集数据。")]),s._v(" "),a("h3",{attrs:{id:"实时解析和转换数据-过滤器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实时解析和转换数据-过滤器"}},[s._v("#")]),s._v(" 实时解析和转换数据  (过滤器)")]),s._v(" "),a("p",[s._v("数据从源传输到存储库的过程中，Logstash 过滤器能够解析各个事件，识别已命名的字段以构建结构，并将它们转换成通用格式，以便更轻松、更快速地分析和实现商业价值。")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("利用 Grok 从非结构化数据中派生出结构")])]),s._v(" "),a("li",[a("p",[s._v("从 IP 地址破译出地理坐标")])]),s._v(" "),a("li",[a("p",[s._v("将 PII 数据匿名化，完全排除敏感字段")])]),s._v(" "),a("li",[a("p",[s._v("简化整体处理，不受数据源、格式或架构的影响")]),s._v(" "),a("p",[s._v("我们的"),a("a",{attrs:{href:"https://www.elastic.co/guide/en/logstash/current/filter-plugins.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("过滤器库"),a("OutboundLink")],1),s._v("丰富多样，拥有无限可能。")])])]),s._v(" "),a("h2",{attrs:{id:"选择您的存储库-导出您的数据-输出"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#选择您的存储库-导出您的数据-输出"}},[s._v("#")]),s._v(" 选择您的存储库，导出您的数据 (输出)")]),s._v(" "),a("p",[s._v("尽管 Elasticsearch 是我们的首选输出方向，能够为我们的搜索和分析带来无限可能，但它并非唯一选择。")]),s._v(" "),a("p",[s._v("Logstash 提供"),a("a",{attrs:{href:"https://www.elastic.co/guide/en/logstash/current/output-plugins.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("众多输出选择"),a("OutboundLink")],1),s._v("，您可以将数据发送到您要指定的地方，并且能够灵活地解锁众多下游用例。")]),s._v(" "),a("p",[s._v("从 Logstash 的名字就能看出，它主要负责跟日志相关的各类操作，在此之前，我们先来看看日志管理的三个境界吧")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("境界一 \n『昨夜西风凋碧树。独上高楼，望尽天涯路』，在各台服务器上用传统的 linux 工具（如 cat, tail, sed, awk, "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" 等）对日志进行简单的分析和处理，基本上可以认为是命令级别的操作，成本很低，速度很快，但难以复用，也只能完成基本的操作。\n\n境界二 \n『衣带渐宽终不悔，为伊消得人憔悴』，服务器多了之后，分散管理的成本变得越来越多，所以会利用 rsyslog 这样的工具，把各台机器上的日志汇总到某一台指定的服务器上，进行集中化管理。这样带来的问题是日志量剧增，小作坊式的管理基本难以满足需求。\n\n境界三 \n『众里寻他千百度，蓦然回首，那人却在灯火阑珊处』，随着日志量的增大，我们从日志中获取去所需信息，并找到各类关联事件的难度会逐渐加大，这个时候，就是 Logstash 登场的时候了\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("Logstash 的主要优势，一个是在支持各类插件的前提下提供统一的管道进行日志处理（就是 input-filter-output 这一套），二个是灵活且性能不错")]),s._v(" "),a("p",[s._v("logstash里面最基本的概念（先不管codec）")]),s._v(" "),a("p",[s._v("logstash收集日志基本流程:")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v("input–"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("filter–"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("output\n\n"),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("input")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("从哪里收集日志\n\n"),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("filter")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("对日志进行过滤\n\n"),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("output")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("输出哪里\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[a("img",{attrs:{src:"http://img.liuwenqi.com/blog/2019-07-16-172956.png",alt:"img"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"http://img.liuwenqi.com/blog/2019-07-16-173010.png",alt:"img"}})]),s._v(" "),a("h2",{attrs:{id:"下载安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#下载安装"}},[s._v("#")]),s._v(" 下载安装")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("## 解压安装\n上传包\ntar -xf 包名\n\n\ncd /opt/logstash-7.2.0\n## 启动\n./bin/logstash -f 配置文件名\n\n## 后台运行\nnohup ./bin/logstash -f  配置文件名  &\n\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("h3",{attrs:{id:"filebeat-到-logstash"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#filebeat-到-logstash"}},[s._v("#")]),s._v(" filebeat 到 logstash")]),s._v(" "),a("p",[s._v("filebeat 配置")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('修改filebeat output 输出\n\n注释如下内容\n\n#output.elasticsearch:\n#  # Array of hosts to connect to.\n#  hosts: ["localhost:9200"]\n\n去掉注释如下内容\n\noutput.logstash:\n  #The Logstash hosts\n  hosts: ["127.0.0.1:5044"]\n\n\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("logstash 配置")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("## 创建 logstash  配置名称\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("在")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('# Sample Logstash configuration for creating a simple\n# Beats -> Logstash -> Elasticsearch pipeline.\n\ninput {\n  beats {\n    port => 5044\n  }\n}\n\n\noutput {\n    elasticsearch {\n      hosts => ["http://localhost:9200"]\n      index => "nginx_log-%{[@metadata][beat]}-%{[@metadata][version]}-%{+YYYY.MM.dd}" \n      #user => "elastic"\n      #password => "changeme"\n    }\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("p",[s._v("启动    ./bin/logstash -f logstash.yml")]),s._v(" "),a("p",[s._v("Nginx 日志过滤日志")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('input {\n   beats {\n    port => 5044\n   }\n}\n\nfilter {\n           grok {\n                   ## grok数据格式整理，可以去官网学习logstash grok格式\n                   match => [\n                   "message", "%{IPORHOST:http_host} %{IPORHOST:user_ip} - - \\[%{HTTPDATE:timestamp}\\] \\"(?:%{WORD:verb} %{NOTSPACE:request}(?: HTTP/%{NUMBER:httpversion:float})?|%{DATA:rawrequest})\\" %{NUMBER:response:int} (?:%{NUMBER:bytes:int}|-) %{QS:referrer} %{QS:useragent} (?:%{NUMBER:request_time:float}|-) (?:%{NUMBER:upstream_time:float}|-)"\n                   ]\n           }\n\n     geoip {\n                   source => "user_ip"\n                   ## 用户IP地址\n           }\n\n           date {\n                   match => [ "timestamp" , "dd/MMM/YYYY:HH:mm:ss Z" ]\n           }\n           useragent {\n                   target => "ua"\n                   source => "useragent"\n           }\n   }\noutput {\n  elasticsearch {\n    hosts => ["http://localhost:9200"]\n    index => "nginx1-%{[@metadata][beat]}-%{[@metadata][version]}-%{+YYYY.MM.dd}"\n  }\n}\n\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br")])]),a("p",[s._v("./bin/logstash -f logstash_nginx.yml")]),s._v(" "),a("h2",{attrs:{id:"filebeat-到-redis-到-logstash"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#filebeat-到-redis-到-logstash"}},[s._v("#")]),s._v(" filebeat 到 redis 到 logstash")]),s._v(" "),a("h3",{attrs:{id:"安装redis"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装redis"}},[s._v("#")]),s._v(" 安装redis")]),s._v(" "),a("p",[s._v("在 elk-1 安装redis")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("yum install -y epel-release\nyum install -y redis\nsystemctl start redis\n## 检查redis 是否启动\nps -ef | grep redis\n如下：已经正常启动\n[root@elk-1 kafka-2.3.0-src]# ps -ef | grep redis\nredis     24228      1  0 07:23 ?        00:00:01 /usr/bin/redis-server 127.0.0.1:6379\nroot      24261  22693  0 07:45 pts/3    00:00:00 grep --color=auto redis\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);