(window.webpackJsonp=window.webpackJsonp||[]).push([[152],{555:function(s,a,t){"use strict";t.r(a);var n=t(2),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[a("strong",[s._v("使用openssl制作证书")])]),s._v(" "),a("h2",{attrs:{id:"_1、服务器单向验证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、服务器单向验证"}},[s._v("#")]),s._v(" 1、服务器单向验证")]),s._v(" "),a("p",[s._v("创建并进入sslkey存放目录")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /opt/nginx/sslkey\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /opt/nginx/sslkey\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"生成rsa密钥"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生成rsa密钥"}},[s._v("#")]),s._v(" 生成RSA密钥")]),s._v(" "),a("p",[a("code",[s._v("openssl genrsa -out key.pem 2048")])]),s._v(" "),a("h3",{attrs:{id:"生成一个证书请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生成一个证书请求"}},[s._v("#")]),s._v(" 生成一个证书请求")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("openssl req "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-key")]),s._v(" key.pem "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-out")]),s._v(" cert.csr`\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#//会提示输入省份、城市、域名信息等，重要的是，email 一定要是你的域名后缀的你可以拿着这个文件去数字证书颁发机构（即CA）申请一个数字证书。")]),s._v("\nCA会给你一个新的文件cacert.pem，那才是你的数字证书。\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[a("strong",[s._v("如果是自己做测试，就可以用下面这个命令来生成证书：")])]),s._v(" "),a("p",[a("code",[s._v("openssl req -new -x509 -nodes -out server.crt -keyout server.key")])]),s._v(" "),a("h3",{attrs:{id:"修改-nginx-配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改-nginx-配置"}},[s._v("#")]),s._v(" 修改 nginx 配置")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# HTTPS server  ")]),s._v("\nserver "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  \n  listen 443;  \n  server_name localhost;  \n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##开启ssl   ")]),s._v("\n  ssl on;  \n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##服务器证书")]),s._v("\n  ssl_certificate /opt/nginx/sslkey/server.crt;\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##服务器证书公钥  ")]),s._v("\n  ssl_certificate_key /opt/nginx/sslkey/server.key;  \n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##链接超时设置")]),s._v("\n  ssl_session_timeout 5m;  \n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##传输信息通道")]),s._v("\n  ssl_protocols SSLv2 SSLv3 TLSv1;\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##传输加密方式  ")]),s._v("\n  ssl_ciphers ALL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("!ADH:")]),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP;")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##  ")]),s._v("\n  ssl_prefer_server_ciphers on;  \n\n  location / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("      \n          root /home/workspace/;      \n          index index.asp index.aspx;        \n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  \n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br")])]),a("p",[s._v("配置好后，重启nginx，采用 "),a("code",[s._v("https")]),s._v("打开网站，浏览器会提示证书错误，点击继续浏览即可。")]),s._v(" "),a("h2",{attrs:{id:"_2、服务器-客户端双向验证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、服务器-客户端双向验证"}},[s._v("#")]),s._v(" 2、服务器-客户端双向验证")]),s._v(" "),a("p",[s._v("在nginx 目录下建立ca文件夹，进入ca。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir newcerts private conf server。")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("其中"),a("code",[s._v("newcerts")]),s._v("子目录将存放CA签署（颁发）过的数字证书（证书备份目录）。而"),a("code",[s._v("private")]),s._v("目录用于存放CA的私钥。目录conf只是用于存放一些简化参数")]),s._v(" "),a("p",[s._v("用的配置文件，server存放服务器证书文件。")]),s._v(" "),a("h3",{attrs:{id:"在conf目录创建文件openssl-conf配置文件-内容如下"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在conf目录创建文件openssl-conf配置文件-内容如下"}},[s._v("#")]),s._v(" 在conf目录创建文件openssl.conf配置文件，内容如下：")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" ca "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  \ndefault_ca      = foo                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The default ca section  ")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" foo "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  \ndir            = /opt/nginx/ca        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# top dir  ")]),s._v("\ndatabase      = /opt/nginx/ca/index.txt          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# index file.  ")]),s._v("\nnew_certs_dir  = /opt/nginx/ca/newcerts          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# new certs dir  ")]),s._v("\n\ncertificate    = /opt/nginx/ca/private/ca.crt        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The CA cert  ")]),s._v("\nserial        = /opt/nginx/ca/serial            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# serial no file  ")]),s._v("\nprivate_key    = /opt/nginx/ca/private/ca.key  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# CA private key  ")]),s._v("\nRANDFILE      =/opt/nginx/ca/private/.rand      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# random number file  ")]),s._v("\n\ndefault_days  = 365                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# how long to certify for  ")]),s._v("\ndefault_crl_days= 30                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# how long before next CRL  ")]),s._v("\ndefault_md    = md5                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# message digest method to use  ")]),s._v("\nunique_subject = no                      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Set to 'no' to allow creation of  ")]),s._v("\n                                        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# several ctificates with same subject.  ")]),s._v("\npolicy        = policy_any              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# default policy  ")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" policy_any "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  \ncountryName = match  \nstateOrProvinceName = match  \norganizationName = match  \norganizationalUnitName = match  \nlocalityName            = optional  \ncommonName              = supplied  \nemailAddress            = optional\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br")])]),a("h3",{attrs:{id:"使用脚本创建证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用脚本创建证书"}},[s._v("#")]),s._v(" 使用脚本创建证书")]),s._v(" "),a("p",[s._v("下面的几个脚本都放在"),a("code",[s._v("/nginx/ca/")]),s._v("目录下。")]),s._v(" "),a("h4",{attrs:{id:"创建一个新的ca根证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建一个新的ca根证书"}},[s._v("#")]),s._v(" 创建一个新的CA根证书")]),s._v(" "),a("p",[a("code",[s._v("vim new_ca.sh")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/sh  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Generate the key.  ")]),s._v("\nopenssl genrsa "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-out")]),s._v(" private/ca.key  \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Generate a certificate request.  ")]),s._v("\nopenssl req "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-key")]),s._v(" private/ca.key "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-out")]),s._v(" private/ca.csr  \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Self signing key is bad... this could work with a third party signed key... registeryfly has them on for $16 but I'm too cheap lazy to get one on a lark.  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# I'm also not 100% sure if any old certificate will work or if you have to buy a special one that you can sign with. I could investigate further but since this  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# service will never see the light of an unencrypted Internet see the cheap and lazy remark.  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# So self sign our root key.  ")]),s._v("\nopenssl x509 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-req")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-days")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("365")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-in")]),s._v(" private/ca.csr "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-signkey")]),s._v(" private/ca.key "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-out")]),s._v(" private/ca.crt  \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Setup the first serial number for our keys... can be any 4 digit hex string... not sure if there are broader bounds but everything I've seen uses 4 digits.  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" FACE "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" serial  \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Create the CA's key database.  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" index.txt  \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Create a Certificate Revocation list for removing 'user certificates.'  ")]),s._v("\nopenssl ca "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-gencrl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-out")]),s._v(" /opt/nginx/ca/private/ca.crl "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-crldays")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-config")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/opt/nginx/ca/conf/openssl.conf"')]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("p",[s._v("执行 "),a("code",[s._v("sh new_ca.sh")]),s._v("生成新的CA证书。")]),s._v(" "),a("h4",{attrs:{id:"生成服务器证书的脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生成服务器证书的脚本"}},[s._v("#")]),s._v(" 生成服务器证书的脚本")]),s._v(" "),a("p",[a("code",[s._v("new_server.sh")])]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Create us a key. Don't bother putting a password on it since you will need it to start apache. If you have a better work around I'd love to hear it.  ")]),s._v("\nopenssl genrsa "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("out server/server.key  \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Take our key and create a Certificate Signing Request for it.  ")]),s._v("\nopenssl req "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("new "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("key server/server.key "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("out server/server.csr  \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Sign this bastard key with our bastard CA key.  ")]),s._v("\nopenssl ca "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("in server/server.csr "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cert private/ca.crt "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("keyfile private/ca.key "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("out server/server.crt "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('config "/opt/nginx/ca/conf/openssl.conf"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("执行 "),a("code",[s._v("sh new_server.sh")]),s._v("生成新服务器的证书")]),s._v(" "),a("h4",{attrs:{id:"配置-nginx的ssl支持"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置-nginx的ssl支持"}},[s._v("#")]),s._v(" 配置 nginx的ssl支持")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#user  www-nginx;  ")]),s._v("\nworker_processes  1;  \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#error_log  logs/error.log;  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#error_log  logs/error.log  notice;  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#error_log  logs/error.log  info;  ")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#pid        logs/nginx.pid;  ")]),s._v("\n\n\nevents "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  \n    worker_connections  1024;  \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  \nhttp "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  \n    include      mime.types;  \n    default_type  application/octet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("stream;  \n    sendfile        on;  \n    keepalive_timeout  65;  \n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#gzip  on;  ")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# HTTPS server  ")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  ")]),s._v("\n    server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  \n        listen      443;  \n        server_name  localhost;  \n        ssi on;  \n        ssi_silent_errors on;  \n        ssi_types text/shtml;  \n\n        ssl                  on;  \n        ssl_certificate      /opt/nginx/ca/server/server.crt;  \n        ssl_certificate_key  /opt/nginx/ca/server/server.key;  \n        ssl_client_certificate /opt/nginx/ca/private/ca.crt;  \n\n        ssl_session_timeout  5m;  \n        ssl_verify_client on;  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#开户客户端证书验证  ")]),s._v("\n\n        ssl_protocols  SSLv2 SSLv3 TLSv1;  \n        ssl_ciphers ALL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("!ADH:")]),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP;")]),s._v("  \n        ssl_prefer_server_ciphers  on;  \n\n        location / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("      \n        root /home/workspace/;      \n        index index.asp index.aspx;        \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br")])]),a("p",[s._v("启动"),a("code",[s._v("nginx")]),s._v(",等待客户连接，如果此时连接服务器，将提示"),a("code",[s._v("400 Bad request certification")]),s._v("的错误，故还需要生成客户端证书。")]),s._v(" "),a("h4",{attrs:{id:"生成客户端证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生成客户端证书"}},[s._v("#")]),s._v(" 生成客户端证书")]),s._v(" "),a("p",[a("code",[s._v("vim new_user.sh")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/sh  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The base of where our SSL stuff lives.  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("base")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/opt/nginx/ca"')]),s._v("  \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Were we would like to store keys... in this case we take the username given to us and store everything there.  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$base")]),s._v("/users/  \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Let's create us a key for this user... yeah not sure why people want to use DES3 but at least let's make us a nice big key.  ")]),s._v("\nopenssl genrsa "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-des3")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-out")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$base")]),s._v("/users/client.key "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v("  \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Create a Certificate Signing Request for said key.  ")]),s._v("\nopenssl req "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-key")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$base")]),s._v("/users/client.key "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-out")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$base")]),s._v("/users/client.csr  \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Sign the key with our CA's key and cert and create the user's certificate out of it.  ")]),s._v("\nopenssl ca "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$base")]),s._v("/users/client.csr "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-cert")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$base")]),s._v("/private/ca.crt "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-keyfile")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$base")]),s._v("/private/ca.key "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-out")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$base")]),s._v("/users/client.crt "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-config")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/opt/nginx/ca/conf/openssl.conf"')]),s._v("  \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# This is the tricky bit... convert the certificate into a form that most browsers will understand PKCS12 to be specific.  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The export password is the password used for the browser to extract the bits it needs and insert the key into the user's keychain.  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Take the same precaution with the export password that would take with any other password based authentication scheme.  ")]),s._v("\nopenssl pkcs12 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-clcerts")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$base")]),s._v("/users/client.crt "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-inkey")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$base")]),s._v("/users/client.key "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-out")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$base")]),s._v("/users/client.p12\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("p",[s._v("执行 "),a("code",[s._v("sh new_user.sh")]),s._v("生成一个 "),a("code",[s._v("client")]),s._v("证书。")]),s._v(" "),a("p",[s._v("按照提示一步一步来，这里要注意的是客户证书的几个项目要和根证书匹配。")]),s._v(" "),a("p",[s._v("也就是前面配置的:")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[s._v("countryName = match\nstateOrProvinceName = match\norganizationName = match\norganizationalUnitName = match\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("不一致的话无法生成最后的客户证书，证书生成后，客户端导入证书浏览器，即可打开网站。")]),s._v(" "),a("p",[a("strong",[s._v("注意事项：")])]),s._v(" "),a("ol",[a("li",[s._v("制作证书时会提示输入密码，服务器证书和客户端证书密码可以不相同。")]),s._v(" "),a("li",[s._v("服务器证书和客户端证书制作时提示输入省份、城市、域名信息等，需保持一致。")]),s._v(" "),a("li",[a("code",[s._v("Nginx")]),s._v("默认未开启SSI，上面配置已开启。")]),s._v(" "),a("li",[a("code",[s._v("Nginx")]),s._v("不能自启动，需要如下配置：")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /etc/init.d\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" nginx\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("nginx内容：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#! /bin/sh  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### BEGIN INIT INFO  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Provides:          nginx  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Required-Start:    $syslog $local_fs $remote_fs  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Required-Stop:    $syslog $local_fs $remote_fs  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Should-Start:      dbus avahi  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Should-Stop:      dbus avahi  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Default-Start:    2 3 4 5  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Default-Stop:      1  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Short-Description: Nginx Server  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Description:      Nginx  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### END INIT INFO  ")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/opt/nginx/sbin  \n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DAEMON")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/opt/nginx/sbin/nginx  \n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx  \n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DESC")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Nginx Server"')]),s._v("  \n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PID_FILE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/opt/nginx/logs/nginx.pid  \n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-x")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DAEMON")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  \n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("RUN")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yes  \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#RUN_AS_USER=root  ")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#DAEMON_OPTS="-a $RUN_AS_USER"  ')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v("  \n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("case")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("  \n  start"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  \n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Starting '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DESC")]),s._v(': "')]),s._v("  \n    start-stop-daemon "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--start")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--quiet")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--pidfile")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PID_FILE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("  \n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DAEMON")]),s._v("  \n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NAME")]),s._v('."')]),s._v("  \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n  stop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  \n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Stopping '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DESC")]),s._v(': "')]),s._v("  \n    start-stop-daemon "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--stop")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--oknodo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--quiet")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--pidfile")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PID_FILE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("  \n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DAEMON")]),s._v("  \n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NAME")]),s._v('."')]),s._v("  \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n  force-reload"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  \n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# check whether $DAEMON is running. If so, restart  ")]),s._v("\n    start-stop-daemon "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--stop")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--test")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--quiet")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--pidfile")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("  \n        "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PID_FILE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DAEMON")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("  \n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$0")]),s._v(" restart "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("  \n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n  restart"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  \n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Restarting '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DESC")]),s._v(': "')]),s._v("  \n    start-stop-daemon "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--stop")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--oknodo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--quiet")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--pidfile")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("  \n        "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PID_FILE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DAEMON")]),s._v("  \n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  \n    start-stop-daemon "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--start")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--quiet")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--pidfile")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("  \n        "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PID_FILE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DAEMON")]),s._v("  \n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NAME")]),s._v('."')]),s._v("  \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n  status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  \n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PID_FILE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("  \n            "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("RUNNING")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" $PID_FILE"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("  \n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" /proc/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$RUNNING")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("  \n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("readlink /proc/$RUNNING/exe"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DAEMON")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("  \n                    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NAME")]),s._v(' is running."')]),s._v("  \n                    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  \n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("  \n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("  \n\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# No such PID, or executables don't match  ")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NAME")]),s._v(' is not running, but pidfile existed."')]),s._v("  \n            "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PID_FILE")]),s._v("  \n            "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  \n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("  \n            "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PID_FILE")]),s._v("  \n            "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NAME")]),s._v(' not running."')]),s._v("  \n            "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  \n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("  \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n  *"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  \n    "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("N")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/init.d/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NAME")]),s._v("  \n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Usage: '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$N")]),s._v(' {start|stop|restart|force-reload}"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&2")]),s._v("  \n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("esac")]),s._v("  \n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br")])]),a("p",[s._v("设置自启动：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chkconfig")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--list")]),s._v(" nginx\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chkconfig")]),s._v(" nginx on\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);