(window.webpackJsonp=window.webpackJsonp||[]).push([[125],{531:function(s,t,a){"use strict";a.r(t);var n=a(2),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"架构图"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#架构图"}},[s._v("#")]),s._v(" 架构图")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://img.liuwenqi.com/blog/2019-07-24-025307.png",alt:"架构图"}})]),s._v(" "),t("h1",{attrs:{id:"elk-加入kafka-消息队列"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#elk-加入kafka-消息队列"}},[s._v("#")]),s._v(" ELK 加入Kafka 消息队列")]),s._v(" "),t("blockquote",[t("p",[s._v("在 elk-3 上面安装filebeat，通过filebeat 模板 抓取 system 日志")])]),s._v(" "),t("h2",{attrs:{id:"filebeat"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#filebeat"}},[s._v("#")]),s._v(" filebeat")]),s._v(" "),t("h3",{attrs:{id:"加载-system-系统模板"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#加载-system-系统模板"}},[s._v("#")]),s._v(" 加载 system 系统模板")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("/etc/filebeat/m\nfilebeat modules "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" system\n修改\n"),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"filebeat-配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#filebeat-配置文件"}},[s._v("#")]),s._v(" filebeat 配置文件")]),s._v(" "),t("div",{staticClass:"language-yml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yml"}},[t("code",[s._v("vim /etc/filebeat/filebeat.yml\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##关闭通过log方式获取")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" log\n\t\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#service: nginx_log")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Paths that should be crawled and fetched. Glob based paths.")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("paths")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /var/log/nginx/access.log\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /var/log/messages\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#- c:\\programdata\\elasticsearch\\logs\\*")]),s._v("\n    \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 开启模板监控")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("filebeat.config.modules")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Glob pattern for configuration loading")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" $"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("path.config"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/modules.d/"),t("span",{pre:!0,attrs:{class:"token important"}},[s._v("*.yml")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Set to true to enable config reloading")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("reload.enabled")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Period on which files under path should be checked for changes")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#reload.period: 10s")]),s._v("\n  \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 增加 output kafka输出  注释掉 elasticsearch和logstash输出")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#output.elasticsearch:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  # Array of hosts to connect to.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#  hosts: ["localhost:9200"]')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("output.kafka")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"elk-1:9092"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("topic")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"filebeat"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("codec.json")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("pretty")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n\n\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Optional protocol and basic auth credentials.")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#protocol: "https"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#username: "elastic"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#password: "changeme"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#----------------------------- Logstash output --------------------------------")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#output.logstash:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  #The Logstash hosts")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#  hosts: ["127.0.0.1:5044"]')]),s._v("\n\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br")])]),t("h2",{attrs:{id:"logstash"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#logstash"}},[s._v("#")]),s._v(" logstash")]),s._v(" "),t("p",[s._v("创建 文件")]),s._v(" "),t("p",[t("code",[s._v("vim /opt/logstash-7.2.0/logstash_kafka.conf")])]),s._v(" "),t("div",{staticClass:"language-yml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yml"}},[t("code",[s._v("input "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  kafka "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    bootstrap_servers ="),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(' "elk'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v('9092"\n    topics ='),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"filebeat"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    codec ="),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(" json\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\noutput "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  if "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("@metadata"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("pipeline"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    elasticsearch "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      hosts ="),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(' "http'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//localhost"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v('9200"\n      manage_template ='),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(" false\n      index ="),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(' "system'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("%"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("@metadata"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("beat"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("%"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("@metadata"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("version"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("%"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("+YYYY.MM.dd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v('"\n      '),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# pipeline => "%{[@metadata][pipeline]}"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" else "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    elasticsearch "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      hosts ="),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(' "http'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//localhost"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v('9200"\n      manage_template ='),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(" false\n      index ="),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(' "%'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("@metadata"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("beat"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("%"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("@metadata"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("version"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("%"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("+YYYY.MM.dd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v('"\n    '),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br")])]),t("h3",{attrs:{id:"启动logstash"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动logstash"}},[s._v("#")]),s._v(" 启动logstash")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /opt/logstash-7.2.0\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" ./bin/logstash "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" logstash_kafka.conf "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h2",{attrs:{id:"kabana"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kabana"}},[s._v("#")]),s._v(" kabana")]),s._v(" "),t("p",[s._v("创建索引")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://img.liuwenqi.com/blog/2019-07-17-183050.png",alt:"image-20190718023048860"}})])])}),[],!1,null,null,null);t.default=e.exports}}]);