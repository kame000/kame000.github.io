<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>基于Harbor搭建docker registry | 刘文奇</title>
    <meta name="generator" content="VuePress 1.9.9">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.css">
    <link rel="icon" href="/favicon.ico">
    <link rel="manifest" href="/manifest.json">
    <meta name="description" content="个人博客，技术笔记整理">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.e853742c.css" as="style"><link rel="preload" href="/assets/js/app.402024e5.js" as="script"><link rel="preload" href="/assets/js/3.35889db3.js" as="script"><link rel="preload" href="/assets/js/1.98e71d3a.js" as="script"><link rel="preload" href="/assets/js/18.38c2d3ff.js" as="script"><link rel="prefetch" href="/assets/js/10.d70328f8.js"><link rel="prefetch" href="/assets/js/100.bdfeee98.js"><link rel="prefetch" href="/assets/js/101.0f0aa0e3.js"><link rel="prefetch" href="/assets/js/102.8810b363.js"><link rel="prefetch" href="/assets/js/103.018076eb.js"><link rel="prefetch" href="/assets/js/104.6ef1e09a.js"><link rel="prefetch" href="/assets/js/105.ef045d33.js"><link rel="prefetch" href="/assets/js/106.3aafc27c.js"><link rel="prefetch" href="/assets/js/107.f3da675e.js"><link rel="prefetch" href="/assets/js/108.6a197ffd.js"><link rel="prefetch" href="/assets/js/109.9bdef9f9.js"><link rel="prefetch" href="/assets/js/11.8a566d2b.js"><link rel="prefetch" href="/assets/js/110.57ebc428.js"><link rel="prefetch" href="/assets/js/111.b5447738.js"><link rel="prefetch" href="/assets/js/112.c716f5e7.js"><link rel="prefetch" href="/assets/js/113.557f7376.js"><link rel="prefetch" href="/assets/js/114.61a54316.js"><link rel="prefetch" href="/assets/js/115.6d0b291a.js"><link rel="prefetch" href="/assets/js/116.8c93c654.js"><link rel="prefetch" href="/assets/js/117.07743f06.js"><link rel="prefetch" href="/assets/js/118.d1774c94.js"><link rel="prefetch" href="/assets/js/119.05fc2356.js"><link rel="prefetch" href="/assets/js/12.f6bcfd1f.js"><link rel="prefetch" href="/assets/js/120.2444fe97.js"><link rel="prefetch" href="/assets/js/121.ca03cbf1.js"><link rel="prefetch" href="/assets/js/122.4fea1a12.js"><link rel="prefetch" href="/assets/js/123.0e2b6ebe.js"><link rel="prefetch" href="/assets/js/124.61410c00.js"><link rel="prefetch" href="/assets/js/125.98a05a32.js"><link rel="prefetch" href="/assets/js/126.f734fc8e.js"><link rel="prefetch" href="/assets/js/127.e9acb272.js"><link rel="prefetch" href="/assets/js/128.d4b47285.js"><link rel="prefetch" href="/assets/js/129.aa6f2614.js"><link rel="prefetch" href="/assets/js/13.fa622aa3.js"><link rel="prefetch" href="/assets/js/130.244a3895.js"><link rel="prefetch" href="/assets/js/131.86c3a012.js"><link rel="prefetch" href="/assets/js/132.fe1b85d2.js"><link rel="prefetch" href="/assets/js/133.e238c5c4.js"><link rel="prefetch" href="/assets/js/134.1b5b832b.js"><link rel="prefetch" href="/assets/js/135.6468c4f0.js"><link rel="prefetch" href="/assets/js/136.19775bf4.js"><link rel="prefetch" href="/assets/js/137.c6d0ed15.js"><link rel="prefetch" href="/assets/js/138.230a86e2.js"><link rel="prefetch" href="/assets/js/139.64f42c07.js"><link rel="prefetch" href="/assets/js/14.3c87d1f8.js"><link rel="prefetch" href="/assets/js/140.607b2c0d.js"><link rel="prefetch" href="/assets/js/141.224b1c65.js"><link rel="prefetch" href="/assets/js/142.0d0fc6e0.js"><link rel="prefetch" href="/assets/js/143.c78f7a17.js"><link rel="prefetch" href="/assets/js/144.5f6b6fe2.js"><link rel="prefetch" href="/assets/js/145.d9203869.js"><link rel="prefetch" href="/assets/js/146.ac383aae.js"><link rel="prefetch" href="/assets/js/147.5ad44c9c.js"><link rel="prefetch" href="/assets/js/148.4f051907.js"><link rel="prefetch" href="/assets/js/149.ba645a2b.js"><link rel="prefetch" href="/assets/js/15.527a7f7a.js"><link rel="prefetch" href="/assets/js/150.ac4e4278.js"><link rel="prefetch" href="/assets/js/151.0a2827cd.js"><link rel="prefetch" href="/assets/js/152.7a554168.js"><link rel="prefetch" href="/assets/js/153.af52f866.js"><link rel="prefetch" href="/assets/js/154.2ce71126.js"><link rel="prefetch" href="/assets/js/155.7154dc6f.js"><link rel="prefetch" href="/assets/js/156.3d24250b.js"><link rel="prefetch" href="/assets/js/157.59ac5226.js"><link rel="prefetch" href="/assets/js/158.2d506491.js"><link rel="prefetch" href="/assets/js/159.92262746.js"><link rel="prefetch" href="/assets/js/16.aebd5e39.js"><link rel="prefetch" href="/assets/js/160.63210a31.js"><link rel="prefetch" href="/assets/js/161.9b44e7a4.js"><link rel="prefetch" href="/assets/js/162.5b61f2c7.js"><link rel="prefetch" href="/assets/js/163.7589d833.js"><link rel="prefetch" href="/assets/js/164.b5c15ecb.js"><link rel="prefetch" href="/assets/js/165.a5f5cd29.js"><link rel="prefetch" href="/assets/js/166.767b9987.js"><link rel="prefetch" href="/assets/js/167.1ffc72bf.js"><link rel="prefetch" href="/assets/js/168.515eab1b.js"><link rel="prefetch" href="/assets/js/169.dcc68995.js"><link rel="prefetch" href="/assets/js/17.bac8416c.js"><link rel="prefetch" href="/assets/js/170.64bfe5e6.js"><link rel="prefetch" href="/assets/js/171.5ad45642.js"><link rel="prefetch" href="/assets/js/172.b6d37b2e.js"><link rel="prefetch" href="/assets/js/173.19619648.js"><link rel="prefetch" href="/assets/js/174.eaff3157.js"><link rel="prefetch" href="/assets/js/175.2dffa431.js"><link rel="prefetch" href="/assets/js/176.3096d3a7.js"><link rel="prefetch" href="/assets/js/177.6d911d1f.js"><link rel="prefetch" href="/assets/js/178.a8b4f936.js"><link rel="prefetch" href="/assets/js/179.3003a50e.js"><link rel="prefetch" href="/assets/js/180.a03fd18b.js"><link rel="prefetch" href="/assets/js/181.62ce609e.js"><link rel="prefetch" href="/assets/js/182.00b6356e.js"><link rel="prefetch" href="/assets/js/183.6adc62eb.js"><link rel="prefetch" href="/assets/js/184.b11447af.js"><link rel="prefetch" href="/assets/js/185.6a9556de.js"><link rel="prefetch" href="/assets/js/186.5b458a07.js"><link rel="prefetch" href="/assets/js/187.a9bd8543.js"><link rel="prefetch" href="/assets/js/188.627a76f3.js"><link rel="prefetch" href="/assets/js/19.62378543.js"><link rel="prefetch" href="/assets/js/20.31bf256b.js"><link rel="prefetch" href="/assets/js/21.dd768b7c.js"><link rel="prefetch" href="/assets/js/22.f270cfbc.js"><link rel="prefetch" href="/assets/js/23.652c5b0a.js"><link rel="prefetch" href="/assets/js/24.d8a77731.js"><link rel="prefetch" href="/assets/js/25.f4efa277.js"><link rel="prefetch" href="/assets/js/26.775d7d00.js"><link rel="prefetch" href="/assets/js/27.a42e7481.js"><link rel="prefetch" href="/assets/js/28.c81142a3.js"><link rel="prefetch" href="/assets/js/29.104d30bb.js"><link rel="prefetch" href="/assets/js/30.eeaa063e.js"><link rel="prefetch" href="/assets/js/31.c08c3cc6.js"><link rel="prefetch" href="/assets/js/32.96914904.js"><link rel="prefetch" href="/assets/js/33.b5e70d92.js"><link rel="prefetch" href="/assets/js/34.f72f363f.js"><link rel="prefetch" href="/assets/js/35.8e461891.js"><link rel="prefetch" href="/assets/js/36.a3887f60.js"><link rel="prefetch" href="/assets/js/37.f8ac624a.js"><link rel="prefetch" href="/assets/js/38.f9e3dfe7.js"><link rel="prefetch" href="/assets/js/39.00c6dac4.js"><link rel="prefetch" href="/assets/js/4.4a2913bc.js"><link rel="prefetch" href="/assets/js/40.0431cb0b.js"><link rel="prefetch" href="/assets/js/41.a0b96bac.js"><link rel="prefetch" href="/assets/js/42.81504763.js"><link rel="prefetch" href="/assets/js/43.a2f1e577.js"><link rel="prefetch" href="/assets/js/44.c6e577c7.js"><link rel="prefetch" href="/assets/js/45.e19251cb.js"><link rel="prefetch" href="/assets/js/46.2736b4a4.js"><link rel="prefetch" href="/assets/js/47.74eb52c3.js"><link rel="prefetch" href="/assets/js/48.e175852f.js"><link rel="prefetch" href="/assets/js/49.470cd3e4.js"><link rel="prefetch" href="/assets/js/5.894dfcfd.js"><link rel="prefetch" href="/assets/js/50.aa07f64f.js"><link rel="prefetch" href="/assets/js/51.7491ccca.js"><link rel="prefetch" href="/assets/js/52.ede9d894.js"><link rel="prefetch" href="/assets/js/53.f4ec39bc.js"><link rel="prefetch" href="/assets/js/54.11693e63.js"><link rel="prefetch" href="/assets/js/55.6158a230.js"><link rel="prefetch" href="/assets/js/56.d30bcbf8.js"><link rel="prefetch" href="/assets/js/57.7a28a471.js"><link rel="prefetch" href="/assets/js/58.f0c30984.js"><link rel="prefetch" href="/assets/js/59.ab16feee.js"><link rel="prefetch" href="/assets/js/6.71d47490.js"><link rel="prefetch" href="/assets/js/60.1c81418c.js"><link rel="prefetch" href="/assets/js/61.1dd5070d.js"><link rel="prefetch" href="/assets/js/62.7f7ce997.js"><link rel="prefetch" href="/assets/js/63.2cb3686d.js"><link rel="prefetch" href="/assets/js/64.18048f56.js"><link rel="prefetch" href="/assets/js/65.87291046.js"><link rel="prefetch" href="/assets/js/66.a7a7575d.js"><link rel="prefetch" href="/assets/js/67.ca181b91.js"><link rel="prefetch" href="/assets/js/68.4a9df39d.js"><link rel="prefetch" href="/assets/js/69.4a2661f5.js"><link rel="prefetch" href="/assets/js/7.6ba3ae87.js"><link rel="prefetch" href="/assets/js/70.0613e6ac.js"><link rel="prefetch" href="/assets/js/71.b092300b.js"><link rel="prefetch" href="/assets/js/72.25f9363b.js"><link rel="prefetch" href="/assets/js/73.be14e0d3.js"><link rel="prefetch" href="/assets/js/74.02d90af1.js"><link rel="prefetch" href="/assets/js/75.effffafd.js"><link rel="prefetch" href="/assets/js/76.c53ee55b.js"><link rel="prefetch" href="/assets/js/77.4aa1108d.js"><link rel="prefetch" href="/assets/js/78.672c6170.js"><link rel="prefetch" href="/assets/js/79.caf6aebe.js"><link rel="prefetch" href="/assets/js/8.89bc7f6d.js"><link rel="prefetch" href="/assets/js/80.39b1897d.js"><link rel="prefetch" href="/assets/js/81.7cce90fa.js"><link rel="prefetch" href="/assets/js/82.5be4879f.js"><link rel="prefetch" href="/assets/js/83.b47ca97a.js"><link rel="prefetch" href="/assets/js/84.93b6da79.js"><link rel="prefetch" href="/assets/js/85.97f70ae7.js"><link rel="prefetch" href="/assets/js/86.aa40b1cc.js"><link rel="prefetch" href="/assets/js/87.2a9e64ba.js"><link rel="prefetch" href="/assets/js/88.960c348f.js"><link rel="prefetch" href="/assets/js/89.81c8200d.js"><link rel="prefetch" href="/assets/js/9.31afac8d.js"><link rel="prefetch" href="/assets/js/90.313a5e05.js"><link rel="prefetch" href="/assets/js/91.dfb38398.js"><link rel="prefetch" href="/assets/js/92.7eac20c9.js"><link rel="prefetch" href="/assets/js/93.cb7e9ce1.js"><link rel="prefetch" href="/assets/js/94.7ae95a84.js"><link rel="prefetch" href="/assets/js/95.7f792a23.js"><link rel="prefetch" href="/assets/js/96.596eb777.js"><link rel="prefetch" href="/assets/js/97.06b96fe1.js"><link rel="prefetch" href="/assets/js/98.7c50f666.js"><link rel="prefetch" href="/assets/js/99.a5d107f2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e853742c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>刘文奇</h3> <p class="description" data-v-59e6cb88>个人博客，技术笔记整理</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>刘文奇</span>
          
        <span data-v-59e6cb88>2014 - </span>
        2023
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/head.jpg" alt="刘文奇" class="logo"> <span class="site-name">刘文奇</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/docker/" class="nav-link"><i class="undefined"></i>
  docker
</a></li><li class="dropdown-item"><!----> <a href="/categories/Django/" class="nav-link"><i class="undefined"></i>
  Django
</a></li><li class="dropdown-item"><!----> <a href="/categories/Python基础/" class="nav-link"><i class="undefined"></i>
  Python基础
</a></li><li class="dropdown-item"><!----> <a href="/categories/go_base/" class="nav-link"><i class="undefined"></i>
  go_base
</a></li><li class="dropdown-item"><!----> <a href="/categories/linux基础/" class="nav-link"><i class="undefined"></i>
  linux基础
</a></li><li class="dropdown-item"><!----> <a href="/categories/tools/" class="nav-link"><i class="undefined"></i>
  tools
</a></li><li class="dropdown-item"><!----> <a href="/categories/网络基础/" class="nav-link"><i class="undefined"></i>
  网络基础
</a></li><li class="dropdown-item"><!----> <a href="/categories/代码管理/" class="nav-link"><i class="undefined"></i>
  代码管理
</a></li><li class="dropdown-item"><!----> <a href="/categories/前端/" class="nav-link"><i class="undefined"></i>
  前端
</a></li><li class="dropdown-item"><!----> <a href="/categories/存储/" class="nav-link"><i class="undefined"></i>
  存储
</a></li><li class="dropdown-item"><!----> <a href="/categories/安全/" class="nav-link"><i class="undefined"></i>
  安全
</a></li><li class="dropdown-item"><!----> <a href="/categories/数据库/" class="nav-link"><i class="undefined"></i>
  数据库
</a></li><li class="dropdown-item"><!----> <a href="/categories/ELK/" class="nav-link"><i class="undefined"></i>
  ELK
</a></li><li class="dropdown-item"><!----> <a href="/categories/系统/" class="nav-link"><i class="undefined"></i>
  系统
</a></li><li class="dropdown-item"><!----> <a href="/categories/杂文/" class="nav-link"><i class="undefined"></i>
  杂文
</a></li><li class="dropdown-item"><!----> <a href="/categories/生产事故/" class="nav-link"><i class="undefined"></i>
  生产事故
</a></li><li class="dropdown-item"><!----> <a href="/categories/监控/" class="nav-link"><i class="undefined"></i>
  监控
</a></li><li class="dropdown-item"><!----> <a href="/categories/架构/" class="nav-link"><i class="undefined"></i>
  架构
</a></li><li class="dropdown-item"><!----> <a href="/categories/负载均衡/" class="nav-link"><i class="undefined"></i>
  负载均衡
</a></li><li class="dropdown-item"><!----> <a href="/categories/消息队列/" class="nav-link"><i class="undefined"></i>
  消息队列
</a></li><li class="dropdown-item"><!----> <a href="/categories/自动化/" class="nav-link"><i class="undefined"></i>
  自动化
</a></li><li class="dropdown-item"><!----> <a href="/categories/面试题/" class="nav-link"><i class="undefined"></i>
  面试题
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeLine/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/kame000" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.jianshu.com/u/f6cf3fdb1c59" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-jianshu"></i>
  简书
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.zhihu.com/people/liuwenqi_kame" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-zhihu"></i>
  知乎
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><!----> <h3 class="name" data-v-1fad0c41>
    刘文奇
  </h3> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>178</h3> <h6 data-v-1fad0c41>Articles</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>107</h3> <h6 data-v-1fad0c41>Tags</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/docker/" class="nav-link"><i class="undefined"></i>
  docker
</a></li><li class="dropdown-item"><!----> <a href="/categories/Django/" class="nav-link"><i class="undefined"></i>
  Django
</a></li><li class="dropdown-item"><!----> <a href="/categories/Python基础/" class="nav-link"><i class="undefined"></i>
  Python基础
</a></li><li class="dropdown-item"><!----> <a href="/categories/go_base/" class="nav-link"><i class="undefined"></i>
  go_base
</a></li><li class="dropdown-item"><!----> <a href="/categories/linux基础/" class="nav-link"><i class="undefined"></i>
  linux基础
</a></li><li class="dropdown-item"><!----> <a href="/categories/tools/" class="nav-link"><i class="undefined"></i>
  tools
</a></li><li class="dropdown-item"><!----> <a href="/categories/网络基础/" class="nav-link"><i class="undefined"></i>
  网络基础
</a></li><li class="dropdown-item"><!----> <a href="/categories/代码管理/" class="nav-link"><i class="undefined"></i>
  代码管理
</a></li><li class="dropdown-item"><!----> <a href="/categories/前端/" class="nav-link"><i class="undefined"></i>
  前端
</a></li><li class="dropdown-item"><!----> <a href="/categories/存储/" class="nav-link"><i class="undefined"></i>
  存储
</a></li><li class="dropdown-item"><!----> <a href="/categories/安全/" class="nav-link"><i class="undefined"></i>
  安全
</a></li><li class="dropdown-item"><!----> <a href="/categories/数据库/" class="nav-link"><i class="undefined"></i>
  数据库
</a></li><li class="dropdown-item"><!----> <a href="/categories/ELK/" class="nav-link"><i class="undefined"></i>
  ELK
</a></li><li class="dropdown-item"><!----> <a href="/categories/系统/" class="nav-link"><i class="undefined"></i>
  系统
</a></li><li class="dropdown-item"><!----> <a href="/categories/杂文/" class="nav-link"><i class="undefined"></i>
  杂文
</a></li><li class="dropdown-item"><!----> <a href="/categories/生产事故/" class="nav-link"><i class="undefined"></i>
  生产事故
</a></li><li class="dropdown-item"><!----> <a href="/categories/监控/" class="nav-link"><i class="undefined"></i>
  监控
</a></li><li class="dropdown-item"><!----> <a href="/categories/架构/" class="nav-link"><i class="undefined"></i>
  架构
</a></li><li class="dropdown-item"><!----> <a href="/categories/负载均衡/" class="nav-link"><i class="undefined"></i>
  负载均衡
</a></li><li class="dropdown-item"><!----> <a href="/categories/消息队列/" class="nav-link"><i class="undefined"></i>
  消息队列
</a></li><li class="dropdown-item"><!----> <a href="/categories/自动化/" class="nav-link"><i class="undefined"></i>
  自动化
</a></li><li class="dropdown-item"><!----> <a href="/categories/面试题/" class="nav-link"><i class="undefined"></i>
  面试题
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeLine/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/kame000" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.jianshu.com/u/f6cf3fdb1c59" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-jianshu"></i>
  简书
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.zhihu.com/people/liuwenqi_kame" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-zhihu"></i>
  知乎
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>基于Harbor搭建docker registry</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>刘文奇</span>
          
        <span data-v-59e6cb88>2014 - </span>
        2023
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">基于Harbor搭建docker registry</h1> <div data-v-8a445198><i class="iconfont reco-account" data-v-8a445198><span data-v-8a445198>刘文奇</span></i> <i class="iconfont reco-date" data-v-8a445198><span data-v-8a445198>6/23/2018</span></i> <i class="iconfont reco-eye" data-v-8a445198><span id="/views/Docker/docker%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-8a445198><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <i class="tags iconfont reco-tag" data-v-8a445198><span class="tag-item" data-v-8a445198>docker</span></i></div></div> <div class="theme-reco-content content__default"><h1 id="基于harbor搭建docker-registry"><a href="#基于harbor搭建docker-registry" class="header-anchor">#</a> 基于Harbor搭建docker registry</h1> <p><strong>环境</strong></p> <p>本文记录一下在Centos7.3操作系统上，基于Harbor来搭建docker registry。当前环境为：</p> <p><code># cat /etc/centos-release</code>
CentOS Linux release 7.3.1611 (Core)</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># uname -a</span>
Linux bogon <span class="token number">3.10</span>.0-514.el7.x86_64 <span class="token comment">#1 SMP Tue Nov 22 16:42:41 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-bash line-numbers-mode"><div class="highlight-lines"><div class="highlighted"> </div><br><br></div><pre class="language-bash"><code><span class="token comment"># docker --version</span>
Docker version <span class="token number">17.12</span>.1-ce, build 7390fc6
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># docker-compose --version</span>
<span class="token function">docker-compose</span> version <span class="token number">1.20</span>.1, build 5d8c71b
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="_1-harbor简介"><a href="#_1-harbor简介" class="header-anchor">#</a> 1. Harbor简介</h2> <p>Harbor工程是一个企业级的镜像服务器，用于存储和分发Docker镜像。Harbor扩展了开源软件<code>Docker Distribution</code>，添加了如<code>security</code>、<code>identity</code>和<code>management</code>等功能。作为一个企业级的私有镜像仓库，Harbor提供了更好的性能和安全性。Harbor支持建立多个<code>registries</code>,并提供这些仓库间镜像的复制能力。Harbor也提供了更加先进的安全特性，比如用户管理、访问控制、活动审计。</p> <p><strong>Harbor特性</strong>：</p> <ul><li><p><strong>基于角色的访问控制</strong>: <code>users</code>和<code>repositories</code>都是以projects的方式组织的。在一个project下面，每一个用户对镜像有不同的全向。</p></li> <li><p><strong>基于策略的镜像复制</strong>: 在多个registry之间镜像可以同步，并且在出现错误的时候可以进行自动重试。在负载均衡、高可用性、多数据中心和异构云环境下都表现出色。</p></li> <li><p><strong>脆弱性扫描(Vulnerability Scanning)</strong>: Harbor会周期性的扫描镜像，然后警告用户相应的脆弱性</p></li> <li><p><strong>LDAP/AD支持</strong>: Harbor可以和已存在的企业版LDAP/AD系统集成，以提供用户认证和管理</p></li> <li><p><strong>镜像删除 &amp; 垃圾回收</strong>: Images可以被删除，然后回收它们所占用的空间</p></li> <li><p><strong>可信任(Notary)</strong>: 可以确保镜像的真实性</p></li> <li><p><strong>用户界面(Graphical user portal)</strong>: 用户可以人容易的浏览、搜索仓库和管理工程</p></li> <li><p><strong>审计(Auditing)</strong>: 所有对仓库的操作都会被跟踪记录</p></li> <li><p><strong>RESTful API</strong>: 对于大部分的管理操作都提供了RESTful API， 很容易和外部系统进行集成</p></li> <li><p><strong>易部署</strong>: 提供了离线和在线安装</p></li></ul> <h2 id="_2-harbor的安装"><a href="#_2-harbor的安装" class="header-anchor">#</a> 2. Harbor的安装</h2> <p>这里介绍的是通过<code>Harbor安装文件</code>的方式来安装Harbor。在Linux操作系统上至少需要如下环境：</p> <h3 id="_2-1-下载harbor离线安装包"><a href="#_2-1-下载harbor离线安装包" class="header-anchor">#</a> 2.1 下载Harbor离线安装包</h3> <p>到<a href="https://github.com/vmware/harbor/releases" target="_blank" rel="noopener noreferrer">Harbor Release<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>页面下载对应的离线安装包，目前我们下载最新版本<code>v1.4.0</code>:</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">mkdir</span> /opt/harbor-inst
<span class="token builtin class-name">cd</span> /opt/harbor-inst

<span class="token function">wget</span> https://storage.googleapis.com/harbor-releases/release-1.4.0/harbor-offline-installer-v1.4.0.tgz
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_2-2-目标主机相关配置推荐"><a href="#_2-2-目标主机相关配置推荐" class="header-anchor">#</a> 2.2 目标主机相关配置推荐</h3> <p>Harbor部署完后会运行多个Docker containers，因此可以部署在任何支持docker的Linux发布版本上。部署的目标主机需要安装<code>Python</code>, <code>Docker</code>和<code>Docker Compose</code>。</p> <p><strong>硬件环境：</strong></p> <table><thead><tr><th>Resource</th> <th>Capacity</th> <th>Description</th></tr></thead> <tbody><tr><td>CPU</td> <td>minimal 2 CPU</td> <td>4 CPU is prefered</td></tr> <tr><td>Mem</td> <td>minimal 4GB</td> <td>8GB is preffered</td></tr> <tr><td>Disk</td> <td>minimal 40GB</td> <td>160GB is preffered</td></tr></tbody></table> <p><strong>软件环境</strong></p> <table><thead><tr><th>Software</th> <th>Version</th> <th>Description</th></tr></thead> <tbody><tr><td>Python</td> <td>version 2.7 or higher</td> <td>注意： 在有一些Linux发布版本(Gentoo、Arch)默认没有安装Python，此时你必须手动安装</td></tr> <tr><td>Docker Engine</td> <td>version 1.10 or higher</td> <td>具体安装手册，请参看相关文档:https://docs.docker.com/engine/installation/</td></tr> <tr><td>Docker Compose</td> <td>version 1.6.0 or higher</td> <td>具体安装手册，请参看相关文档:https://docs.docker.com/compose/install/</td></tr> <tr><td>Openssl</td> <td>latest is preffered</td> <td>用于为Harbor产生证书和秘钥</td></tr></tbody></table> <p><strong>网络端口</strong></p> <table><thead><tr><th>Port</th> <th>Protocol</th> <th>Description</th></tr></thead> <tbody><tr><td>443</td> <td>HTTPS</td> <td>在https协议下，Harbor UI与API将会在本端口上接收请求</td></tr> <tr><td>4443</td> <td>HTTPS</td> <td>Harbor的Docker Content Trust service将会连接到本端口，只在Notary启用时使用</td></tr> <tr><td>80</td> <td>HTTP</td> <td>在http协议下，Harbor UI与API将会在本端口上接收请求</td></tr></tbody></table> <p>我们当前的硬件环境：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>//物理CPU个数
<span class="token comment"># cat /proc/cpuinfo| grep &quot;physical id&quot;| sort| uniq| wc -l</span>
<span class="token number">1</span>

//每个CPU核数
<span class="token comment"># cat /proc/cpuinfo| grep &quot;cpu cores&quot;| uniq</span>
cpu cores       <span class="token builtin class-name">:</span> <span class="token number">4</span>

//逻辑CPU个数
<span class="token comment"># cat /proc/cpuinfo  | grep processor</span>
processor       <span class="token builtin class-name">:</span> <span class="token number">0</span>
processor       <span class="token builtin class-name">:</span> <span class="token number">1</span>
processor       <span class="token builtin class-name">:</span> <span class="token number">2</span>
processor       <span class="token builtin class-name">:</span> <span class="token number">3</span>

<span class="token comment"># cat /proc/meminfo | grep MemTotal</span>
MemTotal:       <span class="token number">10058704</span> kB

<span class="token comment">#  fdisk -l | grep Disk</span>
Disk /dev/sda: <span class="token number">85.9</span> GB, <span class="token number">85899345920</span> bytes, <span class="token number">167772160</span> sectors
Disk label type: dos
Disk identifier: 0x000c3eb0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p><strong>我们当前软件环境</strong>：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># python --version</span>
Python <span class="token number">2.7</span>.5

<span class="token comment"># docker --version</span>
Docker version <span class="token number">17.12</span>.1-ce, build 7390fc6

<span class="token comment"># docker-compose --version</span>
<span class="token function">docker-compose</span> version <span class="token number">1.20</span>.1, build 5d8c71b

<span class="token comment"># openssl version -v</span>
OpenSSL <span class="token number">1.0</span>.2k-fips  <span class="token number">26</span> Jan <span class="token number">2017</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_2-3-安装步骤"><a href="#_2-3-安装步骤" class="header-anchor">#</a> 2.3 安装步骤</h3> <p>安装Harbor一般遵循如下步骤：</p> <ul><li><p>下载Harbor installer</p></li> <li><p>配置harbor.cfg</p></li> <li><p>运行<code>install.sh</code>脚本进行安装并启动harbor</p></li></ul> <h4 id="_2-3-1-解压harbor安装包"><a href="#_2-3-1-解压harbor安装包" class="header-anchor">#</a> 2.3.1 解压harbor安装包</h4> <p>我们在上面下载了harbor安装包，这里解压：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># pwd</span>
/opt/harbor-inst

<span class="token comment"># ls</span>
harbor-offline-installer-v1.4.0.tgz

<span class="token comment"># tar -zxvf harbor-offline-installer-v1.4.0.tgz</span>
<span class="token comment"># cd harbor</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="_2-3-2-配置harbor"><a href="#_2-3-2-配置harbor" class="header-anchor">#</a> 2.3.2 配置Harbor</h4> <p>Harbor配置参数处于<code>harbor.cfg</code>文件中。在harbor.cfg配置文件中，有两大类参数： <code>必填参数</code>和<code>可选参数</code></p> <ul><li><p><code>required parameters</code>: 这些参数在配置文件中必须填写。在更新harbor.cfg配置文件后，调用install.sh重新安装Harbor，这些参数就会起作用</p></li> <li><p><code>optional parameters</code>: 这些参数在更新时是可选的。例如， 用户可以先让这些参数取默认值，然后在Harbor启动后在Web UI上来进行修改。假如这些参数在harbor.cfg中也进行了配置，那么只在第一次启动harbor有效。后续再对harbor.cfg进行更新将会被忽略。</p></li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>Note: 假如你选择通过Web UI的方式来更改这些参数，确保在Harbor启动之后马上进行更改。通常，你必须在注册或创建新的用户之前设置auth_mode。
当Harbor系统中有用户之后（出admin管理用户外<span class="token punctuation">)</span>，auth_mode是不能被修改的
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>如下所描述的参数，你至少需要更改<code>hostname</code>属性：</p> <p><strong>Required parameters</strong>:</p> <ul><li><p><code>hostname</code>: 目标主机的hostname名称，被用于访问WebUI和registry服务。其可以被设置为IP地址，或者你目标机器的全限定域名。例如: <code>192.168.1.10</code>或者<code>reg.yourdomain.com</code>。注意不要将hostname设置为<code>localhost</code>或者<code>127.0.0.1</code>, registry服务需要能够被外网访问的到。</p></li> <li><p><code>ui_url_protocol</code>: 可以设置为http或者https，默认值为http。该协议被用于访问Web UI和<code>token/notification</code>服务。假如<code>Notary</code>被使能的话，则必须设置为https。默认情况下采用http协议，要想设置为https,请参看<a href="https://ivanzz1001.github.io/records/post/docker/2018/04/04/Configuring%20Harbor%20with%20HTTPS%20Access" target="_blank" rel="noopener noreferrer">Configuring Harbor with HTTPS Access<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><code>db_password</code>: 当auth采用db_auth方式时，用于设置MySQL数据库的密码。请在任何实际生产环境中，修改此密码</p></li> <li><p><code>max_job_workers</code>: 用于设置job service中<code>replication</code>worker的最大数（默认为3）。对于每一个image replication任务，一个worker会同步repository中所有tags到远程目标地址。增大本字段的值，允许在一个系统中有更多的并发复制进程。然而，每个replication worker都会消耗一定数量的network/CPU/IO资源，请基于你当前的硬件环境选择一个合适的值。</p></li> <li><p><code>customize_crt</code>: 可以被设置为on或者off，默认值为on。当本属性设置为on时，prepare脚本会创建一个<code>private key</code>及<code>root certificate</code>,以用于registry token的验证。假如本属性被设置为off的话，你可以自己手动来产生<code>private key</code>及<code>root certificate</code>。请参看:<a href="https://github.com/vmware/harbor/blob/master/docs/customize_token_service.md" target="_blank" rel="noopener noreferrer">Customize Key and Certificate of Harbor Token Service<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><code>ssl_cert</code>: SSL certificate路径，当协议被设置为https时使用</p></li> <li><p><code>ssl_cert_key</code>: SSL key路径，当协议被设置为https时使用</p></li> <li><p><code>secretkey_path</code>: 用于加密和机密远程registry密码的key路径</p></li> <li><p><code>log_rotate_count</code>: 用于设置日志在回滚多少次之后被删除。假如被设置为0，则日志不会被回滚，而是会被直接删除</p></li> <li><p><code>log_rotate_size</code>: 用于设置日志在多大时会进行回滚，单位可以是K/M/G，分别表示KB/MB/GB。</p></li></ul> <p><strong>Optional parameters</strong>:</p> <ul><li><p><code>Email settings</code>: 这些信息主要是为了重置Harbor密码时使用，通常情况下我们并不需要。</p></li> <li><p><code>harbor_admin_password</code>: 用于设置管理员初始密码。该密码只在Harbor第一次启动时有效。启动之后该密码将会被忽略，Administrator的密码应该在UI中进行设置。注意，默认的用户名/密码为<code>admin/Harbor12345</code>。</p></li> <li><p><code>auth_mode</code>: 用户认证的类型，默认情况下为<code>db_auth</code>，这种情况下用户名密码被存放在数据库中。如果要使用<code>LDAP</code>认证的话，请将此字段设置为<code>ldap_auth</code>。</p></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>IMPORTANT: 当要从一个已存在的Harbor实例升级的时候，你必须确保在harbor.cfg中配置的auth_mode是相同的，否则在更新后可能会造成用户不能正常登录
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><p><code>ldap_url</code>: LDAP端点的URL(例如：ldaps://ldap.mydomain.com)。只在auth_mode被设置为<code>ldap_auth</code>时使用</p></li> <li><p><code>ldap_searchdn</code>、<code>ldap_search_pwd</code>、<code>ldap_basedn</code>、<code>ldap_filter</code>、<code>ldap_uid</code>、<code>ldap_scope</code></p></li> <li><p><code>self_registration</code>: 可选值为on/off，默认为on。本选项用于使能或禁止注册成为本系统的账户。当被禁止时，新用户只能由admin用户来创建，在Harbor中只有admin用户可以创建新用户。注意： 当auth_mode被设置为<code>ldap_auth</code>时，self-registration功能总是会被禁止，并且此选项会被忽略。</p></li> <li><p><code>token_expiration</code>: token创建多长时间之后会过期，默认是30min</p></li> <li><p><code>project_creation_restriction</code>: 本flag用于控制哪些用户有权限来创建projects。默认情况下，任何用户都可以创建project，假如设置为<code>adminonly</code>，则只有admin用户可以创建project。</p></li></ul> <h4 id="_2-3-3-配置存储后端-可选"><a href="#_2-3-3-配置存储后端-可选" class="header-anchor">#</a> 2.3.3 配置存储后端(可选）</h4> <p>默认情况下，Harbor存储镜像到本地文件系统。在实际的生产环境下，你可以采用其他的存储后端来代替本地文件系统，例如可以采用S3、OpenStack Swift、Ceph等。而这你需要修改的文件是<code>common/templates/registry/config.yml</code>的<code>storage</code>字段。例如，假如你需要配置存储后端为Openstack swift，则storage段类似如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>storage:
  swift:
    username: admin
    password: ADMIN_PASS
    authurl: http://keystone_addr:35357/v3/auth
    tenant: admin
    domain: default
    region: regionOne
    container: docker_images
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>想要了解详细的后端存储配置，请参看<a href="https://docs.docker.com/registry/configuration/" target="_blank" rel="noopener noreferrer">Registry Configuration Reference<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="_2-4-完成安装并启动harbor"><a href="#_2-4-完成安装并启动harbor" class="header-anchor">#</a> 2.4 完成安装并启动Harbor</h3> <p>一旦harbor.cfg及存储后端(可选）完成配置，使用<code>install.sh</code>脚本完成安装并启动Harbor。</p> <p><strong>1) 默认安装(without Notary/Clair)</strong></p> <p>Harbor已经集成了Notary/Clair(用于vulnerability scanning）。然而，默认的安装并不包含Notary/Clair:</p> <pre style="margin-block-start:0px;margin-block-end:0px;margin:0.5em 0px;padding:0.5em 18.6094px;border:1px solid rgb(204, 204, 204);outline:0px;font-weight:inherit;font-style:inherit;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:0.9em;vertical-align:baseline;background:rgb(47, 43, 43);color:rgb(166, 226, 46);line-height:1.5;border-radius:0.35em;overflow-wrap:break-word;overflow:auto;"># sudo ./install.sh
</pre> <p>假如一切工作正常的话，你可以打开一个用户界面，然后访问后台管理页面<code>http://reg.yourdomain.com/</code>(注意这里请将reg.yourdomain.com替换为你在harbor.cfg中配置的hostname字段的值），默认的后台管理username/password为admin/Harbor12345</p> <p>登录admin管理页面，然后创建一个新的工程，例如<code>myproject</code>，你可以使用docker命令来登录并push镜像(默认情况下，registry server监听在80端口上）:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># docker login reg.yourdomain.com
# docker push reg.yourdomain.com/myproject/myrepo:mytag
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><code>IMPORTANT</code>: 默认情况下安装Harbor，使用的是http协议。这样你必须为docker daemon添加<code>--insecure-registry</code>，并重启docker daemon服务</p> <p><strong>2) Installation with Notary</strong></p> <p>要安装带<code>Notary</code>服务的Harbor，你可以在运行<code>install.sh</code>脚本时添加一个参数：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># sudo ./install.sh --with-notary
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>NOTE</code>: 要让Harbor支持Notary服务的话，<code>ui_url_protocol</code>必须配置为<code>https</code>。要配置https,请参考另外的章节</p> <p>要了解更多关于<code>Notary</code>及<code>Docker Content Trust</code>相关信息，请参看docker相关文档：<a href="https://docs.docker.com/engine/security/trust/content_trust/" target="_blank" rel="noopener noreferrer">Docker Content Trust<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>3) Installation with Clair</strong></p> <p>要安装带<code>Clair</code>服务的Harbor，你可以在运行<code>install.sh</code>脚本时添加一个参数：</p> <p><code># sudo ./install.sh --with-clair</code></p> <p>要想了解更多<code>Clair</code>相关信息，请参看<a href="https://coreos.com/clair/docs/2.0.1/" target="_blank" rel="noopener noreferrer">Clair文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><code>注意</code>： 假如要同时支持Notary与Clair，你必须在同一个命令中同时指定这两个参数：</p> <p><code># sudo ./install.sh --with-notary --with-clair</code></p> <p>欲了解更多Harbor的使用，请参看<a href="https://github.com/vmware/harbor/blob/master/docs/user_guide.md" target="_blank" rel="noopener noreferrer">User Guide of Harbor<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="_3-配置harbor以支持https访问"><a href="#_3-配置harbor以支持https访问" class="header-anchor">#</a> 3. 配置Harbor以支持https访问</h2> <p>Harbor本身在发布时并不提供任何证书，默认情况下，其使用http来提供相应服务。这使得Harbor可以相对容易来建立及运行，特别是在开发及测试环境中，这很重要。然而在实际的生产环境中，并不建议采用http。要使能https，请参看<a href="https://github.com/vmware/harbor/blob/master/docs/configure_https.md" target="_blank" rel="noopener noreferrer">Configuring Harbor with HTTPS Access<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="_4-harbor生命周期管理"><a href="#_4-harbor生命周期管理" class="header-anchor">#</a> 4. Harbor生命周期管理</h2> <p>你可以使用docker-compose来管理Harbor的生命周期，下面列出一些常用的命令（说明必须在docker-compose.yml文件所在目录运行)：</p> <p><strong>1) 停止Harbor</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code># sudo docker-compose stop
Stopping nginx ... done
Stopping harbor-jobservice ... done
Stopping harbor-ui ... done
Stopping harbor-db ... done
Stopping registry ... done
Stopping harbor-log ... done
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>2) 在Harbor停止后，重启Harbor</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code># sudo docker-compose start
Starting log ... done
Starting ui ... done
Starting mysql ... done
Starting jobservice ... done
Starting registry ... done
Starting proxy ... done
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>3) 如果要改变Harbor的配置，首先要停止当前已存在的Harbor实例，然后更新harbor.cfg。然后再运行<code>prepare</code>脚本更新配置文件，最后再重新创建并启动Harbor实例</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code># sudo docker-compose down -v
# vim harbor.cfg
# sudo prepare
# sudo docker-compose up -d
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>4) 移除Harbor容器，但保留文件系统上的image data及Harbor数据库</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code># sudo docker-compose down -v
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>5) 移除Harbor数据库及image data(用于干净环境下Harbor重装)</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code># rm -rf /data/database
# rm -rf /data/registry
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_4-1-harbor-with-notary生命周期管理"><a href="#_4-1-harbor-with-notary生命周期管理" class="header-anchor">#</a> 4.1 Harbor with Notary生命周期管理</h3> <p>当Harbor被安装支持Notary服务时，需要给docker-compose提供一个额外的模板文件<code>docker-compose.notary.yml</code>。docker-compose管理Harbor生命周期的命令：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># sudo docker-compose -f ./docker-compose.yml -f ./docker-compose.notary.yml [ up|down|ps|stop|start ]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>例如，假如你想要改变<code>harbor.cfg</code>配置文件，并重新部署带Notary服务的Harbor，那么你可以用如下的命令：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># sudo docker-compose -f ./docker-compose.yml -f ./docker-compose.notary.yml down -v
# vim harbor.cfg
# sudo prepare --with-notary
# sudo docker-compose -f ./docker-compose.yml -f ./docker-compose.notary.yml up -d
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_4-2-harbor-with-clair生命周期管理"><a href="#_4-2-harbor-with-clair生命周期管理" class="header-anchor">#</a> 4.2 Harbor with Clair生命周期管理</h3> <p>当Harbor被安装支持Clair服务时，需要给docker-compose提供一个额外的模板文件<code>docker-compose.clair.yml</code>。docker-compose管理Clair生命周期的命令：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#  sudo docker-compose -f ./docker-compose.yml -f ./docker-compose.clair.yml [ up|down|ps|stop|start ]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>例如，假如你想要改变<code>harbor.cfg</code>配置文件，并重新部署带Clair服务的Harbor，那么你可以用如下的命令：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># sudo docker-compose -f ./docker-compose.yml -f ./docker-compose.clair.yml down -v
# vim harbor.cfg
# sudo prepare --with-clair
# sudo docker-compose -f ./docker-compose.yml -f ./docker-compose.clair.yml up -d
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_4-3-harbor-with-notary-and-clair生命周期管理"><a href="#_4-3-harbor-with-notary-and-clair生命周期管理" class="header-anchor">#</a> 4.3 Harbor with Notary and Clair生命周期管理</h3> <p>假如你安装了同时支持Notary及Clair服务的Harbor，你应该在docker-compose命令中包含两个组件：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># sudo docker-compose -f ./docker-compose.yml -f ./docker-compose.notary.yml -f ./docker-compose.clair.yml down -v
# vim harbor.cfg
# sudo prepare --with-notary --with-clair
# sudo docker-compose -f ./docker-compose.yml -f ./docker-compose.notary.yml -f ./docker-compose.clair.yml up -d
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>请参看<a href="https://docs.docker.com/compose/reference/" target="_blank" rel="noopener noreferrer">Docker Compose command-line reference<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>以了解更多docker-compose的用法。</p> <h2 id="_5-持久化数据及日志文件"><a href="#_5-持久化数据及日志文件" class="header-anchor">#</a> 5. 持久化数据及日志文件</h2> <p>默认情况下，registry的数据会被持久化到主机的<code>/data/</code>目录。即使在容器被移除或者重新创建的情况下，这些数据都会维持不变。</p> <p>另外，Harbor使用<code>rsyslog</code>来收集每一个容器的日志。默认情况下，这些日志文件都被存储在<code>/var/log/harbor</code>目录下，我们可以使用这些日志来处理一些相关问题。</p> <h2 id="_6-定制化harbor监听端口"><a href="#_6-定制化harbor监听端口" class="header-anchor">#</a> 6. 定制化Harbor监听端口</h2> <p>默认情况下，Harbor会监听80端口(http)和443端口(假如配置了https)，以此来处理Harbor的后台管理操作及支持docker的相关命令。你也可以对这些端口进行相应的定制。</p> <h3 id="_6-1-定制http协议端口"><a href="#_6-1-定制http协议端口" class="header-anchor">#</a> 6.1 定制http协议端口</h3> <p><strong>1) 修改docker-compose.yml文件</strong></p> <p>替换第一个<code>80</code>端口为一个定制化指定端口，例如<code>8888:80</code>:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>proxy:
    image: library/nginx:1.11.5
    restart: always
    volumes:
      - ./config/nginx:/etc/nginx
    ports:
      - 8888:80
      - 443:443
    depends_on:
      - mysql
      - registry
      - ui
      - log
    logging:
      driver: &quot;syslog&quot;
      options: 
        syslog-address: &quot;tcp://127.0.0.1:1514&quot;
        tag: &quot;proxy&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p><strong>2) 修改harbor.cfg文件，添加端口到<code>hostname</code>参数</strong></p> <p><code>hostname = 192.168.0.2:8888</code></p> <p><strong>3) 重新部署Harbor</strong></p> <p>请参看前面”Harbor生命周期管理”相关章节。</p> <h3 id="_6-2-定制https协议端口"><a href="#_6-2-定制https协议端口" class="header-anchor">#</a> 6.2 定制https协议端口</h3> <p><strong>1) 在Harbor中使能HTTPS</strong></p> <p>请参看相关章节。</p> <p><strong>2) 修改docker-compose.yml文件</strong></p> <p>将第一个<code>443</code>端口替换为一个定制化指定端口，例如<code>8888:80</code>:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>proxy:
    image: library/nginx:1.11.5
    restart: always
    volumes:
      - ./config/nginx:/etc/nginx
    ports:
      - 80:80
      - 8888:443
    depends_on:
      - mysql
      - registry
      - ui
      - log
    logging:
      driver: &quot;syslog&quot;
      options: 
        syslog-address: &quot;tcp://127.0.0.1:1514&quot;
        tag: &quot;proxy&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p><strong>3) 修改harbor.cfg文件，添加端口到<code>hostname</code>参数</strong></p> <p><code>hostname = 192.168.0.2:8888</code></p> <p><strong>4) 重新部署Harbor</strong></p> <p>请参看前面”Harbor生命周期管理”相关章节。</p> <h2 id="_7-性能调优"><a href="#_7-性能调优" class="header-anchor">#</a> 7. 性能调优</h2> <p>默认情况下，Harbor会限制Clair容器的的CPU使用率为15000来避免其占用所有的CPU资源。这是在<code>docker-compose.clair.yml</code>文件中进行配置的。你可以根据你的硬件配置进行相应的修改。</p> <h2 id="_8-troubleshooting"><a href="#_8-troubleshooting" class="header-anchor">#</a> 8. Troubleshooting</h2> <p>1） 当Harbor不能正常工作时，通过运行如下的命令来找出是否所有的容器都处于<code>UP</code>状态</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># sudo docker-compose ps
        Name                     Command               State                    Ports                  
  -----------------------------------------------------------------------------------------------------
  harbor-db           docker-entrypoint.sh mysqld      Up      3306/tcp                                
  harbor-jobservice   /harbor/harbor_jobservice        Up                                              
  harbor-log          /bin/sh -c crond &amp;&amp; rsyslo ...   Up      127.0.0.1:1514-&gt;514/tcp                   
  harbor-ui           /harbor/harbor_ui                Up                                              
  nginx               nginx -g daemon off;             Up      0.0.0.0:443-&gt;443/tcp, 0.0.0.0:80-&gt;80/tcp
  registry            /entrypoint.sh serve /etc/ ...   Up      5000/tcp
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>假如有一个container不是处于<code>UP</code>状态，请检查<code>/var/log/harbor</code>目录下该容器的日志。例如，假如<code>harbor-ui</code>没有运行的话，你可以查询<code>ui.log</code>日志文件。</p> <ol><li>当在一个Nginx代代理或ELB(elastic load balancing)后端建立Harbor时，请在<code>common/templates/nginx/nginx.http.conf</code>文件中查询如下行：</li></ol> <p><code>proxy_set_header X-Forwarded-Proto $scheme;</code></p> <p>假如代理中已经有类似于<code>location /, location /v2/ 与 location /service/</code>的设置，请将其从所在section移除，然后根据上面<code>Harbor生命周期管理</code>相关章节重新部署Harbor。</p> <h2 id="_9-部署示例"><a href="#_9-部署示例" class="header-anchor">#</a> 9. 部署示例</h2> <p>前面我们已经下载并解压好了harbor，这里我们进入解压好的根目录：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># cd /opt/harbor-inst/harbor
# ls
common  docker-compose.clair.yml  docker-compose.notary.yml  docker-compose.yml  ha  harbor.cfg  harbor.v1.4.0.tar.gz  install.sh  LICENSE  NOTICE  prepare
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>我们当前ip地址为<code>192.168.69.128</code>, 用netstat查看<code>80</code>、<code>443</code>等端口也没有被占用。</p> <p><strong>1) 修改harbor.cfg的<code>hostname</code>字段</strong></p> <pre style="margin-block-start:0px;margin-block-end:0px;margin:0.5em 0px;padding:0.5em 18.6094px;border:1px solid rgb(204, 204, 204);outline:0px;font-weight:inherit;font-style:inherit;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:0.9em;vertical-align:baseline;background:rgb(47, 43, 43);color:rgb(166, 226, 46);line-height:1.5;border-radius:0.35em;overflow-wrap:break-word;overflow:auto;">hostname = 192.168.69.128
</pre> <p><strong>2) 执行install.sh脚本</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code># ./install.sh

[Step 0]: checking installation environment ...

Note: docker version: 17.12.1

Note: docker-compose version: 1.20.1

[Step 1]: loading Harbor images ...
651f69aef02c: Loading layer [==================================================&gt;]  135.8MB/135.8MB
40a1aad64343: Loading layer [==================================================&gt;]  23.24MB/23.24MB
3fe2713e4072: Loading layer [==================================================&gt;]  12.16MB/12.16MB
ba3a1eb0e375: Loading layer [==================================================&gt;]   17.3MB/17.3MB
447427ec5e1a: Loading layer [==================================================&gt;]  15.87kB/15.87kB
4ccb4026663c: Loading layer [==================================================&gt;]  3.072kB/3.072kB
16faa95946a1: Loading layer [==================================================&gt;]  29.46MB/29.46MB
Loaded image: vmware/notary-server-photon:v0.5.1-v1.4.0
fa7ba9fd42c9: Loading layer [==================================================&gt;]  10.95MB/10.95MB
4e400f9ae23e: Loading layer [==================================================&gt;]   17.3MB/17.3MB
2802fb27c88b: Loading layer [==================================================&gt;]  15.87kB/15.87kB
e6367a4e1e1e: Loading layer [==================================================&gt;]  3.072kB/3.072kB
8ece8dfcdd98: Loading layer [==================================================&gt;]  28.24MB/28.24MB
Loaded image: vmware/notary-signer-photon:v0.5.1-v1.4.0
a7dd1a8afcaf: Loading layer [==================================================&gt;]  396.7MB/396.7MB
05adebbe496f: Loading layer [==================================================&gt;]  9.216kB/9.216kB
86eb534949fa: Loading layer [==================================================&gt;]  9.216kB/9.216kB
d7f127c69380: Loading layer [==================================================&gt;]   7.68kB/7.68kB
5ac1c4dc5ee9: Loading layer [==================================================&gt;]  1.536kB/1.536kB
d0bec56b5b1a: Loading layer [==================================================&gt;]  9.728kB/9.728kB
4bbe83860556: Loading layer [==================================================&gt;]   2.56kB/2.56kB
e526f9e6769f: Loading layer [==================================================&gt;]  3.072kB/3.072kB
Loaded image: vmware/harbor-db:v1.4.0
1cff102bbda2: Loading layer [==================================================&gt;]  154.1MB/154.1MB
04c9f3e07de1: Loading layer [==================================================&gt;]  10.75MB/10.75MB
7b6c7bf54f5c: Loading layer [==================================================&gt;]  2.048kB/2.048kB
42f8acdb7fe3: Loading layer [==================================================&gt;]  48.13kB/48.13kB
5b6299d0a1df: Loading layer [==================================================&gt;]   10.8MB/10.8MB
Loaded image: vmware/clair-photon:v2.0.1-v1.4.0
6534131f457c: Loading layer [==================================================&gt;]  94.76MB/94.76MB
73f582101e4b: Loading layer [==================================================&gt;]  6.656kB/6.656kB
86d847823c48: Loading layer [==================================================&gt;]  6.656kB/6.656kB
Loaded image: vmware/postgresql-photon:v1.4.0
5cd250d5a352: Loading layer [==================================================&gt;]  23.24MB/23.24MB
ad3fd52b54f3: Loading layer [==================================================&gt;]  14.99MB/14.99MB
13b1e24cc368: Loading layer [==================================================&gt;]  14.99MB/14.99MB
Loaded image: vmware/harbor-adminserver:v1.4.0
c26c69706710: Loading layer [==================================================&gt;]  23.24MB/23.24MB
223f6fe02cc8: Loading layer [==================================================&gt;]  23.45MB/23.45MB
1fc843c8698a: Loading layer [==================================================&gt;]  7.168kB/7.168kB
e09293610ee7: Loading layer [==================================================&gt;]  10.39MB/10.39MB
d59f9780b1d8: Loading layer [==================================================&gt;]  23.44MB/23.44MB
Loaded image: vmware/harbor-ui:v1.4.0
dd4753242e59: Loading layer [==================================================&gt;]  73.07MB/73.07MB
95aed61ca251: Loading layer [==================================================&gt;]  3.584kB/3.584kB
1864f9818562: Loading layer [==================================================&gt;]  3.072kB/3.072kB
da2a19f80b81: Loading layer [==================================================&gt;]  4.096kB/4.096kB
058531639e75: Loading layer [==================================================&gt;]  3.584kB/3.584kB
a84e69fb619b: Loading layer [==================================================&gt;]  10.24kB/10.24kB
Loaded image: vmware/harbor-log:v1.4.0
b1056051f246: Loading layer [==================================================&gt;]  23.24MB/23.24MB
07678065e08b: Loading layer [==================================================&gt;]  19.19MB/19.19MB
a2d9bdb8f5fb: Loading layer [==================================================&gt;]  19.19MB/19.19MB
Loaded image: vmware/harbor-jobservice:v1.4.0
7f58ce57cd5e: Loading layer [==================================================&gt;]  4.805MB/4.805MB
Loaded image: vmware/nginx-photon:v1.4.0
4c8965978b77: Loading layer [==================================================&gt;]  23.24MB/23.24MB
1466c942edde: Loading layer [==================================================&gt;]  2.048kB/2.048kB
ac5c17331735: Loading layer [==================================================&gt;]  2.048kB/2.048kB
86824c7c466a: Loading layer [==================================================&gt;]  2.048kB/2.048kB
fd3bd0e70d67: Loading layer [==================================================&gt;]   22.8MB/22.8MB
b02195d77636: Loading layer [==================================================&gt;]   22.8MB/22.8MB
Loaded image: vmware/registry-photon:v2.6.2-v1.4.0
Loaded image: vmware/photon:1.0
Loaded image: vmware/mariadb-photon:v1.4.0
454c81edbd3b: Loading layer [==================================================&gt;]  135.2MB/135.2MB
e99db1275091: Loading layer [==================================================&gt;]  395.4MB/395.4MB
051e4ee23882: Loading layer [==================================================&gt;]  9.216kB/9.216kB
6cca4437b6f6: Loading layer [==================================================&gt;]  9.216kB/9.216kB
1d48fc08c8bc: Loading layer [==================================================&gt;]   7.68kB/7.68kB
0419724fd942: Loading layer [==================================================&gt;]  1.536kB/1.536kB
526b2156bd7a: Loading layer [==================================================&gt;]  637.8MB/637.8MB
9ebf6900ecbd: Loading layer [==================================================&gt;]  78.34kB/78.34kB
Loaded image: vmware/harbor-db-migrator:1.4

[Step 2]: preparing environment ...
Generated and saved secret to file: /data/secretkey
Generated configuration file: ./common/config/nginx/nginx.conf
Generated configuration file: ./common/config/adminserver/env
Generated configuration file: ./common/config/ui/env
Generated configuration file: ./common/config/registry/config.yml
Generated configuration file: ./common/config/db/env
Generated configuration file: ./common/config/jobservice/env
Generated configuration file: ./common/config/log/logrotate.conf
Generated configuration file: ./common/config/jobservice/app.conf
Generated configuration file: ./common/config/ui/app.conf
Generated certificate, key file: ./common/config/ui/private_key.pem, cert file: ./common/config/registry/root.crt
The configuration files are ready, please use docker-compose to start the service.

[Step 3]: checking existing instance of Harbor ...

[Step 4]: starting Harbor ...
Creating network &quot;harbor_harbor&quot; with the default driver
Creating harbor-log ... done
Creating harbor-adminserver ... done
Creating harbor-db          ... done
Creating registry           ... done
Creating harbor-ui          ... done
Creating harbor-jobservice  ... done
Creating nginx              ... done

✔ ----Harbor has been installed and started successfully.----

Now you should be able to visit the admin portal at http://192.168.69.128\.
For more details, please visit https://github.com/vmware/harbor .

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br></div></div><p><strong>3) 查询Harbor运行状态</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code># docker ps
CONTAINER ID        IMAGE                                  COMMAND                  CREATED             STATUS                            PORTS                                                              NAMES
10b95448f80f        vmware/nginx-photon:v1.4.0             &quot;nginx -g 'daemon of…&quot;   5 seconds ago       Up 4 seconds                      0.0.0.0:80-&gt;80/tcp, 0.0.0.0:443-&gt;443/tcp, 0.0.0.0:4443-&gt;4443/tcp   nginx
64893e6ba9d3        vmware/harbor-jobservice:v1.4.0        &quot;/harbor/start.sh&quot;       5 seconds ago       Up 4 seconds (health: starting)                                                                      harbor-jobservice
62220b07e57f        vmware/harbor-ui:v1.4.0                &quot;/harbor/start.sh&quot;       5 seconds ago       Up 5 seconds (health: starting)                                                                      harbor-ui
ce166d26724e        vmware/harbor-db:v1.4.0                &quot;/usr/local/bin/dock…&quot;   7 seconds ago       Up 6 seconds (health: starting)   3306/tcp                                                           harbor-db
a62d8f460c35        vmware/registry-photon:v2.6.2-v1.4.0   &quot;/entrypoint.sh serv…&quot;   7 seconds ago       Up 5 seconds (health: starting)   5000/tcp                                                           registry
5e5e4bcee123        vmware/harbor-adminserver:v1.4.0       &quot;/harbor/start.sh&quot;       7 seconds ago       Up 6 seconds (health: starting)                                                                      harbor-adminserver
cb6dbc564382        vmware/harbor-log:v1.4.0               &quot;/bin/sh -c /usr/loc…&quot;   7 seconds ago       Up 6 seconds (health: starting)   127.0.0.1:1514-&gt;10514/tcp                                          harbor-log
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>4) 访问</strong></p> <p>首先我们用curl命令访问一下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># curl -X GET http://192.168.69.128 -k -IL
HTTP/1.1 200 OK
Server: nginx
Date: Mon, 09 Apr 2018 02:43:20 GMT
Content-Type: text/html; charset=utf-8
Content-Length: 810
Connection: keep-alive
Set-Cookie: beegosessionID=1720767232a3cdcb58a54cd13eead058; Path=/; HttpOnly
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>然后我们再用浏览器访问。</p> <p><strong>5） 向Harbor push/pull镜像</strong></p> <ul><li>停止Harbor</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code># docker-compose stop
Stopping nginx              ... done
Stopping harbor-jobservice  ... done
Stopping harbor-ui          ... done
Stopping harbor-db          ... done
Stopping registry           ...
Stopping registry           ... done
Stopping harbor-adminserver ... done
Stopping harbor-log         ... done
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>修改dockerd启动脚本</li></ul> <p>这里修改<code>/lib/systemd/system/docker.service</code>文件，将<code>ExecStart</code>修改为：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ExecStart=/usr/bin/dockerd \
        --insecure-registry=192.168.69.128 \
        -H tcp://0.0.0.0:2375 \
        -H unix://var/run/docker.sock \
        -H tcp://0.0.0.0:7654
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>上面添加了<code>--insecure-registry</code>选项。然后执行再执行如下命令重启dockerd:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># systemctl daemon-reload

# systemctl restart docker
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>6） 重启Harbor</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code># docker-compose start
Starting log         ... done
Starting registry    ... done
Starting mysql       ... done
Starting adminserver ... done
Starting ui          ... done
Starting jobservice  ... done
Starting proxy       ... done
# docker ps
CONTAINER ID        IMAGE                                  COMMAND                  CREATED             STATUS                            PORTS                                                              NAMES
10b95448f80f        vmware/nginx-photon:v1.4.0             &quot;nginx -g 'daemon of…&quot;   21 minutes ago      Up Less than a second             0.0.0.0:80-&gt;80/tcp, 0.0.0.0:443-&gt;443/tcp, 0.0.0.0:4443-&gt;4443/tcp   nginx
64893e6ba9d3        vmware/harbor-jobservice:v1.4.0        &quot;/harbor/start.sh&quot;       21 minutes ago      Up 4 seconds (health: starting)                                                                      harbor-jobservice
62220b07e57f        vmware/harbor-ui:v1.4.0                &quot;/harbor/start.sh&quot;       21 minutes ago      Up 4 seconds (health: starting)                                                                      harbor-ui
ce166d26724e        vmware/harbor-db:v1.4.0                &quot;/usr/local/bin/dock…&quot;   21 minutes ago      Up 57 seconds (healthy)           3306/tcp                                                           harbor-db
a62d8f460c35        vmware/registry-photon:v2.6.2-v1.4.0   &quot;/entrypoint.sh serv…&quot;   21 minutes ago      Up 57 seconds (healthy)           5000/tcp                                                           registry
5e5e4bcee123        vmware/harbor-adminserver:v1.4.0       &quot;/harbor/start.sh&quot;       21 minutes ago      Up 4 seconds (health: starting)                                                                      harbor-adminserver
cb6dbc564382        vmware/harbor-log:v1.4.0               &quot;/bin/sh -c /usr/loc…&quot;   21 minutes ago      Up 57 seconds (healthy)           127.0.0.1:1514-&gt;10514/tcp                                          harbor-log
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p><strong>7) 往Harbor中push/pull镜像</strong></p> <ul><li>登录</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code># docker login 192.168.69.128
Username: admin
Password:
Login Succeeded
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>重新为镜像打tag</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code># docker images
REPOSITORY                    TAG                 IMAGE ID            CREATED             SIZE
test-image                    latest              fe9c46d12863        7 days ago          195MB
friendlyhello                 latest              f2ae8dec6267        9 days ago          150MB
redis                         alpine              c27f56585938        3 weeks ago         27.7MB

//这里我们用Harbor中的默认库
# docker tag redis:alpine 192.168.69.128/library/redis:alpine
# docker images | grep redis
192.168.69.128/library/redis          alpine              c27f56585938        3 weeks ago         27.7MB
redis                         alpine              c27f56585938        3 weeks ago         27.7MB
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li>上传镜像到Harbor</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code># docker push 192.168.69.128/library/redis:alpine
The push refers to repository [192.168.69.128/library/redis]
f6b9463783dc: Pushed
222a85888a99: Pushed
1925395eabdd: Pushed
c3d278563734: Pushed
ad9247fe8c63: Pushed
cd7100a72410: Pushed
alpine: digest: sha256:9d017f829df3d0800f2a2582c710143767f6dda4df584b708260e73b1a1b6db3 size: 1568
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>然后我们登录网站，可以看到镜像上传成功。（注： 这里Harbor默认采用<code>Www-Authenticate: Bearer</code>认证）</p> <ul><li>下载镜像</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>//这里我们先把原来本地的镜像删除
# docker rmi 192.168.69.128/library/redis:alpine

//从Harbor镜像库拉取镜像
# docker pull 192.168.69.128/library/redis:alpine
alpine: Pulling from library/redis
Digest: sha256:9d017f829df3d0800f2a2582c710143767f6dda4df584b708260e73b1a1b6db3
Status: Downloaded newer image for 192.168.69.128/library/redis:alpine
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>[参考]</strong></p> <ol><li><p><a href="https://github.com/vmware/harbor" target="_blank" rel="noopener noreferrer">harbor官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://blog.csdn.net/felix_yujing/article/details/54694294" target="_blank" rel="noopener noreferrer">Centos7上Docker仓库Harbor的搭建<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ol></div></section> <footer class="page-edit"><!----> <!----></footer> <!----> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-b57cc07c data-v-7dd95ae2><li class="level-2" data-v-b57cc07c><a href="/views/Docker/docker%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93.html#_1-harbor简介" class="sidebar-link reco-side-_1-harbor简介" data-v-b57cc07c>1. Harbor简介</a></li><li class="level-2" data-v-b57cc07c><a href="/views/Docker/docker%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93.html#_2-harbor的安装" class="sidebar-link reco-side-_2-harbor的安装" data-v-b57cc07c>2. Harbor的安装</a></li><li class="level-3" data-v-b57cc07c><a href="/views/Docker/docker%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93.html#_2-1-下载harbor离线安装包" class="sidebar-link reco-side-_2-1-下载harbor离线安装包" data-v-b57cc07c>2.1 下载Harbor离线安装包</a></li><li class="level-3" data-v-b57cc07c><a href="/views/Docker/docker%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93.html#_2-2-目标主机相关配置推荐" class="sidebar-link reco-side-_2-2-目标主机相关配置推荐" data-v-b57cc07c>2.2 目标主机相关配置推荐</a></li><li class="level-3" data-v-b57cc07c><a href="/views/Docker/docker%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93.html#_2-3-安装步骤" class="sidebar-link reco-side-_2-3-安装步骤" data-v-b57cc07c>2.3 安装步骤</a></li><li class="level-3" data-v-b57cc07c><a href="/views/Docker/docker%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93.html#_2-4-完成安装并启动harbor" class="sidebar-link reco-side-_2-4-完成安装并启动harbor" data-v-b57cc07c>2.4 完成安装并启动Harbor</a></li><li class="level-2" data-v-b57cc07c><a href="/views/Docker/docker%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93.html#_3-配置harbor以支持https访问" class="sidebar-link reco-side-_3-配置harbor以支持https访问" data-v-b57cc07c>3. 配置Harbor以支持https访问</a></li><li class="level-2" data-v-b57cc07c><a href="/views/Docker/docker%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93.html#_4-harbor生命周期管理" class="sidebar-link reco-side-_4-harbor生命周期管理" data-v-b57cc07c>4. Harbor生命周期管理</a></li><li class="level-3" data-v-b57cc07c><a href="/views/Docker/docker%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93.html#_4-1-harbor-with-notary生命周期管理" class="sidebar-link reco-side-_4-1-harbor-with-notary生命周期管理" data-v-b57cc07c>4.1 Harbor with Notary生命周期管理</a></li><li class="level-3" data-v-b57cc07c><a href="/views/Docker/docker%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93.html#_4-2-harbor-with-clair生命周期管理" class="sidebar-link reco-side-_4-2-harbor-with-clair生命周期管理" data-v-b57cc07c>4.2 Harbor with Clair生命周期管理</a></li><li class="level-3" data-v-b57cc07c><a href="/views/Docker/docker%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93.html#_4-3-harbor-with-notary-and-clair生命周期管理" class="sidebar-link reco-side-_4-3-harbor-with-notary-and-clair生命周期管理" data-v-b57cc07c>4.3 Harbor with Notary and Clair生命周期管理</a></li><li class="level-2" data-v-b57cc07c><a href="/views/Docker/docker%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93.html#_5-持久化数据及日志文件" class="sidebar-link reco-side-_5-持久化数据及日志文件" data-v-b57cc07c>5. 持久化数据及日志文件</a></li><li class="level-2" data-v-b57cc07c><a href="/views/Docker/docker%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93.html#_6-定制化harbor监听端口" class="sidebar-link reco-side-_6-定制化harbor监听端口" data-v-b57cc07c>6. 定制化Harbor监听端口</a></li><li class="level-3" data-v-b57cc07c><a href="/views/Docker/docker%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93.html#_6-1-定制http协议端口" class="sidebar-link reco-side-_6-1-定制http协议端口" data-v-b57cc07c>6.1 定制http协议端口</a></li><li class="level-3" data-v-b57cc07c><a href="/views/Docker/docker%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93.html#_6-2-定制https协议端口" class="sidebar-link reco-side-_6-2-定制https协议端口" data-v-b57cc07c>6.2 定制https协议端口</a></li><li class="level-2" data-v-b57cc07c><a href="/views/Docker/docker%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93.html#_7-性能调优" class="sidebar-link reco-side-_7-性能调优" data-v-b57cc07c>7. 性能调优</a></li><li class="level-2" data-v-b57cc07c><a href="/views/Docker/docker%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93.html#_8-troubleshooting" class="sidebar-link reco-side-_8-troubleshooting" data-v-b57cc07c>8. Troubleshooting</a></li><li class="level-2" data-v-b57cc07c><a href="/views/Docker/docker%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93.html#_9-部署示例" class="sidebar-link reco-side-_9-部署示例" data-v-b57cc07c>9. 部署示例</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.402024e5.js" defer></script><script src="/assets/js/3.35889db3.js" defer></script><script src="/assets/js/1.98e71d3a.js" defer></script><script src="/assets/js/18.38c2d3ff.js" defer></script>
  </body>
</html>
